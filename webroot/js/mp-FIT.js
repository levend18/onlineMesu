/*! Copyright 2014 SoftCafe, LLC. Use of any code on this site or the imenupro app is forbidden. */
function mainFIT(){var e=getItem("menufile"),u,r,f;removeNewCol();var n=getItem("menufile"),t=n.food_item.order,i=!0;if(page_no==0?r=jQuery("#textcanvas g").length:(u=n.pagesetup.pagemarker[1],r=_.indexOf(t,u)),f=t.length-r,t.length<5?(doAlert(224,null,4e3,!0),i=!1):checkNewCol()==!1&&f/r>2&&t.length>25?(doAlert(222,null,4e3,!0),i=!1):page_no==0&&emptyCols()>1&&(doAlert(224,null,4e3,!0),i=!1),i==!1)return fit_active=!1,$("#faux-outline").css("fill","none"),stop_spinner2(),$("#myLoadingMenu").modal("hide"),$("#fit-anime").hide(),setItem("menufile",e),iMenuPro.draw_text(page_no),!1;page_no!=0&&iMenuPro.drawto_text(0);$("#next-page-num").text()!=" "?(set_pagespacing(-.1),n.pagesetup.pagespacing[0]="-0.05",setItem("menufile",n),iMenuPro.cont_text()):(set_pagespacing(.03),n.pagesetup.pagespacing[0]="0.03",setItem("menufile",n),remove_extra_fooditem());useAsyncFIT=1;asyncFIT()}function asyncFIT(){var n=getRatio();n!=1?(fontResize(n),iMenuPro.draw_text()):(useAsyncFIT=!1,iMenuPro.sort_by_order(),iMenuPro.pagespacing_delta(),aiFIT_spacing())}function aiFIT_spacing(){var t=getItem("menufile"),n=fitFooditem(-.2,2);set_pagespacing(n);t.pagesetup.pagespacing[0]=n.toFixed(2)+"";sessionStorage.setItem("menufile",JSON.stringify(t));remove_extra_fooditem();makeColumns();isLastOrder()||n==-.2||(t.pagesetup.pagespacing[0]=(n-.01).toFixed(2)+"",set_pagespacing(n-.01),sessionStorage.setItem("menufile",JSON.stringify(t)),iMenuPro.cont_text(),isLastOrder()||n==-.2||(t.pagesetup.pagespacing[0]=(n-.01).toFixed(2)+"",set_pagespacing(n-.01),sessionStorage.setItem("menufile",JSON.stringify(t)),iMenuPro.cont_text()));set_page_of_x();jQuery("#textcanvas g").show();iMenuPro.draw_floattext();iMenuPro.print_footer();make_rect_active();fit_active=!1;$("#faux-outline").css("fill","none");stop_spinner2();$("#myLoadingMenu").modal("hide");$("#fit-anime").hide();jQuery("#colline").show();isLastOrder()==!1&&doAlert(220,null,5e3,!0)}function getRatio(){var f=1.05,e=.95,o=1.3,s=.7,c=28,l=parseFloat(jQuery(".name").css("font-size")),y=areaRect(),r=1,n;if(global_columns==1){var i=areaRect("leftColumn"),u=spaceLeft("lowest")/96*(page_width-left_margin-right_margin),a=.8;u>0&&u<i[0]||Math.abs(i[3]-i[2])<.05*i[3];Math.abs(i[3]-i[2])<.1*i[3]?r=i[3]>i[2]?f:e:(n=i[3]/i[2],n>o&&(n=o),n<s&&(n=s),l>c&&(n=n>1?f:e),r=n)}else if(isUneven){var v=calculate_col_width(null,"with_col_width")[0],h=(v[0]+v[1])/2,a=.9,t=areaRect(),u=spaceLeft()/96*h/global_columns;u+=emptyCols()*h*(page_height-top_margin-bottom_margin-top_alt_margin/96);u>0&&u<t[0]||Math.abs(t[3]-t[2]/2)<.05*t[3]||(Math.abs(t[3]-t[2]/2)<.1*t[3]?r=t[3]>t[2]/2?f:e:(n=t[3]*a/(t[2]/2),n>o&&(n=o),n<s&&(n=s),l>c&&(n=n>1?f:e),r=n,console.log("getRatio() #1 isUneven"+r)))}else{var h=calculate_col_width(null,"with_col_width")[0],a=.9,t=areaRect(),u=spaceLeft()/96*h/global_columns;u+=emptyCols()*h*(page_height-top_margin-bottom_margin-top_alt_margin/96);u>0&&u<t[0]||Math.abs(t[3]-t[2])<.05*t[3]||(Math.abs(t[3]-t[2])<.1*t[3]?r=t[3]>t[2]?f:e:(n=t[3]*a/t[2],n>o&&(n=o),n<s&&(n=s),l>c&&(n=n>1?f:e),r=n))}return r}function fontResize(n){if(!isNaN(n)&&n!=1){var r=1,t=getItem("override.css"),i=getItem("origCSS");jQuery.extend(!0,i,t);jQuery.each([".name",".description",".price",".extras",".title-heading",".heading",".small-heading"],function(u,f){var o=parseInt(i[f]["font-size"]),e=parseInt(o*n+.5);o==e&&(e+=r);e<8&&(e=8);e>72&&(e=72);t[f]||(t[f]={});t[f]=i[f];t[f]["font-size"]=e;delete t[f]["space-before"];delete t[f]["space-after"];delete t[f].indent;delete t[f].justification;delete t[f]["white-space"];delete t[f]["text-rendering"];delete t[f]["-moz-font-feature-settings"];delete t[f]["-ms-font-feature-settings"]});setItem("override.css",t);writeToStyleSheet();leafd()}}function spaceLeft(n){var t=0,i,r,f,u;return n==undefined?(i=parseFloat(jQuery("#textcanvas rect").last().attr("y")),r=parseFloat(jQuery("#textcanvas rect").last().attr("height")),global_columns>1&&(f=parseFloat(jQuery("#textcanvas rect").last().attr("x")),f==left_margin&&(i=top_margin*96,r=0)),u=(page_height-bottom_margin)*96-(i+r)):(_.each(jQuery("#textcanvas g"),function(n){var i=parseFloat(jQuery(n).find("rect").attr("y")),r=parseFloat(jQuery(n).find("rect").attr("height"));t=Math.max(t,i+r)}),u=(page_height-bottom_margin)*96-t),u}function areaRect(n){var r=[],i=0,f=0,t=0,u=(page_height-top_margin-bottom_margin)*(page_width-left_margin-right_margin);if(n==undefined){if(global_columns>1){var e=getItem("origCSS"),a=getItem("override.css"),o=parseFloat(e[".style"]["space-between-columns"]),s=page_height-top_margin-bottom_margin-top_alt_margin/96,h=o*s*(global_columns-1);u-=h}_.each(jQuery("#textcanvas rect"),function(n){var f=parseFloat(jQuery(n).attr("height")),e=parseFloat(jQuery(n).attr("width")),u=parseFloat(f*e/9216);r.push(u);i+=u;t=Math.max(t,u)});_.each(jQuery("#foodbuff rect"),function(n){var f=parseFloat(jQuery(n).attr("height")),e=parseFloat(jQuery(n).attr("width")),u=parseInt(f*e/9216);r.push(u);i+=u;t=Math.max(t,u)})}else{global_columns==1&&jQuery("#textcanvas").append(jQuery("#foodbuff g"));var c=spaceLeft("lowest")/96,l=c*(page_width-left_margin-right_margin),i=parseFloat((u-l).toFixed(4)),t=0,r=_.pluck(jQuery("#textcanvas g"),"id")}return f=parseFloat((i/r.length).toFixed(4)),[f,t,i,u]}function fitFooditem(n,t){var f,e,r,u;iMenuPro.sort_by_order();iMenuPro.pagespacing_delta();f=page_width-right_margin;n>t&&(e=n,n=t,t=e);r=parseFloat(jQuery("#textcanvas rect").last().attr("x"));u=global_columns==1?spaceLeft("lowest"):spaceLeft();for(var o=0,i=t;Math.abs(t-n)>.01&&o<20;)i=n+(t-n)/2,set_pagespacing(i),r=parseFloat(jQuery("#textcanvas rect").last().attr("x")),u=global_columns==1?spaceLeft("lowest"):spaceLeft(),r<f&&u>0?n=i:t=i,o+=1;return i=parseFloat(i.toFixed(3)),parseInt((i-.01)*100)/100}function emptyCols(){var n,t;return global_columns==1?0:(calculate_col_width(),n=parseFloat(jQuery("#textcanvas rect").last().attr("x")),n=parseFloat(n.toFixed(4)),t=_.indexOf(column_array,n),column_array.length-t-2)}function checkNewCol(){var t=getItem("menufile"),i=t.food_item.order,r=_.filter(i,function(n){return n.indexOf("h")>-1}),n=!1;return _.each(r,function(i){var r=t.head_item[i];n=n||r.replace(/^((?:[^;]*;){2})([^;]*)(.*)/,"$2")=="1"}),n}function removeNewCol(){var n=getItem("menufile"),t=n.food_item.order,i=_.filter(t,function(n){return n.indexOf("h")>-1});_.each(i,function(t){var i=n.head_item[t].split(";");i[2]=0;n.head_item[t]=i.join(";");jQuery("#headitem_"+t).find("text").last().find("tspan").first().attr("n_col","0")});setItem("menufile",n);iMenuPro.pagespacing_delta();iMenuPro.cont_text()}
//# sourceMappingURL=mp-FIT.map
