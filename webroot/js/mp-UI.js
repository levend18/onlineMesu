/*! Copyright 2014 SoftCafe, LLC. Use of any code on this site or the imenupro app is forbidden. */
function promiseGet(n){return $.ajax(n)}function updateHeadItemModal(n){var i=getItem("menufile"),f=i.head_item["default"],e=!1,t;if(n){var r=reset.split(":"),o=r[1],u=r[3],s=r[5];i.head_item[u+""]&&(f=i.head_item[u+""]);e=_.indexOf(i.food_item.order,u)+1;jQuery(".spanHeadingTextArea").val(decodeURIComponent(i.head_item.header[o].heading));jQuery('[name="HeadingType"]').val(i.head_item.header[o].type);$("#mp-heading-trashcan").show()}else jQuery(".spanHeadingTextArea").val(""),jQuery('[name="HeadingType"]').val("normal"),$("#mp-heading-trashcan").hide();e?jQuery("#dialog-heading-onmenu").prop("checked",!0):jQuery("#dialog-heading-onmenu").prop("checked",!1);t=f.split(";");t[0]=="none"?(jQuery("#mp-hd-sym1").removeClass("mp-syms"),jQuery("#mp-hd-sym1").addClass("mp-syms-none"),jQuery("#mp-hd-sym1").text("none")):(jQuery("#mp-hd-sym1").addClass("mp-syms"),jQuery("#mp-hd-sym1").removeClass("mp-syms-none"),jQuery("#mp-hd-sym1").text(decodeURIComponent(t[0])));t[1]=="none"?(jQuery("#mp-hd-sym2").removeClass("mp-syms"),jQuery("#mp-hd-sym2").addClass("mp-syms-none"),jQuery("#mp-hd-sym2").text("none")):(jQuery("#mp-hd-sym2").addClass("mp-syms"),jQuery("#mp-hd-sym2").removeClass("mp-syms-none"),jQuery("#mp-hd-sym2").text(decodeURIComponent(t[1])));jQuery("#mp-heading-newpage").prop("checked",parseInt(t[2]));jQuery("#foodcols").val(t[4]);jQuery("#mp-heading-wrap").prop("checked",parseInt(t[5]));jQuery('[name="HeadingAlignment"]').val(t[6]);jQuery('[name="HeadingAccent"]').selectpicker("val",t[7]);jQuery("#mp-heading-span").prop("checked",parseInt(t[8]));jQuery("input[name=HeadingSpacing][value="+t[9]+"]").prop("checked",!0);jQuery("#mp-heading-before").val(numToNum(t[10],"in",unitSI,!1));jQuery("#mp-heading-after").val(numToNum(t[11],"in",unitSI,!1));resetHeadItemCustomSpacing()}function resetHeadItemCustomSpacing(){var f=jQuery("input[name=HeadingSpacing]:checked").val(),t,i,n,r,u;f=="Custom"?(jQuery("#mp-heading-before").prop("disabled",!1),jQuery("#mp-heading-after").prop("disabled",!1),$(".SpacingTextHd").removeClass("muted")):(t=getItem("origCSS"),i=getItem("override.css"),jQuery.extend(!0,t,i),n=jQuery('[name="HeadingType"]').val(),n=n=="normal"?"heading":n+"-heading",r=numToNum(t["."+n]["space-before"],"in",unitSI,!1),u=numToNum(t["."+n]["space-after"],"in",unitSI,!1),jQuery("#mp-heading-before").val(r),jQuery("#mp-heading-after").val(u),jQuery("#mp-heading-before").prop("disabled",!0),jQuery("#mp-heading-after").prop("disabled",!0),$(".SpacingTextHd").addClass("muted"))}function update_headitem_menufile(n,t){var i,r,u;n!=undefined&&(n=n.replace(/u$/,""));i=getItem("menufile");t=="on_edit"?i.food_item.order=_.union(i.food_item.order,n):t=="onoff_drop"?(i.food_item.order=_.union(i.food_item.order,n),i.head_item[n]||(i.head_item[n]=i.head_item["default"])):t=="on_moveup"?(r=_.indexOf(i.food_item.order,n),r!=0&&(u=_.without(i.food_item.order,n),i.food_item.order=_.union(u.slice(0,r-1),n,u.slice(r-1,u.length)))):t=="on_movedown"?(r=_.indexOf(i.food_item.order,n),r!=i.food_item.order.length&&(u=_.without(i.food_item.order,n),i.food_item.order=_.union(u.slice(0,r+1),n,u.slice(r+1,u.length)))):t=="off_edit"&&(i.food_item.order=_.without(i.food_item.order,n));setItem("menufile",i)}function fixHeadData(n){var t=10;typeof n=="boolean"?$("#myHeadingList").css("height","0px"):n.length<=t-1?$("#myHeadingList").css("height",41*n.length-1+"px"):$("#myHeadingList").css("height",41*t-1+"px")}function resetDeleteHeadingDialog(){var n=reset.split(":"),t=n[3],i=n[1];jQuery("#mp-heading-to-delete").html(jQuery("#headitem-"+t).next().text())}function updateFooterModal(){var t=getItem("menufile"),i=decodeURIComponent(t.foot_item.footer),r=t.foot_item.type,u=t.foot_item.foot_tweaks,n=u.split(";"),f=t.foot_item.onmenu;jQuery(".spanFooterTextArea").val(i);n[0]=="none"?(jQuery("#mp-ft-sym1").removeClass("mp-syms"),jQuery("#mp-ft-sym1").addClass("mp-syms-none"),jQuery("#mp-ft-sym1").text("none")):(jQuery("#mp-ft-sym1").addClass("mp-syms"),jQuery("#mp-ft-sym1").removeClass("mp-syms-none"),jQuery("#mp-ft-sym1").text(decodeURIComponent(n[0])));n[1]=="none"?(jQuery("#mp-ft-sym2").removeClass("mp-syms"),jQuery("#mp-ft-sym2").addClass("mp-syms-none"),jQuery("#mp-ft-sym2").text("none")):(jQuery("#mp-ft-sym2").addClass("mp-syms"),jQuery("#mp-ft-sym2").removeClass("mp-syms-none"),jQuery("#mp-ft-sym2").text(decodeURIComponent(n[1])));jQuery(".spanFooterRemovePageIn").val(decodeURIComponent(n[2]));jQuery('[name="footerWrap"]').prop("checked",parseInt(n[3]));jQuery('[name="footerType"]').val(r);jQuery("#mp-footer-accent-select").selectpicker("val",n[4]);jQuery("#dialog-footer-accent-color").spectrum("set",n[5]);jQuery('[name="footerAlign"]').val(n[6]);jQuery("#footerMargin").val(numToNum(n[7],"in",unitSI,!1));jQuery('[name="footerOnmenu"]').prop("checked",f);$("#mp-ft-useEmbed").prop("checked",parseInt(n[8]));updateFTEmbedCodes()}function updateFTEmbedCodes(){$("#mp-ft-useEmbed").prop("checked")?$("#mp-footer-syms li a").parent().find("a").removeClass("fkeyH"):$("#mp-footer-syms li a").parent().find("a").addClass("fkeyH")}function loadFontsAsync(){var n=function(n,t){n?doAlert(294,null,0,!0):fonts=JSON.parse(t)};async_get("/tools/toFonts.php",n)}function loadFonts_unused(){var n,t;if(isIE9){if(n=newXMLHttpRequest(),n.open("GET","/tools/toFonts.php",!1),n.send(null),n.responseText.match("Welcome to nginx"))return doAlert(294,null,0,!0),alert("LoadFonts(): fonts not found on server"),!1;fonts=JSON.parse(n.responseText)}else t="/tools/toFonts.php",async_get(t,function(n,t){n?doAlert(294,null,0,!0):fonts=JSON.parse(t)})}function loadFontStyle(n){var t=_.union(_.flatten(fonts[n].normal),_.flatten(fonts[n].italic));return _.intersection(["Extra-Light","Extra-Light Italic","Light","Light Italic","Regular","Italic","Medium","Medium Italic","Semi-Bold","Semi-Bold Italic","Bold","Bold Italic","Extra-Bold","Extra-Bold Italic","Black","Black Italic"],t)}function loadFontStyleUI(n){jQuery('[name="fontStyle"]').children().remove();jQuery.each(loadFontStyle(n),function(n,t){jQuery('[name="fontStyle"]').append('<option value="'+t+'">'+t+"<\/option>")})}function loadFontFamilyUI(){jQuery('[name="fontFamily"]').children().remove();jQuery.each(_.keys(fonts),function(n,t){jQuery('[name="fontFamily"]').append('<option value="'+t+'">'+t.replace(/_/g," ")+"<\/option>")})}function toFontCSS(n){var t="normal",i,r;return n?(n.indexOf("Italic")>-1&&(t="italic"),i=n.replace(" Italic",""),r={"Extra-Light":"200",Light:"300",Regular:"400",Italic:"400",Medium:"500","Semi-Bold":"600",Bold:"700","Extra-Bold":"800",Black:"900"},[r[i],t]):["400","normal"]}function toFontText(n,t){var i={"200":"Extra-Light","300":"Light","400":"Regular","500":"Medium","600":"Semi-Bold","700":"Bold","800":"Extra-Bold","900":"Black"};return n=="400"?t=="normal"?"Regular":"Italic":t=="normal"?i[n]:i[n]+" Italic"}function sampleFontFamily(n,t){var r,i;if(n==undefined||jQuery("#fontFamily-select").attr("disabled")=="disabled")n=jQuery("#myUploadPreviewFONT").text(),jQuery("#sampleFonttext").find("tspan").css("font-family",'"'+n+'"'),jQuery("#sampleFonttext").find("tspan").css("font-weight","400"),jQuery("#sampleFonttext").find("tspan").css("font-style","normal");else{t=="cufonts"?i=jQuery('[name="fontStyle"]').val():(r=$("#fontStyle-select"),r[0].selectedIndex=0,i=jQuery('[name="fontStyle"] option:first-child').val());var u=toFontCSS(i),f=u[0],e=u[1];jQuery("#sampleFonttext").find("tspan").css("font-family",'"'+n.replace(/_/g," ")+'"');jQuery("#sampleFonttext").find("tspan").css("font-weight",f);jQuery("#sampleFonttext").find("tspan").css("font-style",e)}}function changeFontDialog(n){var r=n.split(":"),t,v,i,y,u,f,h,s,g,nt,e,tt,a;if(_.indexOf(["name","description","price","extras","floating-text","alt-float"],r[1])>-1?(jQuery('[name="fontSpacing"]').prop("disabled",!0),$("#fontSpacingText").addClass("muted"),jQuery('[name="fontShadow"]').prop("disabled",!0),jQuery('[name="fontShadow"]').prop("checked",!1),jQuery('[name="fontShadow"]').parent().css("color","#d1ced1")):($("#fontSpacingText").removeClass("muted"),jQuery('[name="fontSpacing"]').prop("disabled",!1),jQuery('[name="fontShadow"]').prop("disabled",!1),jQuery('[name="fontShadow"]').parent().css("color","#000000")),t="."+r[1],r[0]=="useDefault"?i=getItem("origCSS"):(v=sanitizeOverride(),v&&(fonts_changed=!0,fonts_repage_needed=!0),i=getItem("origCSS"),y=getItem("override.css"),jQuery.extend(!0,i,y)),u=!1,i[t]["font-url"]!=undefined){u=!0;disableFontSelects();var it=_.pluck(imageFONT,"filename"),rt=_.indexOf(it,i[t]["font-family"]),ut="image-"+imageFONT[rt].id;drawUserImageFONT("https://"+s3bkt+".s3.amazonaws.com/"+i[t]["font-url"],ut,i[t]["font-family"]);$("#myUploadPreviewFONT").addClass("mpFontInUse");f=getItem("origCSS");setFontState("edit");resetCustomFontUI();editFont=$("#myUploadPreviewFONT").text()}else setFontState("new"),editFont="",resetCustomFontUI();_.indexOf(["alt-float","alt-font-heading"],r[1])>-1?jQuery("#myChangeFontDialog").find(".MPdialogTitleFont").text(r[2].replace(/_/g," ")):jQuery("#myChangeFontDialog").find(".MPdialogTitleFont").text(r[2].replace(/_/g," ")+" Font");var p=i[t].icaps=="yes",w=i[t]["text-decoration"],o=i[t].stroke,ft=parseInt(i[t]["stroke-width"]),c=i[t].fill,b=i[t]["itext-shadow"];if(u)var k=f[t]["font-family"].split(","),d=k[0].replace(/ /g,"_").replace(/"/g,"").toLowerCase(),s=f[t]["font-style"];else var k=i[t]["font-family"].split(","),l=k[0].replace(/ /g,"_").replace(/"/g,"").toLowerCase(),s=i[t]["font-style"];u?(h=f[t]["font-weight"],s=f[t]["font-style"]):(h=i[t]["font-weight"],s=i[t]["font-style"]);var et=i[t]["font-size"],ot=i[t]["letter-spacing"],st=toFontText(h,s);ft==0?c.indexOf("rgba")>-1?e=c:(g=tinycolor(c),e=g.toRgbString().replace(/rgb/,"rgba").replace(/\)/,","+i[t]["fill-opacity"]+" )")):o.indexOf("rgba")>-1?e=o:(nt=tinycolor(o),e=nt.toRgbString().replace(/rgb/,"rgba").replace(/\)/,","+i[t]["stroke-opacity"]+" )"));b=="none"?setTimeout(function(){jQuery("#shadow").hide()},30):setTimeout(function(){jQuery("#shadow").show()},30);sampleFontCaps(p);u?(loadFontStyleUI(d),jQuery('[name="fontFamily"]').selected().val(d)):(loadFontStyleUI(l),jQuery('[name="fontFamily"]').selected().val(l));jQuery('[name="fontStyle"]').selected().val(st);jQuery('[name="fontSpacing"]').val(ot);jQuery("#dialog-font-color").spectrum("set",e);jQuery('[name="fontAllCaps"]').prop("checked",p);jQuery('[name="fontOverline"]').prop("checked",w.indexOf("overline")>-1);jQuery('[name="fontUnderline"]').prop("checked",w.indexOf("underline")>-1);jQuery('[name="fontStroke"]').prop("checked",o.indexOf("none")==-1);jQuery('[name="fontShadow"]').prop("checked",b.indexOf("none")==-1);tt=jQuery('[name="fontFamily"]').prop("selectedIndex")*15.6;a=jQuery('[name="fontStyle"]').prop("selectedIndex")*15.6;setTimeout(function(){jQuery('[name="fontFamily"]').prop("scrollTop",tt)},30);a>4*15.6&&setTimeout(function(){jQuery('[name="fontStyle"]').prop("scrollTop",a)},30);jQuery("#sampleFonttext").find("tspan").attr("class",r[1]);jQuery("#sampleFonttext").find("tspan").attr("style","");u||jQuery("#sampleFonttext").find("tspan").css("font-family",'"'+l.replace(/_/g," ")+'"');jQuery("#sampleFonttext").find("tspan").css("font-weight",h);jQuery("#sampleFonttext").find("tspan").css("font-style",s);sampleFontSize(et);sampleFontBackground();sampleFontStrokeShadow();sampleFontTextDeco();u&&sampleFontFamily()}function sampleFontSize(n){var t,i,r;n=n?parseInt(n):parseInt(jQuery('[name="fontSize"]').val());t=reset.split(":");i="."+t[1];n+""=="NaN"?(r=getItem("origCSS"),n=parseInt(r[i]["font-size"])):n>maxFontSize?n=maxFontSize:n<6&&(n=6);jQuery('[name="fontSize"]').val(n+"pt");setTimeout(function(){jQuery("#sampleFonttext").find("tspan").css("font-size",n+"pt")},30);n>34?(jQuery("#sampleFonttext").find("tspan").first().attr("y","43px"),jQuery("#sampleFonttext").find("tspan").first().attr("x","146px")):n>14?(jQuery("#sampleFonttext").find("tspan").first().attr("y","42px"),jQuery("#sampleFonttext").find("tspan").first().attr("x","146px")):(jQuery("#sampleFonttext").find("tspan").first().attr("y","41px"),jQuery("#sampleFonttext").find("tspan").first().attr("x","144px"))}function sampleFontCaps(n){var t;t=reset.indexOf("Price")>-1?"Market 13.95":reset.indexOf("Title_Heading")>-1?"Cafe 57":reset.indexOf("Subheading")>-1?"All entrÃ©es served with a salad":reset.indexOf("Name")>-1?"Club Sandwich":reset.indexOf("Description")>-1?"Lettuce, tomato and mayo":reset.indexOf("Extras")>-1?"Add extra cheese for $1":reset.indexOf("Alt-Font_Floating_Text")>-1?"Open 24 Hours":reset.indexOf("Floating_Text")>-1?"Fresh Daily":"Appetizers";n?jQuery("#sampleFonttext").find("tspan").text(decodeURIComponent(t).toUpperCase()):jQuery("#sampleFonttext").find("tspan").text(decodeURIComponent(t))}function sampleFontStrokeShadow(n){var n=jQuery('[name="fontStroke"]').prop("checked"),t=getItem("origCSS"),i=reset.split(":"),f=t["."+i[1]]["itext-shadow"],s=t["."+i[1]].fill,h=t["."+i[1]].stroke,r=jQuery('[name="fontSpacing"]').val(),e=jQuery("#dialog-font-color").spectrum("get").toRgbString(),u=jQuery("#dialog-font-color").spectrum("get").getAlpha(),o;o=f=="none"?"#d1ced1":f.split(" ")[3];n?(h=="none"?jQuery("#sampleFonttext").find("tspan").last().css("fill","#FFFFFF"):jQuery("#sampleFonttext").find("tspan").last().css("fill",s),jQuery("#sampleFonttext").find("tspan").last().css("fill-opacity",1),jQuery("#sampleFonttext").find("tspan").last().css("letter-spacing",r),jQuery("#sampleFonttext").find("tspan").last().css("stroke-opacity",u),jQuery("#sampleFonttext").find("tspan").last().css("stroke-width","1px"),jQuery("#sampleFonttext").find("tspan").last().css("stroke",e)):(jQuery("#sampleFonttext").find("tspan").last().css("fill-opacity",u),jQuery("#sampleFonttext").find("tspan").last().css("fill",e),jQuery("#sampleFonttext").find("tspan").last().css("letter-spacing",r),jQuery("#sampleFonttext").find("tspan").last().css("stroke-opacity",1),jQuery("#sampleFonttext").find("tspan").last().css("stroke-width","0px"),jQuery("#sampleFonttext").find("tspan").last().css("stroke","none"));jQuery("#sampleFonttext").find("tspan").first().css("fill",o);jQuery("#sampleFonttext").find("tspan").first().css("fill-opacity",u);jQuery("#sampleFonttext").find("tspan").first().css("letter-spacing",r);jQuery("#sampleFonttext").find("tspan").first().css("stroke-opacity",1);jQuery("#sampleFonttext").find("tspan").first().css("stroke","none");sampleFontBackground()}function sampleFontTextDeco(){var n="none",t=jQuery('[name="fontUnderline"]').prop("checked"),i=jQuery('[name="fontOverline"]').prop("checked");t&&i?n="underline overline":i?n="overline":t&&(n="underline");jQuery("#sampleFonttext").find("tspan").css("text-decoration",n)}function sampleFontShadow(n){n?jQuery("#shadow").show():jQuery("#shadow").hide()}function sampleFontBackground(){var n=jQuery('[name="fontShadow"]').prop("checked"),t=jQuery("#dialog-font-color").spectrum("get").toHexString();t!="#ffffff"||n?$(".ChangeFontSampleTextBorder").css("background-color","#FFFFFF"):$(".ChangeFontSampleTextBorder").css("background-color","#e6e6e6")}function imageFONTToStyleSheet(){var t=_.pluck(document.styleSheets,"href"),n=_.indexOf(t,"https://"+window.location.host+"/SVG/user_font.css");jQuery.each(imageFONT,function(t,i){var r=document.styleSheets[n].cssRules.length,u="@font-face {font-family: '"+i.filename+"'; src: url(https://s3.amazonaws.com/"+s3bkt+"/"+i.image+")}";document.styleSheets[n].insertRule(u,r)})}function writeToStyleSheet(n){var t=getItem("override.css"),r=reset.split(":"),u=n!=undefined?["."+r[1]]:[".name",".description",".price",".extras",".title-heading",".heading",".alt-font-heading",".small-heading",".floating-text",".alt-float"];var f=_.pluck(document.styleSheets,"href"),i=_.indexOf(f,"https://"+window.location.host+"/SVG/fontsoverride.css"),e=_.pluck(document.styleSheets[i].cssRules,"selectorText");jQuery.each(u,function(n,r){var f,u;t!=undefined&&t[r]!=undefined&&(f=_.indexOf(e,r),f>-1?u=document.styleSheets[i].cssRules[f].style:(f=document.styleSheets[i].cssRules.length,document.styleSheets[i].insertRule(r+" {}",f),u=document.styleSheets[i].cssRules[f].style),u.fontFamily=t[r]["font-url"]==undefined?t[r]["font-family"]:JSON.stringify(t[r]["font-family"]),u.fontWeight=t[r]["font-weight"],u.fontSize=parseInt(t[r]["font-size"])+"pt",u.fontStyle=t[r]["font-style"],u.letterSpacing=t[r]["letter-spacing"],u.textDecoration=t[r]["text-decoration"],u.fill=t[r].fill,u.fillOpacity=t[r]["fill-opacity"],u.stroke=t[r].stroke,u.strokeOpacity=t[r]["stroke-opacity"],u.strokeWidth=t[r]["stroke-width"])})}function emptyFONTStyleSheet(n){var i,n,r,t;for(n||(i=_.pluck(document.styleSheets,"href"),n=_.indexOf(i,"https://"+window.location.host+"/SVG/user_font.css")),r=document.styleSheets[n].cssRules.length,t=0;t<r;t++)document.styleSheets[n].deleteRule(0)}function emptyStyleSheet(n){var i,n,r,t;for(n||(i=_.pluck(document.styleSheets,"href"),n=_.indexOf(i,"https://"+window.location.host+"/SVG/fontsoverride.css")),r=document.styleSheets[n].cssRules.length,t=0;t<r;t++)document.styleSheets[n].deleteRule(0)}function zapTTFfromOverride(n){var t=getItem("override.css"),i=Object.keys(t);n&&jQuery.each(i,function(i,r){t[r]["font-url"]==n&&delete t[r]});setItem("override.css",t)}function sanitizeOverride(){var t=!1,n=getItem("override.css"),i=Object.keys(n),r;return i.length>0&&(imageFONT.length>0?(r=_.pluck(imageFONT,"image"),jQuery.each(i,function(i,u){var f=n[u]["font-url"];f!=undefined&&_.indexOf(r,f)==-1&&(delete n[u],t||doAlert(330,null,15e3,!0),t=!0)}),setItem("override.css",n)):(jQuery.each(i,function(i,r){var u=n[r]["font-url"];u!=undefined&&(delete n[r],t||doAlert(330,null,15e3,!0),t=!0)}),setItem("override.css",n))),t}function emptyStorageFonts(n){var t=getItem("override.css"),i;n?t[n]&&delete t[n]:(i=[".name",".description",".price",".extras",".floating-text",".alt-float",".title-heading",".heading",".alt-font-heading",".small-heading"],jQuery.each(i,function(n,i){t[i]&&delete t[i]}));setItem("override.css",t)}function getOverrideSS(){var n="",t=_.pluck(document.styleSheets,"href"),i=_.indexOf(t,"https://"+window.location.host+"/SVG/fontsoverride.css"),r=document.styleSheets[i].cssRules;return jQuery.each(r,function(t,i){n+=i.cssText+"\n"}),n!=""&&(n+='\n.foodsym, .foodsym1, .foodsym2 { font-family: "SoftCafe Sym SC"; font-weight: 400; font-style: normal; font-variant: normal; all-caps: no; text-decoration: none; text-shadow: none; letter-spacing: 0px; stroke: none; stroke-width: none; }\n'),imageFONT.length>0&&(n+=getUserFontSS()),n}function getUserFontSS(){var n="\n",t=getItem("override.css");return jQuery.each(t,function(t,i){i["font-url"]&&(i["font-family"]=i["font-family"].replace("&","+"),i["font-family"]=i["font-family"].replace("'","~"),i["font-family"]=i["font-family"].replace('"',"-"),i["font-family"]=i["font-family"].replace("<","{"),i["font-family"]=i["font-family"].replace(">","}"),n+='@font-face {font-family: "'+i["font-family"]+'"; src: url("https://s3.amazonaws.com/'+s3bkt+"/"+i["font-url"]+'");} \n')}),n}function chalkFonts(n){var t=n,i=getItem("origCSS");return jQuery.extend(!0,i,t),jQuery.each([".name",".description",".price",".extras",".floating-text",".alt-float",".title-heading",".heading",".alt-font-heading",".small-heading"],function(n,r){t[r]||(t[r]={});t[r]=i[r];t[r].fill="#f4f4f4";t[r].fill=n==0||n==6||n==7||n==8?"#f4f4f4":"#ededed";t[r]["itext-shadow"]!="none"&&(t[r]["itext-shadow"]="2px 3px 0px #2f2f31");t[r].stroke!="none"&&(t[r].stroke="#3f3f3f");delete t[r]["space-before"];delete t[r]["space-after"];delete t[r].indent;delete t[r].justification;delete t[r]["white-space"];delete t[r]["text-rendering"];delete t[r]["-moz-font-feature-settings"];delete t[r]["-ms-font-feature-settings"]}),t}function resetHeadingAccent(n){var t=getItem("origCSS"),h,i,c,l,a;n=="override"&&(h=getItem("override.css"),jQuery.extend(!0,t,h));var r=t[".title-heading-accent"].name,e=t[".title-heading-accent"].color,v=t[".title-heading-accent"]["fill-opacity"],u=t[".heading-accent"].name,o=t[".heading-accent"].color,y=t[".heading-accent"]["fill-opacity"],f=t[".small-heading-accent"].name,s=t[".small-heading-accent"].color,p=t[".small-heading-accent"]["fill-opacity"];jQuery("#mp-colorize-title-checkbox input").prop("checked",e!="none");jQuery("#mp-colorize-normal-checkbox input").prop("checked",o!="none");jQuery("#mp-colorize-small-checkbox input").prop("checked",s!="none");r=r=="none"?"(none)":r;u=u=="none"?"(none)":u;f=f=="none"?"(none)":f;jQuery("#mp-title-accent-select").selectpicker("val",r);jQuery("#mp-normal-accent-select").selectpicker("val",u);jQuery("#mp-small-accent-select").selectpicker("val",f);e=="none"?(jQuery("#mp-dialog-title-accent-color").spectrum("disable"),jQuery("#mp-dialog-title-accent-color").spectrum("set","#d2b48a")):(jQuery("#mp-dialog-title-accent-color").spectrum("enable"),i=tinycolor(e),c=i.toRgbString().replace(/rgb/,"rgba").replace(/\)/,","+v+" )"),jQuery("#mp-dialog-title-accent-color").spectrum("set",c));o=="none"?(jQuery("#mp-dialog-normal-accent-color").spectrum("disable"),jQuery("#mp-dialog-normal-accent-color").spectrum("set","#d2b48a")):(jQuery("#mp-dialog-normal-accent-color").spectrum("enable"),i=tinycolor(o),l=i.toRgbString().replace(/rgb/,"rgba").replace(/\)/,","+y+" )"),jQuery("#mp-dialog-normal-accent-color").spectrum("set",l));s=="none"?(jQuery("#mp-dialog-small-accent-color").spectrum("disable"),jQuery("#mp-dialog-small-accent-color").spectrum("set","#d2b48a")):(jQuery("#mp-dialog-small-accent-color").spectrum("enable"),i=tinycolor(s),a=i.toRgbString().replace(/rgb/,"rgba").replace(/\)/,","+p+" )"),jQuery("#mp-dialog-small-accent-color").spectrum("set",a))}function importImageData(n){var i=Date.now(),r=jQuery("#access_token").val(),u="/api/image/all/"+r+"/"+i,t=newXMLHttpRequest();t.onreadystatechange=function(){t.readyState==4&&t.status==200&&(t.responseText.match("id")?(imageTemp=JSON.parse(t.responseText),imageData=filterImage(imageTemp),(n=="user_font"||n=="init")&&(imageFONT=filterFONT(imageTemp),emptyFONTStyleSheet(),imageFONTToStyleSheet())):(imageData=[],imageFONT=[]),jQuery("#jansy-img-upload").fileupload("reset"),fixImageData(imageData),$("#myUploadImgList").megalist("setDataProvider",imageData),fixImageDataFI(imageData),$("#myUploadImgListFI").megalist("setDataProvider",imageData),fixImageDataCE(imageData),$("#myUploadImgListCE").megalist("setDataProvider",imageData),fixImageDataFONT(imageFONT),$("#myUploadImgListFONT").megalist("setDataProvider",sortCuFonts(imageFONT)))};t.open("GET",u,!0);t.send(null)}function listUserImageFunction(n){var e=JSON.parse(sessionStorage.getItem("menufile")),t="&nbsp;{blank}",r="https://"+s3bkt+".s3.amazonaws.com/"+n.image,i=n.image.lastIndexOf("."),u=[n.image.slice(0,i),"-thumb",n.image.slice(i)].join(""),f="https://"+s3bkt+".s3.amazonaws.com/"+u;return n.filename&&(t=n.filename),'<img idx="image-'+n.id+'" dim="'+n.category+'" style="margin:0 5px 0 3px" url="'+r+'" src="'+f+'" >'+t}function listUserFONTFunction(n){var t="&nbsp;{blank}",i="https://"+s3bkt+".s3.amazonaws.com/"+n.image,r=n.image.lastIndexOf("."),u=[n.image.slice(0,r),"-thumb",".png"].join(""),f="https://"+s3bkt+".s3.amazonaws.com/"+u;return n.filename&&(t=n.filename),'<img idx="image-'+n.id+'" style="margin:0 1px 0 2px" url="'+i+'" src="'+f+'" >'+t}function fixImageDataFI(n,t){var i=3;typeof n=="boolean"||n.length<=0?($("#myUploadImgListFI").css("height","0px"),t==="search"?$("#mp-up-helper-textFI").text(" No images found"):$("#mp-up-helper-textFI").text(" Image Collection is empty")):n.length<=i-1?(jQuery("#mp-up-helper-textFI").text(" Your Image Collection"),$("#myUploadImgListFI").css("height",61*n.length-1+"px")):(jQuery("#mp-up-helper-textFI").text(" Scroll to view your Images"),$("#myUploadImgListFI").css("height",61*i-1+"px"));demoMenu&&$("#mp-up-helper-textFI").text(" Feature unavailable before purchase")}function resetUISearchFI(){$("#myUploadImgListFI").megalist("setDataProvider",imageData);fixImageDataFI(imageData);jQuery("#mp-imgupload-findFI").val("");jQuery("#myUploadImgListFI").removeClass("bluehalo");$("#myUploadImgListFI").megalist("setSelectedIndexMove",-1)}function fixImageDataCE(n,t){var i=5;typeof n=="boolean"||n.length<=0?($("#myUploadImgListCE").css("height","0px"),t==="search"?$("#mp-up-helper-textCE").text(" No images found"):$("#mp-up-helper-textCE").text(" Image Collection is empty")):n.length<=i-1?(jQuery("#mp-up-helper-textCE").text(" Your Image Collection"),$("#myUploadImgListCE").css("height",61*n.length-1+"px")):(jQuery("#mp-up-helper-textCE").text(" Scroll to view your Images"),$("#myUploadImgListCE").css("height",61*i-1+"px"));demoMenu&&$("#mp-up-helper-textCE").text(" Feature unavailable before purchase")}function resetUISearchCE(){$("#myUploadImgListCE").megalist("setDataProvider",imageData);fixImageDataCE(imageData);jQuery("#mp-imgupload-findCE").val("");jQuery("#myUploadImgListCE").removeClass("bluehalo");$("#myUploadImgListCE").megalist("setSelectedIndexMove",-1)}function resetUISearchFONT(){$("#myUploadImgListFONT").megalist("setDataProvider",sortCuFonts(imageFONT));fixImageDataFONT(imageFONT);jQuery("#mp-imgupload-findFONT").val("");jQuery("#myUploadImgListFONT").removeClass("bluehalo");$("#myUploadImgListFONT").megalist("setSelectedIndexMove",-1)}function fixImageDataFONT(n,t){var i=3;typeof n=="boolean"||n.length<=0?($("#myUploadImgListFONT").css("height","0px"),t==="search"?$("#mp-up-helper-textFONT").text(" No fonts found"):$("#mp-up-helper-textFONT").text(" You have no custom fonts")):n.length<=i-1?(jQuery("#mp-up-helper-textFONT").text(" Your Custom Fonts"),$("#myUploadImgListFONT").css("height",61*n.length-1+"px")):(jQuery("#mp-up-helper-textFONT").text(" Scroll to view your Fonts"),$("#myUploadImgListFONT").css("height",61*i-1+"px"));demoMenu&&$("#mp-up-helper-textFONT").text(" Feature unavailable before purchase")}function fixImageData(n,t){var i=5;typeof n=="boolean"||n.length<=0?($("#myUploadImgList").css("height","0px"),t==="search"?$("#mp-up-helper-text").text(" No images found"):$("#mp-up-helper-text").text(" Your Image Collection is empty")):n.length<=i-1?(jQuery("#mp-up-helper-text").text(" Your Image Collection"),$("#myUploadImgList").css("height",61*n.length-1+"px")):(jQuery("#mp-up-helper-text").text(" Scroll to view your Image Collection"),$("#myUploadImgList").css("height",61*i-1+"px"));demoMenu&&$("#mp-up-helper-text").text(" Feature unavailable before purchase")}function resetUISearch(){$("#myUploadImgList").megalist("setDataProvider",imageData);fixImageData(imageData);jQuery("#mp-imgupload-find").val("");jQuery("#myUploadImgList").removeClass("bluehalo");$("#myUploadImgList").megalist("setSelectedIndexMove",-1)}function drawUserImage(n,t){bmpTestWarn(n);jQuery("#myUploadPreview").children().remove();jQuery("#myUploadPreview").html('<img src="" >');jQuery("#myUploadPreview img").attr("src",n);jQuery("#myUploadPreview img").attr("class",t)}function bmpTestWarn(n){n!=undefined&&n.indexOf(".")!=-1&&n.substr(n.lastIndexOf(".")+1).match(/bmp/i)?doAlert(302,null,3500,!0):jQuery(".notifications.login").children().length>0&&jQuery(".notifications.login").children().remove()}function resetLightenStuff(){$("#ui-watermark").prop("checked",!1);$("#ui-water-percent").val("0.3");$("#ui-water-percent").attr("disabled",!0);$("#myUploadPreview img").css("opacity","1")}function check_file_imgupload(){var n,t;$("#mp-up-ifuploaded").hide();n=jQuery("#file-imgupload").val();n&&(jQuery("#dialog-ui-ratio").prop("checked",!1),jQuery("#mp-link-aspect-upload").hide(),jQuery("#dialog-ui-width").prop("disabled",!0),jQuery("#dialog-ui-height").prop("disabled",!0),$(".UiText").addClass("muted"),bmpTestWarn(n),parseInt($("#mp-acct-images").text())>1&&n.length>5&&(n=n.replace(/^.*\\|\.[^.]*$/g,""),t=_.find(imageData,function(t){return t.filename==n}),t!=undefined&&($("#mp-up-ifuploaded").show(),$("#mp-up-ifuploaded").animate({opacity:.1},400),$("#mp-up-ifuploaded").animate({opacity:1},800))))}function resetUserImageUI(){jQuery("#dialog-ui-ratio").prop("checked",!1);jQuery("#dialog-ui-ratio").prop("disabled",!0);$("#UiMaintainText").addClass("muted");jQuery("#mp-link-aspect-upload").hide();jQuery("#dialog-ui-width").val("").prop("disabled",!0);jQuery("#dialog-ui-height").val("").prop("disabled",!0);jQuery("#dialog-ui-top").val("0").prop("disabled",!1);jQuery("#dialog-ui-left").val("0").prop("disabled",!1);jQuery("#jansy-img-upload").fileupload("reset");$(".UiText").addClass("muted");resetLightenStuff();$("#mp-up-ifuploaded").hide()}function resetUserImageHeader(n){n?($("#mp-imgupload-btn").hide(),jQuery("#mp-insertUpImage-title").hide(),jQuery("#mp-insertUpImage-subheader").hide(),jQuery("#dialog-imgupload-help").hide(),jQuery("#mp-editUpImage-title").show(),jQuery("#mp-editUpImage-subheader").show(),jQuery("#dialog-imgupload-edit-help").show(),jQuery("#mp-imgupload-onmenu").show(),jQuery("#dialog-ui-onmenu").prop("checked",!0),jQuery("#mp-imgupload-cancel-select").text("Cancel"),demoMenu||(jQuery("#dialog-ui-ratio").prop("disabled",!1),$("#UiMaintainText").removeClass("muted"))):($("#mp-imgupload-btn").show(),jQuery("#mp-insertUpImage-title").show(),jQuery("#mp-insertUpImage-subheader").show(),jQuery("#dialog-imgupload-help").show(),jQuery("#mp-editUpImage-title").hide(),jQuery("#mp-editUpImage-subheader").hide(),jQuery("#dialog-imgupload-edit-help").hide(),jQuery("#mp-imgupload-onmenu").hide(),jQuery("#mp-imgupload-cancel-select").text("Cancel"))}function image_toNext(n){var t=getItem("menufile"),i=n.node.id;t.float_images[i].page_no=Math.min(page_no+1,10);setItem("menufile",t);iMenuPro.draw_images()}function image_toPrev(n){var t=getItem("menufile"),i=n.node.id;t.float_images[i].page_no=Math.max(0,page_no-1);setItem("menufile",t);iMenuPro.draw_images()}function image_toFront(n){n.toFront();n.sizer.toFront();n.remover.toFront();var i=n.node.id,t=getItem("menufile"),r=_.without(t.float_images.order,i);t.float_images.order=_.union(r,i);setItem("menufile",t)}function image_toBack(n){n.toBack();var i=n.node.id,t=getItem("menufile"),r=_.without(t.float_images.order,i);t.float_images.order=_.union(i,r);setItem("menufile",t)}function image_remove(n){mp_predo("image",page_no);var i=n.node.id,t=getItem("menufile");delete t.float_images[i];t.float_images.order=_.without(t.float_images.order,i);setItem("menufile",t);n.sizer.remove();n.remover.remove();n.remove();reset="";editImage=""}function image_delete_fooditem(n,t){jQuery("#fooditem ."+n).attr("href",'https://"+s3bkt+".s3.amazonaws.com/File-Not-Found.jpg');var i=sessionStorage.getItem("menufile"),r=JSON.parse(sessionStorage.getItem("menufile")),u=JSON.stringify(r.food_item).match(t);sessionStorage.setItem("menufile",i.split(t).join(""));u&&iMenuPro.draw_text(page_no)}function image_delete(n){var t=getItem("menufile"),i=[];_.each(jQuery("#floatimages ."+n),function(n){var t=n.raphaelid;paper.getById(t).sizer.remove();paper.getById(t).remover.remove();paper.getById(t).remove()});_.each(t.float_images.order,function(r){t.float_images[r].idx==n?(delete t.float_images[r],menu_changes=++menu_changes):i.push(r)});t.float_images.order=i;setItem("menufile",t)}function setArtisanHeight(){var t=numToNum(jQuery("#dialog-ai-width").val(),unitSI,"px",!0),i=jQuery("#myArtisanPreview img").prop("width"),r=jQuery("#myArtisanPreview img").prop("height"),n=t*r/i,u=n>9600?9600:n;jQuery("#dialog-ai-height").val(numToNum(u,"px",unitSI))}function toggleArtView(n){$("#mp-view-food").removeClass("icon-ok");$("#mp-view-food").addClass("no-menu-icon");$("#mp-view-graphic").removeClass("icon-ok");$("#mp-view-graphic").addClass("no-menu-icon");$("#mp-view-grunge").removeClass("icon-ok");$("#mp-view-grunge").addClass("no-menu-icon");$("#mp-view-hand").removeClass("icon-ok");$("#mp-view-hand").addClass("no-menu-icon");$("#mp-view-loose").removeClass("icon-ok");$("#mp-view-loose").addClass("no-menu-icon");$("#mp-view-pen").removeClass("icon-ok");$("#mp-view-pen").addClass("no-menu-icon");$("#mp-view-torn").removeClass("icon-ok");$("#mp-view-torn").addClass("no-menu-icon");$("#mp-view-vintage").removeClass("icon-ok");$("#mp-view-vintage").addClass("no-menu-icon");$("#mp-view-woodcut").removeClass("icon-ok");$("#mp-view-woodcut").addClass("no-menu-icon");$("#mp-view-zephyr").removeClass("icon-ok");$("#mp-view-zephyr").addClass("no-menu-icon");$(n).removeClass("no-menu-icon");$(n).addClass("icon-ok");resetAISearch()}function resetAISearch(){var n="#"+jQuery("#mp-view-collection").find(".icon-ok").attr("id");$("#myArtisanList").megalist("setDataProvider",setArtisanData(n));fixAI(setArtisanData(n));jQuery("#mp-ai-find").val("");jQuery("#myArtisanList").removeClass("bluehalo");$("#myArtisanList").megalist("setSelectedIndexMove",-1)}function loadArtisanImage2(){var n=getCompressedImage();return JSON.parse(LZString.decompressFromBase64(n))}function loadArtisanImage(){var n={},r=newXMLHttpRequest(),u,t,i;if(r.open("get","/SVG/images/images_index.txt",!1),r.send(),r.responseText.match("Welcome to nginx"))return alert("File not found on server"),!1;for(u=r.responseText.split("\n"),t=0;t<u.length;t++)i=u[t].split("/"),i.length>1&&(typeof n[i[1]]=="undefined"&&(n[i[1]]=[]),n[i[1]].push(u[t]));return sessionStorage.setItem("artisan-image",JSON.stringify(n)),n}function setArtisanData(n){var t;artData||(artData=loadArtisanImage2());switch(n){case"#mp-view-food":t=artData.Food_Photo_Objects;break;case"#mp-view-graphic":t=artData.Graphic_Illustrations;break;case"#mp-view-grunge":t=artData.Grunge_Stamps;break;case"#mp-view-hand":t=artData.Hand_Drawn_Vignettes;break;case"#mp-view-loose":t=artData.Loose_Ink_Drawings;break;case"#mp-view-pen":t=artData.Pen_and_Ink_Drawings;break;case"#mp-view-torn":t=artData.Torn_Color_Blocks;break;case"#mp-view-vintage":t=artData.Vintage_Etchings;break;case"#mp-view-woodcut":t=artData.Woodcut_Illustrations;break;case"#mp-view-zephyr":t=artData.Zephyr_Icons;break;default:t=artData.Grunge_Stamps}return t}function listArtisanImageFunction(n){var t=n.replace(/....$/g,"-thumb.png"),i=n.split("/")[2].replace(/....$/g,"").replace(/_/g," ");return'<img style="margin:0 5px 0 3px" url="'+n+'" src="'+t+'" >'+i}function setArtisanImage(n){var t="",n;$("#ai-imagetype-svgmsg").hide();jQuery("#myArtisanPreview").html('<img src="" >');n.match(/svg$/)&&!n.match(/Woodcut|Loose_Ink|Pen_and_Ink|Graphic_Illustrations/i)?($("#dialog-picture-color").spectrum("enable"),$("#dialog-ai-colorize").attr("disabled",!1),$("#dialog-picture-colorPNG").spectrum("disable"),$("#dialog-ai-colorizePNG").attr("disabled",!0),$("#ai-imagetype-watermark").hide(),$("#ai-imagetype-png").hide(),$("#ai-imagetype-svg").show(),$("#ai-imagetype-svgmsg").show(),$("#myArtisanPreview img").css("opacity","1"),$("#ai-watermark").prop("checked",!1),$("#ai-water-percent").val("0.3")):($("#dialog-ai-colorize").attr("disabled",!0),$("#dialog-picture-color").spectrum("disable"),$("#dialog-picture-colorPNG").spectrum("enable"),$("#dialog-ai-colorizePNG").attr("disabled",!1),t="PNG",$("#ai-imagetype-svg").hide(),$("#ai-imagetype-watermark").show(),$("#ai-watermark").prop("checked")?($("#ai-water-percent").attr("disabled",!1),$("#myArtisanPreview img").css("opacity",$("#ai-water-percent").val())):($("#ai-water-percent").attr("disabled",!0),$("#myArtisanPreview img").css("opacity","1")),$("#ai-imagetype-png").show());flipArtisanImage();colorArtisanImage(n,t);n=jQuery("#myArtisanPreview img").attr("src");jQuery("#dialog-ai-width").prop("disabled")&&n.match(/Torn_Color/i)&&(jQuery("#dialog-ai-width").val(numToNum(384,"px",unitSI)),jQuery("#dialog-ai-height").val(""))}function drawArtisanImage(){var h=jQuery("#myArtisanPreview img").attr("src"),l,a,n,e,y;if(h!=undefined&&h!=""){mp_predo("image",page_no);var t=getItem("menufile"),v=jQuery("#dialog-ai-ratio").prop("checked")?1:0,r=numToNum(jQuery("#dialog-ai-width").val(),unitSI,"px",!0),i=numToNum(jQuery("#dialog-ai-height").val(),unitSI,"px",!0),u=numToNum(jQuery("#dialog-ai-top").val(),unitSI,"px",!0),f=numToNum(jQuery("#dialog-ai-left").val(),unitSI,"px",!0),o=jQuery("#dialog-ai-flip").prop("checked")?-1:1,s=jQuery("#dialog-ai-mirror").prop("checked")?-1:1,c=$("#ai-watermark").prop("checked")?1:0;if(c>0&&(c=$("#ai-water-percent").val()),u=isNaN(u)?0:u,f=isNaN(f)?0:f,(isNaN(parseInt(i))||i==0)&&(l=parseInt(jQuery("#myArtisanPreview img").prop("height")),a=parseInt(jQuery("#myArtisanPreview img").prop("width")),i=parseInt(r/a*l),(isNaN(parseInt(i))||i==0)&&(i=r)),editImage)n=editImage.node.id,editImage.sizer.remove(),editImage.remover.remove(),editImage.remove();else{for(n="fi_"+generateUUID();_.contains(t.float_images.order,n)==!0;)n="fi_"+generateUUID();t.float_images.order.push(n)}e=v?paper.image(h,f*s,u*o,r,i,"xMidYMid meet"):paper.image(h,f*s,u*o,r,i,"none");e.node.id=n;x1=s>0?0:r;y1=o>0?0:i;e.transform("m"+s+",0,0,"+o+","+x1+","+y1);image_drag(e);c?e.node.setAttribute("opacity",c):e.node.removeAttribute("opacity");y=[u,f,r,i,o,s].join(":");t.float_images[n]={};t.float_images[n].idx="none";t.float_images[n].url=h;t.float_images[n].page_no=page_no;t.float_images[n].x=f;t.float_images[n].y=u;t.float_images[n].width=r;t.float_images[n].height=i;t.float_images[n].flip=o;t.float_images[n].mirror=s;t.float_images[n].watermark=c;setItem("menufile",t);imageCheck(e)}}function flipArtisanImage(){var n=jQuery("#dialog-ai-flip").prop("checked")?-1:1,t=jQuery("#dialog-ai-mirror").prop("checked")?-1:1;$("#myArtisanPreview").css("transform","scale("+t+","+n+")");$("#myArtisanPreview").css("-ms-transform","scale("+t+","+n+")")}function colorArtisanImage(n,t){var e=jQuery("#dialog-ai-colorize"+t).prop("checked"),o=jQuery("#dialog-ai-colorize"+t).prop("disabled"),n,r,u,i,f;n||(n=jQuery("#myArtisanPreview img").attr("src"),n.search(/svgimg/)>0&&(r=base64.decode(n.split("/")[4]).split(":"),n=r[2].replace(/\/SVG\//g,"")));n&&e&&!o?(u=jQuery("#dialog-picture-color"+t).spectrum("get").toHexString().slice(1),i=1,t!="PNG"&&(i=jQuery("#dialog-picture-color"+t).spectrum("get").getAlpha()),f="https://"+window.location.host+"/svgimg/"+base64.encode(u+":"+i+":/SVG/"+n),jQuery("#myArtisanPreview img").attr("src",f)):jQuery("#myArtisanPreview img").attr("src",n)}function resetArtisanUI(){jQuery("#dialog-ai-ratio").prop("checked",!1);jQuery("#dialog-ai-ratio").prop("disabled",!0);$("#AiMaintainText").addClass("muted");jQuery("#mp-link-aspect-ai").hide();jQuery("#dialog-ai-width").val(numToNum(192,"px",unitSI)).prop("disabled",!0);jQuery("#dialog-ai-height").val("").prop("disabled",!0);$(".AiText").addClass("muted");jQuery("#dialog-ai-top").val("0").prop("disabled",!1);jQuery("#dialog-ai-left").val("0").prop("disabled",!1);jQuery("#dialog-ai-flip").prop("checked",!1);jQuery("#dialog-ai-mirror").prop("checked",!1);jQuery("#dialog-ai-colorize").prop("checked",!1);jQuery("#dialog-ai-colorizePNG").prop("checked",!1);jQuery("#dialog-ai-colorize").attr("disabled",!1);jQuery("#dialog-ai-colorizePNG").attr("disabled",!1);jQuery("#dialog-picture-color").spectrum("set","#d2b48a");jQuery("#dialog-picture-colorPNG").spectrum("set","#d2b48a");jQuery("#dialog-ai-onmenu").prop("checked",!0);$("#ai-watermark").prop("checked",!1);$("#ai-water-percent").val("0.3");$("#ai-water-percent").attr("disabled",!0);$("#myArtisanPreview img").css("opacity","1")}function resetArtisanHeader(n){n?(jQuery("#mp-insertIMPImage-title").hide(),jQuery("#mp-insertIMPImage-subheader").hide(),jQuery("#mp-insertIMPImage-help").hide(),jQuery("#mp-editIMPImage-title").show(),jQuery("#mp-editIMPImage-subheader").show(),jQuery("#mp-editIMPImage-help").show(),jQuery("#mp-IMPImage-onmenu").show(),jQuery("#mp-artisan-cancel-select").text("Cancel")):(jQuery("#mp-insertIMPImage-title").show(),jQuery("#mp-insertIMPImage-subheader").show(),jQuery("#mp-insertIMPImage-help").show(),jQuery("#mp-editIMPImage-title").hide(),jQuery("#mp-editIMPImage-subheader").hide(),jQuery("#mp-editIMPImage-help").hide(),jQuery("#mp-IMPImage-onmenu").hide(),jQuery("#mp-artisan-cancel-select").text("Cancel"))}function centerImage(n){var i=page_width*96-parseInt(n.attr("width")),t,r;n.attr("x",n.matrix.a*i/2);t=getItem("menufile");r=n.node.id;t.float_images[r].x=parseInt(n.matrix.a*i/2);setItem("menufile",t)}function cloneImage(n){for(var i=getItem("menufile"),f=15,a=n.node.id,r="fi_"+generateUUID();_.contains(i.float_images.order,r)==!0;)r="fi_"+generateUUID();i.float_images.order.push(r);i.float_images[r]=jQuery.extend({},i.float_images[a]);i.float_images[r].x+=f;i.float_images[r].y+=f;setItem("menufile",i);var t=i.float_images[r],e=t.url,v=parseFloat(t.x),y=parseFloat(t.y),o=parseFloat(t.width),s=parseFloat(t.height),h=parseInt(t.flip),c=parseInt(t.mirror),p=t.idx,l=parseFloat(t.watermark),u=paper.image(e,v,y,o,s,"none");e.indexOf("s3.amazonaws")!=-1&&u.node.setAttribute("class",p);u.node.id=r;x1=c>0?0:o;y1=h>0?0:s;u.transform("m"+c+",0,0,"+h+","+x1+","+y1);l?u.node.setAttribute("opacity",l):u.node.removeAttribute("opacity");image_drag(u)}function tohex6(n){return n.length==3?n[0]+n[0]+n[1]+n[1]+n[2]+n[2]:n}function mp_floatCheck(n){var t;t=n?[n]:_.pluck(jQuery("#floattext g"),"id");_.each(t,function(n){var i=svg_IE.getElementById(n),v=n.replace(/floatitem_/,"").replace(/floatitem:/,""),s=parseFloat(i.transform.animVal.getItem(0).matrix.e),h=parseFloat(i.transform.animVal.getItem(0).matrix.f),a=parseInt(i.transform.animVal.getItem(1).angle),t=parseFloat(i.transform.animVal.getItem(2).matrix.a),c=parseFloat(i.lastChild.getAttribute("height")),l=parseFloat(i.lastChild.getAttribute("width")),r=0,u=0,f=l/2*t,e=c/2*t,o;a==90?(r=c*t,f=c/2*t,e=l/2*t):a==180?(r=l*t,u=c*t):a==270&&(u=l*t,f=c/2*t,e=l/2*t);o=!1;s<r-f&&(s=r-f,o=!0);h<u-e&&(h=u-e,o=!0);s>page_width*96+r-f&&(s=page_width*96+r-f,o=!0);h>page_height*96+u-e&&(h=page_height*96+u-e,o=!0);o&&(i.setAttribute("transform","translate("+s+","+h+") rotate("+a+" 0 0) scale("+t+")"),updateFloat_xy(n))})}function mp_floatArrange(){var n=_.pluck(jQuery("#floattext g"),"id"),t;n.length<=1||(t=n.map(function(n){return parseInt(n.substr(12))}).sort(),$.each(t,function(n,t){$("#floattext").append($("#floatitem_ft"+t))}))}function imageCheck(n){var e=getItem("menufile"),t=.25,n,o,s;if(n){if(n.node.id){var i=n.attr().x,r=n.attr().y,u=n.attr().height,f=n.attr().width;(u<60||f<60)&&(t=(90-Math.min(u,f))/100);o=parseInt(page_height*96)-parseInt(t*u);s=parseInt(page_width*96)-parseInt(t*f);i*n.matrix.a<(t-1)*f&&(i=parseInt((t-1)*f)*n.matrix.a);r*n.matrix.d<(t-1)*u&&(r=parseInt((t-1)*u)*n.matrix.d);i*n.matrix.a>s&&(i=s*n.matrix.d);r*n.matrix.d>o&&(r=o*n.matrix.d);n.attr({x:i,y:r});e.float_images[n.node.id].x=i;e.float_images[n.node.id].y=r;e.float_images[n.node.id].width=f;e.float_images[n.node.id].height=u;image_elem_pos(n)}}else for(n=paper.bottom;n;){if(n.node.id){var i=n.attr().x,r=n.attr().y,u=n.attr().height,f=n.attr().width;(u<60||f<60)&&(t=(90-Math.min(u,f))/100);o=parseInt(page_height*96)-parseInt(t*u);s=parseInt(page_width*96)-parseInt(t*f);i*n.matrix.a<(t-1)*f&&(i=parseInt((t-1)*f)*n.matrix.a);r*n.matrix.d<(t-1)*u&&(r=parseInt((t-1)*u)*n.matrix.d);i*n.matrix.a>s&&(i=s*n.matrix.a);r*n.matrix.d>o&&(r=o*n.matrix.d);n.attr({x:i,y:r});e.float_images[n.node.id].x=i;e.float_images[n.node.id].y=r;e.float_images[n.node.id].width=f;e.float_images[n.node.id].height=u;image_elem_pos(n)}n=n.next}setItem("menufile",e)}function imageClick(n){var r=n.attr("src"),h=n.node.getAttribute("class"),i=n.node.getAttribute("opacity"),f=jQuery(n.node).attr("x")*n.matrix.a,e=jQuery(n.node).attr("y")*n.matrix.d,o=n.attr("width"),s=n.attr("height"),c=n.matrix.a==1?!1:!0,l=n.matrix.d==1?!1:!0,u,t;r.search(/svgimg/)>0&&(u=base64.decode(r.split("/")[4]).split(":"),jQuery("#dialog-picture-color").spectrum("set","#"+u[0]),t=jQuery("#dialog-picture-color").spectrum("get").toRgb(),t.a=u[1],jQuery("#dialog-picture-color").spectrum("set","rgba("+t.r+","+t.g+","+t.b+","+t.a+")"),jQuery("#dialog-ai-colorize").prop("checked",!0),jQuery("#dialog-picture-colorPNG").spectrum("set","#"+u[0]),t=jQuery("#dialog-picture-colorPNG").spectrum("get").toRgb(),t.a=u[1],jQuery("#dialog-picture-colorPNG").spectrum("set","rgba("+t.r+","+t.g+","+t.b+","+t.a+")"),jQuery("#dialog-ai-colorizePNG").prop("checked",!0),r=u[2].substring(u[2].search("/")+5));r.indexOf("amazonaws.com")==-1&&r.indexOf("data:image")==-1?(jQuery("#dialog-ai-width").val(numToNum(o,"px",unitSI)).prop("disabled",!1),jQuery("#dialog-ai-height").val(numToNum(s,"px",unitSI)).prop("disabled",!1),$(".AiText").removeClass("muted"),jQuery("#dialog-ai-top").val(numToNum(e,"px",unitSI)).prop("disabled",!1),jQuery("#dialog-ai-left").val(numToNum(f,"px",unitSI)).prop("disabled",!1),jQuery("#dialog-ai-flip").prop("checked",l),jQuery("#dialog-ai-mirror").prop("checked",c),jQuery("#dialog-ai-ratio").prop("disabled",!1),$("#AiMaintainText").removeClass("muted"),resetArtisanHeader("edit"),setArtisanImage(r),i!=""&&i>.01&&i<1?($("#ai-water-percent").attr("disabled",!1),$("#ai-watermark").prop("checked",1),$("#ai-water-percent").val(i.toString()),setTimeout(function(){$("#myArtisanPreview img").css("opacity",$("#ai-water-percent").val())},7)):($("#ai-watermark").prop("checked",0),$("#ai-water-percent").val("0.3"),$("#ai-water-percent").attr("disabled",!0),$("#myArtisanPreview img").css("opacity","1")),jQuery("#myInsertiMenuProImageDialog").modal("show")):(demoMenu||(jQuery("#dialog-ui-width").val(numToNum(o,"px",unitSI)).prop("disabled",!1),jQuery("#dialog-ui-height").val(numToNum(s,"px",unitSI)).prop("disabled",!1),$(".UiText").removeClass("muted")),jQuery("#dialog-ui-top").val(numToNum(e,"px",unitSI)).prop("disabled",!1),jQuery("#dialog-ui-left").val(numToNum(f,"px",unitSI)).prop("disabled",!1),i!=""&&i>.01&&i<1?($("#ui-water-percent").attr("disabled",!1),$("#ui-watermark").prop("checked",1),$("#ui-water-percent").val(i.toString()),setTimeout(function(){$("#myUploadPreview img").css("opacity",$("#ui-water-percent").val())},7)):($("#ui-watermark").prop("checked",0),$("#ui-water-percent").val("0.3"),$("#ui-water-percent").attr("disabled",!0),$("#myUploadPreview img").css("opacity","1")),drawUserImage(r,h),resetUserImageHeader("edit"),jQuery("#myInsertUploadedImageDialog").modal("show"))}function session_logout(n){if(nosaveMenu){doAlert("No logout allowed with nosave option","warning",4e3,!0,"top-left");return}n!=undefined?(doAlert(124,null,0,!0),isMenuSaved.indexOf("title_OK")>-1||isMenuSaved.indexOf("settings_OK")>-1||isMenuSaved.indexOf("menufile_OK")>-1?auto_logout():autoSessionLogout=setTimeout(function(){session_logout("waitForSave")},1e3)):auto_logout()}function auto_logout(){doAlert(0);window.onbeforeunload=null;var n=jQuery("#access_token").val();jQuery.post("/tools/token-logout","access_token="+n,function(){window.location.href="/login"},"json").fail(function(){window.location.href="/login"})}function session_logout_doAlert(){$("#acct-log-out").click()}function session_alert5(){doAlert(98,"",0,!0,"headsup")}function session_alert1(){save_menu();save_settings();doAlert(100,"",0,!0,"headsup")}function session_expired(){doAlert(102,"",0,!1,"login");auto_logout()}function image_drag(n){var i=Math.abs(n.attr("y")),t=Math.abs(n.attr("x"))+parseInt(n.attr("width"))-gicon_px,u=Math.abs(n.attr("y"))+parseInt(n.attr("height"))-gicon_px;s=paper.image("../SVG/bootstrap/img/sizer.ico",t,u,gicon_px,gicon_px).attr({stroke:"none",opacity:0}).hover(sizerin,sizerout);r=paper.image("../SVG/bootstrap/img/remover.ico",t,i,gicon_px,gicon_px).attr({stroke:"none",opacity:0}).hover(sizerin,sizerout);n.drag(move,start,up);n.sizer=s;n.remover=r;n.hover(hoverin,hoverout);s.drag(rmove,rstart,rup);s.box=n;r.box=n;r.click(function(){mp_predo("image",page_no);image_remove(this.box)})}function image_elem_pos(n){var t=parseInt(n.attrs.x),i=parseInt(n.attrs.y),u=parseInt(n.attrs.height),r=parseInt(n.attrs.width),f=n.matrix.a*t+r-gicon_px,e=n.matrix.d*i+u-gicon_px,o=n.matrix.a*t+r-gicon_px,s=n.matrix.d*i;n.sizer.attr({x:f,y:e}).show();n.remover.attr({x:o,y:s}).show()}function setFloatSize(n){var t=$("#floatSize").val();t!=n&&($("#floatSize").val(n),$("#floatSize").trigger("change"))}function checkFloatScaleInput(){var n=(parseFloat($("#floatSize").val())/100).toFixed(2);return isNaN(n)||n===undefined||n==null||n==1?($("#floatSize").val("none"),1):n<.25?($("#floatSize").val("25%"),.25):n>4?($("#floatSize").val("400%"),4):($("#floatSize").val((n*100).toFixed(0)+"%"),n)}function resetFloatingText(n){if(n){var i=reset.split(":")[1],r=getItem("menufile"),u=r.float_text[i].text,t=r.float_text[i].param.split(";");jQuery("#myFloatingTextDialog .spanFTTextArea").val(decodeURIComponent(u));jQuery("#mp-rotate-ft").val(t[0]);jQuery("#mp-curve-ft").val(t[1]);jQuery("#mp-floatingtext-alignment").val(t[2]);jQuery("#mp-floatingtext-boxaccent").selectpicker("val",t[3]);jQuery("#dialog-floating-text-accent-color").spectrum("set",t[4]);jQuery("#mp-floatingtext-left").val(numToNum(t[5],"in",unitSI));jQuery("#mp-floatingtext-top").val(numToNum(t[6],"in",unitSI));t[7]==1?$("#floatSize").val("none"):$("#floatSize").val((t[7]*100).toFixed(0)+"%");jQuery("#mp-floatingtext-onmenu").show();jQuery("#mp-ft-onmenubox").prop("checked",!0);jQuery("#dialog-floatingtext-title").hide();jQuery("#dialog-floatingtext-subtitle").hide();jQuery("#dialog-floatingtext-help").hide();jQuery("#dialog-floatingtext-edit-title").show();jQuery("#dialog-floatingtext-edit-subtitle").show();jQuery("#dialog-floatingtext-edit-help").show();t[8]!=undefined?jQuery("#mp-altfont-ft").val(t[8]):jQuery("#mp-altfont-ft").val("floating-text")}else jQuery("#myFloatingTextDialog .spanFTTextArea").val(""),jQuery("#mp-rotate-ft").val("0"),jQuery("#mp-curve-ft").val("none"),jQuery("#mp-floatingtext-alignment").val("left"),jQuery("#mp-floatingtext-boxaccent").selectpicker("val","(none)"),jQuery("#dialog-floating-text-accent-color").spectrum("set","rgb(210, 180, 138)"),jQuery("#mp-floatingtext-left").val(numToNum("0.25","in",unitSI)),jQuery("#mp-floatingtext-top").val(numToNum("0.25","in",unitSI)),$("#floatSize").val("none"),jQuery("#mp-altfont-ft").val("floating-text"),jQuery("#mp-floatingtext-onmenu").hide(),jQuery("#mp-ft-onmenubox").prop("checked",!0),jQuery("#dialog-floatingtext-edit-title").hide(),jQuery("#dialog-floatingtext-edit-subtitle").hide(),jQuery("#dialog-floatingtext-edit-help").hide(),jQuery("#dialog-floatingtext-title").show(),jQuery("#dialog-floatingtext-subtitle").show(),jQuery("#dialog-floatingtext-help").show();jQuery("#mp-curve-ft").val()!="none"?($("#ft_alignment_title").addClass("muted"),$("#mp-floatingtext-alignment").attr("disabled",!0),$("#mp-floatingtext-alignment").val("left")):($("#ft_alignment_title").removeClass("muted"),$("#mp-floatingtext-alignment").attr("disabled",!1))}function centerFloat(n){var t=n.replace(/:/,"_"),f=page_width*96,i=svg_IE.getElementById(t),o=i.transform.animVal.getItem(0).matrix,r=i.transform.animVal.getItem(1).angle,u=i.transform.animVal.getItem(2).matrix.a,s=parseInt(jQuery("#"+t).find("rect").attr("width"))*u,h=parseInt(jQuery("#"+t).find("rect").attr("height"))*u,c=o.f,e;e=r==90||r==270?f/2-h/2:f/2-s/2;jQuery("#"+t).attr("transform","translate("+e+","+c+") rotate("+r+" 0 0) scale("+u+")");updateFloat_xy(t)}function float_remove(n){if(n.indexOf("floatitem")>-1){var t=getItem("menufile"),r=reset.split(":"),i=r[1];delete t.float_text[i];jQuery("#floatitem_"+i).remove();setItem("menufile",t)}}function floattext_toPrev(){var n=getItem("menufile"),t=reset.split(":")[1];n.float_text[t].page_no=Math.max(0,page_no-1);setItem("menufile",n);iMenuPro.draw_floattext()}function floattext_toNext(){var n=getItem("menufile"),t=reset.split(":")[1];n.float_text[t].page_no=Math.min(page_no+1,10);setItem("menufile",n);iMenuPro.draw_floattext()}function resetSwitchMenuStyle(){var n=getItem("menufile");$('#myMenuStyleDialog [name="total_columns"]').val(n.total_columns)}function loadMenuStyleAsync(){var n=jQuery("#access_token").val(),t="/api/styles/"+n+"/"+Date.now(),i=$.ajax(t);i.then(function(n){jQuery("#dialog-menustyle-select").children().remove();jQuery("#dialog-menustyle-select").append(n)})}function resetFoodPhotoUploadUI(){$("#mp-fi-symmap").hide();$("#mp-fi-photomap, #mp-up-browse-noteFI").hide();$("#mp-fi-col1, #mp-fi-col2, #mp-fi-col3").show();$("#notes-collapse-icon").removeClass("icon-chevron-up");$("#notes-collapse-icon").addClass("icon-chevron-down");$("#mp-notes-field").hide();$("#mp-delete-fooditem-alert").hide();$("#myUploadPreviewFI").removeClass("dont_select_ptr");$("#mp-fooditembox-footer").show();$("#mp-fooditem-trashcan").show();$("#mp-photostate").hasClass("mp-newphoto")&&($("#jansyUploadWellFI").show(),jQuery("#myUploadPreviewFI").html('<img src="" >'),jQuery("#myUploadPreviewFI img").attr("src","bootstrap/img/68x51.png"));$("#mp-imgupload-deletepanelFI").hide();$("#mp-fi-useimg-div").show();$("#mp-fi-useimg-hr").show();$("#mp-imgupload-findFI").show();$("#mp-up-trash-divFI").show();$("#mp-imgupload-trashcanFI").hide();$("#mp-imgupload-searchFI").show();$("#mp-imgupload-cancel-selectFI").show();$("#mp-imgupload-selectFI").show();$("#mp-up-browse-noteFI").show();$("#jansy-img-uploadFI").fileupload("reset");reorder_rect();reset="";$("#mp-quick-find").val().length>0&&setTimeout(function(){$("#mp-quick-find").focus()},100);$("#myUploadImgListFI").megalist("clearSelectedIndex",-1);resetUISearchFI()}function place_on_menu(){var e=getItem("menufile"),t=reset.split(":"),o=t[1],u=t[2],n=t[3],s=t[7],f=_.indexOf(e.food_item.order,n),i,r;useDrawTo=isLastOrder()?page_no+"update_text_only":"ignore#fooditem_"+n;f==-1&&u=="fooditem"?(update_fooditem_menufile(n,null,"off_place"),jQuery("#fooditem-"+n).removeClass("icon-off-menu").addClass("icon-on-menu"),i=calculate_col_food(n),iMenuPro.print_fooditem(n,i),isUneven&&(r=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_fooditem(n,r,"isUneven"))):f==-1&&u=="headitem"&&(update_headitem_menufile(n,"onoff_drop"),jQuery("#headitem-"+n).removeClass("icon-off-menu").addClass("icon-on-menu"),i=calculate_col_width(null,"with_col_width")[0],iMenuPro.print_headitem(n,i,isTitleSpan(n)),isUneven&&(r=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_headitem(n,r,isTitleSpan(n),"isUneven")));reset="";setTimeout(function(){make_rect_active()},10)}function heading_group_up(){var t=getItem("menufile"),c=getResetID(),l=c[0],n=c[1],u,f,e,o,i,s,r,h;if(l=="headitem")if(u=t.food_item.order,f=_.union(n,list_foodgroup(n)),_.indexOf(u,n)==0)stop_spinner();else{if(e=list_heading(),o=_.indexOf(e,n),o==0){doAlert(272,null,2e3,!0);stop_spinner();return}mp_predo("heading_groupup",page_no);i=!1;s=e[o-1];isTitleSpan(s)&&(i=!0);r=_.difference(u,f);h=_.indexOf(r,s);t.food_item.order=_.union(r.slice(0,h),f,r.slice(h));setItem("menufile",t);global_columns==1?iMenuPro.drawto_text(page_no):iMenuPro.draw_text(page_no);$("#myHeadingList").megalist("setDataProvider",sortHeadData(t.head_item.header));isTitleSpan(n)&&(i=!0);i||setPredoOptimizer(!0)}}function heading_group_down(){var t=getItem("menufile"),e=getResetID(),l=e[0],n=e[1],r,o,i;if(l=="headitem")if(r=t.food_item.order,o=_.union(n,list_foodgroup(n)),_.last(o)==_.last(r))stop_spinner();else{i=!1;mp_predo("heading_groupdn",page_no);var s=list_heading(),a=_.indexOf(s,n),u=s[a+1];isTitleSpan(n)&&(i=!0);var h=_.union(u,list_foodgroup(u)),f=_.difference(r,h),c=_.indexOf(f,n);t.food_item.order=_.union(f.slice(0,c),h,f.slice(c));setItem("menufile",t);global_columns==1?iMenuPro.drawto_text(page_no):iMenuPro.draw_text(page_no);$("#myHeadingList").megalist("setDataProvider",sortHeadData(t.head_item.header));isTitleSpan(u)&&(i=!0);i||setPredoOptimizer(!0)}}function remove_from_menu(n){var f=getItem("menufile"),i=getResetID(),r=i[0],t=i[1],i="#"+r+"_"+t,e=_.indexOf(f.food_item.order,t.replace(/u$/,"")),y=jQuery(i).index(),h=jQuery("#textcanvas g").first().attr("id")==undefined?"":jQuery("#textcanvas g").first().attr("id").substr(9);var p=_.indexOf(f.food_item.order,h),c=list_titlespan(),l=list_foodgroup(t),o=t.replace(/u$/,""),s=t.replace(/u$/,"")+"u";e>-1&&r=="fooditem"?(n=="delete"?update_fooditem_menufile(t,null,"delete"):(mp_predo("fooditem_remove",page_no),update_fooditem_menufile(t,null,"on_remove")),jQuery("#fooditem-"+t.replace(/u$/,"")).removeClass("icon-on-menu").addClass("icon-off-menu"),jQuery("#fooditem_"+o).remove(),jQuery("#fooditem_"+s).remove()):e>-1&&r=="headitem"&&(n=="delete"?update_headitem_menufile(t,"off_edit"):(mp_predo("heading_remove",page_no),update_headitem_menufile(t,"off_edit")),$("#myHeadingList").megalist("setDataProvider",sortHeadData()),jQuery("#headitem-"+t.replace(/u$/,"")).removeClass("icon-on-menu").addClass("icon-off-menu"),jQuery("#headitem_"+o).remove(),jQuery("#headitem_"+s).remove());var a=list_titlespan(),v=_.difference(a,c),u=_.union(v,l);useDrawTo=page_no+"update_text_only";_.each(u,function(n){var t=n.replace(/u$/,""),i=n.replace(/u$/,"")+"u";n.indexOf("h")>-1?(jQuery("#headitem_"+t).remove(),jQuery("#headitem_"+i).remove()):(jQuery("#fooditem_"+t).remove(),jQuery("#fooditem_"+i).remove())});_.each(u,function(n){var i,t;n.indexOf("h")>-1?(i=calculate_col_width(null,"with_col_width")[0],iMenuPro.print_headitem(n,i,isTitleSpan(n)),isUneven&&(t=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_headitem(n,t,isTitleSpan(n),"isUneven"))):(i=calculate_col_food(n),iMenuPro.print_fooditem(n,i),t=calculate_col_width(null,"with_col_width")[0],isUneven&&(t=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_fooditem(n,t,"isUneven")))});u.length==0&&iMenuPro.drawto_text(page_no,"update_text_only");$("#textcanvas g").length<=0&&$("#colline").children().remove();reset=""}function resetDeleteFoodDialog(){var n=reset.split(":"),t=n[3],i=n[1];jQuery("#mp-fooditem-to-delete").html(jQuery("#fooditem-"+t).next().text())}function deleteFoodID(n,t,i){var r=jQuery("#access_token").val(),u="/api/food/"+n+"/"+r;jQuery.ajax({url:u,type:"DELETE",dataType:"json",success:function(r){r.status=="OK"?(reset="editing-index-noEditR:"+t+":fooditem:"+n+":list-index:"+i,remove_from_menu("delete"),updateSingleFoodItem("delete",t,i,null,null)):doAlert(86,null,0,!0)}});jQuery("#myDeleteFoodItem").modal("hide");jQuery("#myFoodItemDialog").modal("hide");reset="";fooditem_changed=!1;fooditem_span_changed=!1;fooditem_new=!1}function updateFoodItemModal(n,t){var r=JSON.parse(sessionStorage.getItem("menufile")),f=r.food_item["default"],e=_.indexOf(r.food_item.order,t),i,u;r.food_item[t+""]!=undefined&&(f=r.food_item[t+""]);n?(encodeFoodsOldway?(jQuery(".spanNameFoodItem").val(decodeURIComponent(n.name).decodeEntities()),jQuery(".spanDescFoodItem").val(decodeURIComponent(n.description).decodeEntities()),jQuery(".spanExtrasFoodItem").val(decodeURIComponent(n.extras).decodeEntities())):(jQuery(".spanNameFoodItem").val(decodeURIComponent(n.name)),jQuery(".spanDescFoodItem").val(decodeURIComponent(n.description)),jQuery(".spanExtrasFoodItem").val(decodeURIComponent(n.extras))),jQuery(".spanPriceFoodItem").val(decodeURIComponent(n.price.replace(/%$/,"").replace(/%2$/,"")).decodeEntities()),jQuery(".spanNotesTextArea").val(decodeURIComponent(n.notes).decodeEntities()),jQuery("#mp-fooditembox-next").attr("disabled",!0),$("#mp-fooditem-trashcan").show()):(setTimeout(function(){$("#mp-fooditembox-next").prop("disabled",!1)},300),jQuery(".spanNameFoodItem").val(""),jQuery(".spanDescFoodItem").val(""),jQuery(".spanPriceFoodItem").val(""),jQuery(".spanExtrasFoodItem").val(""),jQuery(".spanNotesTextArea").val(""),$("#mp-fooditem-trashcan").hide());i=f.split(";");i[2]=i[2]?i[2].replace(/&#59/g,";").replace(/&#58/g,":"):"";i[9]=="Style"&&(u=JSON.parse(sessionStorage.getItem("origCSS")),i[10]=u[".name"]["space-before"],i[11]=u[".name"]["space-after"]);i[0]=="none"?(jQuery("#mp-fi-sym1").removeClass("mp-syms"),jQuery("#mp-fi-sym1").addClass("mp-syms-none"),jQuery("#mp-fi-sym1").text("none")):(jQuery("#mp-fi-sym1").addClass("mp-syms"),jQuery("#mp-fi-sym1").removeClass("mp-syms-none"),jQuery("#mp-fi-sym1").text(i[0].replace("&#59",";")));i[1]=="none"?(jQuery("#mp-fi-sym2").removeClass("mp-syms"),jQuery("#mp-fi-sym2").addClass("mp-syms-none"),jQuery("#mp-fi-sym2").text("none")):(jQuery("#mp-fi-sym2").addClass("mp-syms"),jQuery("#mp-fi-sym2").removeClass("mp-syms-none"),jQuery("#mp-fi-sym2").text(i[1].replace("&#59",";")));jQuery(".spanBinNumberFoodItem").val(decodeURIComponent(i[2]));jQuery("#mp-fooditembox-center").prop("checked",parseInt(i[3]));jQuery("#mp-fooditembox-withname").prop("checked",parseInt(i[4]));jQuery("#mp-fooditembox-wraplines").prop("checked",parseInt(i[5]));jQuery("#mp-fooditembox-boxaccent").selectpicker("val",i[6]);jQuery("#dialog-food-accent-color").spectrum("set",i[7]);jQuery("input[name=FoodItemSpacing][value="+i[9]+"]").prop("checked",!0);jQuery("#mp-fooditembox-before").val(numToNum(i[10],"in",unitSI,!1));jQuery("#mp-fooditembox-after").val(numToNum(i[11],"in",unitSI,!1));i[12]!=""&&i[12]!="bootstrap/img/68x51.png"?(jQuery("#myUploadPreviewFI img").attr("src",i[12]),editImage=i[12],$("#jansyUploadWellFI").hide(),$("#jansyRemoveWellFI").show(),$("#mp-photostate").removeClass("mp-newphoto"),$("#mp-photostate").addClass("mp-editphoto")):(jQuery("#myUploadPreviewFI img").attr("src","bootstrap/img/68x51.png"),editImage="",$("#jansyUploadWellFI").show(),$("#jansyRemoveWellFI").hide(),$("#mp-photostate").addClass("mp-newphoto"),$("#mp-photostate").removeClass("mp-editphoto"));$("#mp-fooditembox-span").prop("checked",parseInt(i[13]));changeFoodItemCustomSpacing();e>-1?jQuery("#mp-fooditembox-onmenu").prop("checked",!0):jQuery("#mp-fooditembox-onmenu").prop("checked",!1);$("#mp-notes-field").hide();$("#notes-collapse-icon").removeClass("icon-chevron-up");$("#notes-collapse-icon").addClass("icon-chevron-down");$("#mp-fi-col1, #mp-fi-col2, #mp-fi-col3").show();$("#mp-fi-symmap").hide();$("#mp-fi-photomap, #mp-up-browse-noteFI").hide()}function sortHeadData(n){var i=JSON.parse(sessionStorage.getItem("menufile")),t;if(n||(n=i.head_item.header),!1)t={heading:"asc",type:"asc"},n.keySort(t);else if(!0&&(t={heading:"asc",type:"asc"},n.keySort(t),i.head_item.header.length>0)){var r=[],u=_.pluck(n,"head_id"),f=i.food_item.order;_.each(f,function(t){var i=_.indexOf(u,t+"");i>-1&&r.push(n[i])});n=_.union(r,n)}return n}function sortFoodData(n){var l=jQuery("#mp-sort-bydate-icon").attr("class")=="icon-ok",e=jQuery("#mp-sort-byalpha-icon").attr("class")=="icon-ok",o=jQuery("#mp-sort-byorder-icon").attr("class")=="icon-ok",s=jQuery("#mp-sort-bynote-icon").attr("class")=="icon-ok",n,t,i;if(n||(n=JSON.parse(sessionStorage.getItem("fooditem"))),e)t={name:"asc",description:"asc",price:"asc",extras:"asc"},n.keySort(t);else if(o){if(t={name:"asc",description:"asc",price:"asc",extras:"asc"},n.keySort(t),i=JSON.parse(sessionStorage.getItem("menufile")),i){var r=[],h=_.pluck(n,"food_id"),c=i.food_item.order;_.each(c,function(t){var i=_.indexOf(h,t+"");i>-1&&r.push(n[i])});n=_.union(r,n)}}else if(s){var t={notes:"asc",name:"asc",description:"asc",price:"asc",extras:"asc"},u=[],f=[];n.keySort(t);_.each(n,function(n){n.notes.split("%0A")[0]==""?u.push(n):f.push(n)});n=_.union(f,u)}return n}function sortCuFonts(n){if(n!=null&&n!=[])return n.keySort({filename:"asc"});return[]}function filterFONT(n){return _.filter(n,function(n){return n.category.match(/font/gi)})}function filterImage(n){return _.filter(n,function(n){return!n.category.match(/font/gi)})}function searchFoodData(){var n=jQuery("#mp-quick-find").val(),t=JSON.parse(sessionStorage.getItem("fooditem")),r=jQuery("#dialog-setting-findall").prop("checked"),u=jQuery("#dialog-setting-findnotes").prop("checked"),i;n.length>0?(i=_.filter(t,function(t){return n=="{blank}"?t.name==""&&t.description==""&&t.price==""&&t.extras=="":r&&u?decodeURIComponent(t.name).match(new RegExp(n,"ig"))||decodeURIComponent(t.description).match(new RegExp(n,"ig"))||decodeURIComponent(t.price.replace(/%$/,"").replace(/%2$/,"")).match(new RegExp(n,"ig"))||decodeURIComponent(t.extras).match(new RegExp(n,"ig"))||decodeURIComponent(t.notes).match(new RegExp(n,"ig")):r?decodeURIComponent(t.name).match(new RegExp(n,"ig"))||decodeURIComponent(t.description).match(new RegExp(n,"ig"))||decodeURIComponent(t.price.replace(/%$/,"").replace(/%2$/,"")).match(new RegExp(n,"ig"))||decodeURIComponent(t.extras).match(new RegExp(n,"ig")):u?decodeURIComponent(t.name).match(new RegExp(n,"ig"))||decodeURIComponent(t.notes).match(new RegExp(n,"ig")):decodeURIComponent(t.name).match(new RegExp(n,"ig"))}),$("#myFoodList").css("height","0px"),jQuery("#myFoodList").addClass("bluehalo"),jQuery("#myFoodList").megalist("setDataProvider",sortFoodData(i)),fixFoodData(i),$("#myFoodList").megalist("setSelectedIndexMove",-1)):(jQuery("#myFoodList").megalist("setDataProvider",sortFoodData(t)),jQuery("#myFoodList").removeClass("bluehalo"),fixFoodData(t),$("#myFoodList").megalist("setSelectedIndexMove",parseInt(searchpos.slice(9)/41)),$("#myFoodList").megalist("clearSelectedIndex",parseInt(searchpos.slice(9)/41)),searchpos="")}function changeFoodItemCustomSpacing(){var t=jQuery("input[name=FoodItemSpacing]:checked").val();if(t=="Custom")jQuery("#mp-fooditembox-before").prop("disabled",!1),jQuery("#mp-fooditembox-after").prop("disabled",!1),$(".SpacingTextFd").removeClass("muted");else{var n=JSON.parse(sessionStorage.getItem("origCSS")),i=numToNum(n[".name"]["space-before"],"in",unitSI,!1),r=numToNum(n[".name"]["space-after"],"in",unitSI,!1);jQuery("#mp-fooditembox-before").val(i);jQuery("#mp-fooditembox-after").val(r);jQuery("#mp-fooditembox-before").prop("disabled",!0);jQuery("#mp-fooditembox-after").prop("disabled",!0);$(".SpacingTextFd").addClass("muted")}}function drawUserImageFI(n,t){bmpTestWarn(n);jQuery("#jansy-img-uploadFI").fileupload("reset");jQuery("#myUploadPreviewFI").html('<img src="" >');jQuery("#myUploadPreviewFI img").attr("src",n);jQuery("#myUploadPreviewFI img").attr("class",t)}function addFoodImage(n){var s=getItem("menufile"),t=jQuery("#myUploadPreviewFIUPLOAD img").attr("src"),r=numToNum(jQuery("#dialog-ui-left").val(),unitSI,"px",!0),u=numToNum(jQuery("#dialog-ui-top").val(),unitSI,"px",!0);if(r=isNaN(r)?0:r,u=isNaN(u)?0:u,t==""||t==undefined||t=="bootstrap/img/68x51.png"||t.indexOf("amazonaws.com")>-1)$("#myUploadPreviewFIUPLOAD").text()!=""&&(drawUserImageFI("bootstrap/img/68x51.png",""),doAlert(322,null,3e3,!0)),addFoodID(n);else if(t!="bootstrap/img/68x51.png"&&t!=undefined&&t.length<4199999){doAlert(106,"",3e3,!0);var f=jQuery("#file-imguploadFI").val().replace(/^.*\\|\.[^.]*$/g,""),e=jQuery("#access_token").val(),i=newXMLHttpRequest(),o="access_token="+e+"&filename="+encodeURIComponent(f)+"&myimage="+t;i.open("POST","/tools/token-S3upload",!0);i.setRequestHeader("Content-type","application/x-www-form-urlencoded");i.send(o);i.onreadystatechange=function(){if(i.readyState==4&&i.status==200){var t=JSON.parse(i.responseText);jQuery("#mp-acct-images").text(t.count);t.error?(drawUserImageFI("bootstrap/img/68x51.png",""),doAlert(t.error,"danger",8e3,!0),addFoodID(n)):t.success=="demo"?$("#mp-fooditembox-ok, #dialog-fooditem-cancel, #dialog-fooditem-x").prop("disabled",!1):(doAlert(6,null,1e3,!0),jQuery("#myUploadPreviewFI img").attr("src",t.success),jQuery("#myUploadPreviewFI img").attr("class",t.idx),importImageData(),addFoodID(n),$("#jansy-img-uploadFI").fileupload("reset"))}}}else t.length>4194499&&(fooditem_changed=!0,doAlert(104,"danger",7e3,!0),$("#mp-fooditembox-ok, #dialog-fooditem-cancel, #dialog-fooditem-x").prop("disabled",!1))}function fixEntitiesHackx(n){var t,i=new RegExp(/(<[\/]?[a-z][a-z0-9]*?\b>?)/ig);return t=n.replace(/<([c|u|b|i|s])>(\s*)<\/\1>/ig,"$2"),t=t.replace(/<([c|u|b|i|s])>(\s*)<\/\1>/ig,"$2"),outstr2=t.replace(i,function(n,t){return t[t.length-1]!=">"?"< "+t.substr(1):t})}function addFoodID(n){var a=jQuery("#access_token").val(),v=JSON.parse(sessionStorage.getItem("origCSS")),it=v[".name"]["space-before"],rt=v[".name"]["space-after"],e=jQuery(".spanNameFoodItem").val(),i=jQuery(".spanDescFoodItem").val(),r=jQuery(".spanExtrasFoodItem").val(),s=jQuery(".spanNotesTextArea").val(),ut=jQuery(".spanPriceFoodItem").val().replace(/^\ +/g,"").replace(/\; +/g,";"),tt,u,l;allblanks(i)&&(i="");allblanks(r)&&(r="");allblanks(s)&&(s="");e=fixEntitiesHackx(e.decodeLTGT());i=fixEntitiesHackx(i.decodeLTGT());r=fixEntitiesHackx(r.decodeLTGT());settings.imenupro.fcodes&&$("#mp-fooditembox-onmenu").prop("checked")&&(mismatchedTags(e)===!0||mismatchedTags(i)===!0||mismatchedTags(r)===!0)&&doAlert(344,null,9e3,!0);var y=encodeData(e),p=encodeData(i),w=encodeData(r),b=encodeData(ut),k=encodeData(s),o=jQuery("#mp-fooditembox-onmenu").prop("checked")?1:0,ft=jQuery("#mp-fi-sym1").text().replace(/;/g,"&#59"),et=jQuery("#mp-fi-sym2").text().replace(/;/g,"&#59"),ot=encodeData(jQuery(".spanBinNumberFoodItem").val().decodeEntities().replace(/^\ +/g,"")),st=jQuery("#mp-fooditembox-center").prop("checked")?1:0,ht=jQuery("#mp-fooditembox-withname").prop("checked")?1:0,ct=jQuery("#mp-fooditembox-wraplines").prop("checked")?1:0,f=jQuery("#mp-fooditembox-boxaccent option:selected").val();(f==null||f==undefined||f=="")&&(f="(none)");var lt=jQuery("#dialog-food-accent-color").spectrum("get").toRgbString(),d=jQuery("input[name=FoodItemSpacing]:checked").val(),at=numToNum(jQuery("#mp-fooditembox-before").val(),unitSI,"in",!0),vt=numToNum(jQuery("#mp-fooditembox-after").val(),unitSI,"in",!0),g=numCheck(at,"-0.2","8.0",it,!0),nt=numCheck(vt,"0.0","8.0",rt,!0),h=jQuery("#myUploadPreviewFI img").attr("src");if(h=="bootstrap/img/68x51.png"&&(h=""),tt=jQuery("#mp-fooditembox-span").prop("checked")?1:0,d=="Style"&&(g="",nt=""),u=ft+";"+et+";"+ot+";"+st+";"+ht+";"+ct+";"+f+";"+lt+";;"+d+";"+g+";"+nt+";"+h+";"+tt,reset.slice(0,13)=="editing-index"){var c=reset.split(":"),t=c[3].toString(),yt=c[1],pt=c[5],wt=jQuery("#fooditem_"+t+" rect").attr("x"),bt=jQuery("#fooditem_"+t+" rect").attr("y"),kt=jQuery("#fooditem_"+t+" text").attr("y"),l="/api/food/"+t+"/"+a+"/"+base64.encode(y+":"+p+":"+w+":"+k+":"+b);jQuery.post(l,function(n){var i,r,s,h,c,l,f,e,a,v;n.status=="OK"?(updateSingleFoodItem("edit",yt,pt,n.fooditem,null),i=getItem("menufile"),r=jQuery("#textcanvas g").length>0?jQuery("#textcanvas g").last().attr("id").replace(/u$/,""):undefined,useDrawTo=page_no+"update_text_only",r!=undefined&&(s=_.indexOf(i.food_item.order,r.slice(9)),h=_.indexOf(i.food_item.order,t),h>s+1&&(useDrawTo="ignore#fooditem_"+t)),o?fooditem_span_changed==!1?(update_fooditem_menufile(t,u,"on_edit"),c=calculate_col_food(t),iMenuPro.print_fooditem(t,c),isUneven&&(l=calculate_col_width(null,"only")[1],iMenuPro.print_fooditem(t,l,"isUneven"))):(f=list_titlespan(),update_fooditem_menufile(t,u,"on_edit"),e=list_titlespan(),a=_.union(_.difference(f,e),_.difference(e,f),[t]),jQuery.each(a,function(n,i){var f,r,u;i.indexOf("h")>-1?(r=calculate_col_width(null,"with_col_width")[0],f=isTitleSpan(i),iMenuPro.print_headitem(i,r,f),isUneven&&(u=calculate_col_width(null,"only")[1],iMenuPro.print_headitem(i,u,f,"isUneven"))):(r=calculate_col_food(i),iMenuPro.print_fooditem(i,r),isUneven&&(u=calculate_col_width(null,"only")[1],iMenuPro.print_fooditem(t,u,"isUneven")))})):(remove_from_menu(),update_fooditem_menufile(t,u,"off_edit")),fooditem_span_changed=!1,byorderonmenu_refresh_needed&&(v=JSON.parse(sessionStorage.getItem("fooditem")),jQuery("#myFoodList").megalist("setDataProvider",sortFoodData(v)),jQuery("#myFoodList").megalist("setSelectedIndexEditR",-1),byorderonmenu_refresh_needed=!1),o?jQuery("#fooditem-"+t).removeClass("icon-off-menu").addClass("icon-on-menu"):jQuery("#fooditem-"+t).removeClass("icon-on-menu").addClass("icon-off-menu"),make_rect_active()):n.status=="failed"&&doAlert(86,null,0,!0)},"json").fail(function(n,t){t=="timeout"||n.responseJSON==undefined?(doAlert(214,null,9e3,!0),console.log("Connection seems dead! (food)")):n.responseJSON.error=="invalid_client"?(doAlert(216,null,9e3,!0),console.log("Token has expired! (food)")):(doAlert(218,null,9e3,!0),console.log("Something failed on server! (food)"))})}else l="/api/food/new/"+a+"/"+base64.encode(y+":"+p+":"+w+":"+k+":"+b),jQuery.post(l,function(n){var t,i,r;n.status=="OK"?(updateSingleFoodItem("new",null,null,n.fooditem,n.result),o?(jQuery("#fooditem-"+n.result+"").removeClass("icon-off-menu").addClass("icon-on-menu"),useDrawTo=isLastOrder()==!0?page_no+"update_text_only":"ignore#fooditem_"+n.result,update_fooditem_menufile(n.result+"",u,"on_edit"),t=calculate_col_food(n.result),iMenuPro.print_fooditem(n.result,t),isUneven&&(i=calculate_col_width(null,"only")[1],iMenuPro.print_fooditem(n.result,i,"isUneven")),byorderonmenu_refresh_needed&&(r=JSON.parse(sessionStorage.getItem("fooditem")),jQuery("#myFoodList").megalist("setDataProvider",sortFoodData(r)),byorderonmenu_refresh_needed=!1)):update_fooditem_menufile(n.result.toString(),u,"off_edit")):n.status=="limit"&&(doAlert(84,null,0,!0),reset="");make_rect_active()},"json");updateFoodItemModal();n=="mp-fooditembox-next"?(drawUserImageFI("bootstrap/img/68x51.png",""),jQuery("#jansy-img-uploadFI").fileupload("reset")):jQuery("#myFoodItemDialog").modal("hide");(o||jQuery("#mp-fooditembox-onmenu").prop("checked")==1)&&undostate[mui]=="na"&&(menu_changes=++menu_changes)}function update_fooditem_menufile(n,t,i){var r,u,f;n!=undefined&&(n=n.replace(/u$/,""));r=JSON.parse(sessionStorage.getItem("menufile"));i=="on_edit"?(r.food_item.order=_.union(r.food_item.order,n),r.food_item[n]=t):i=="onoff_drop"?(r.food_item.order=_.union(r.food_item.order,n),r.food_item[n]||(r.food_item[n]=r.food_item["default"])):i=="on_remove"||i=="off_edit_notweak"?r.food_item.order=orderRemove(n):i=="on_moveup"?(u=_.indexOf(r.food_item.order,n),u!=0&&(f=_.without(r.food_item.order,n),r.food_item.order=_.union(f.slice(0,u-1),n,f.slice(u-1,f.length)))):i=="on_movedown"?(u=_.indexOf(r.food_item.order,n),u!=r.food_item.order.length&&(f=_.without(r.food_item.order,n),r.food_item.order=_.union(f.slice(0,u+1),n,f.slice(u+1,f.length)))):i=="off_edit"?(r.food_item[n]=t,r.food_item.order=orderRemove(n)):i=="off_place"?(r.food_item.order=_.union(r.food_item.order,n),r.food_item[n]||(r.food_item[n]=r.food_item["default"])):i=="delete"&&(delete r.food_item[n],r.food_item.order=orderRemove(n));sessionStorage.setItem("menufile",JSON.stringify(r))}function processFoodData(n){if(n.match("food_id")){sessionStorage.setItem("fooditem",n);var t=JSON.parse(n);fixFoodData(t);$("#myFoodList").megalist("setDataProvider",sortFoodData(t))}else sessionStorage.setItem("fooditem","[]");megaloggedin||(megaloggedin=!0)}function fixFoodData(n){var t=7,i,r=$(window).height();i=r<649&&!isNaN(r)?5:7;t=$("#mp-long-list-icon").hasClass("icon-ok")?13:i;typeof n=="boolean"?$("#myFoodList").css("height","0px"):n.length<=t-1?$("#myFoodList").css("height",41*n.length-1+"px"):$("#myFoodList").css("height",41*t-1+"px")}function fixAI(n){var t=5;typeof n=="boolean"?$("#myArtisanList").css("height","0px"):n.length<=t-1?$("#myArtisanList").css("height",61*n.length-1+"px"):$("#myArtisanList").css("height",61*t-1+"px")}function dataReceived(n){sessionStorage.setItem("fooditem",JSON.stringify(n.results));var t=JSON.parse(sessionStorage.getItem("fooditem"));$("#myFoodList").megalist("setDataProvider",sortFoodData(t))}function updateSingleFoodItem(n,t,i,r,u){var s,h,c,l,a;jQuery("#myFoodList").removeClass("bluehalo");s=jQuery("#mp-quick-find").val();jQuery("#mp-quick-find").val("");var f=JSON.parse(sessionStorage.getItem("fooditem")),o=f.length,e=base64.decode(r).split(":");n=="new"?(f[o]={},f[o].food_id=u,f[o].name=e[0],f[o].description=e[1],f[o].extras=e[2],f[o].notes=e[3],f[o].price=e[4]):n=="delete"?f.splice(parseInt(t),1):(h=f[t].food_id,f[t].name=e[0],f[t].description=e[1],f[t].extras=e[2],f[t].notes=e[3],f[t].price=e[4]);sessionStorage.setItem("fooditem",JSON.stringify(f));fixFoodData(f);jQuery("#myFoodList").megalist("setDataProvider",sortFoodData(f));n=="new"?(jQuery("#mp-sort-byalpha-icon").attr("class")=="icon-ok"?jQuery("#myFoodList").megalist("setSelectedIndex",-1):jQuery("#mp-sort-byorder-icon").attr("class")=="icon-ok"?(byorderonmenu_refresh_needed=!0,jQuery("#myFoodList").megalist("setSelectedIndex",-1)):jQuery("#myFoodList").megalist("setSelectedIndexMove",o),reGauge("db")):n=="delete"?(s==""?(c=parseInt(i)==o-1?parseInt(i)-1:i,jQuery("#myFoodList").megalist("setSelectedIndexEditR",c)):($("#myFoodList").megalist("setSelectedIndexMove",parseInt(searchpos.slice(9)/41)),$("#myFoodList").megalist("clearSelectedIndex",parseInt(searchpos.slice(9)/41)),searchpos=""),reGauge("db")):s==""?reset.indexOf("noEditR")>-1?(l=_.pluck(sortFoodData(f),"food_id"),a=_.indexOf(l,h),jQuery("#myFoodList").megalist("setSelectedIndexMove",a)):$("#mp-sort-byorder-icon").attr("class")=="icon-ok"?byorderonmenu_refresh_needed=!0:(jQuery("#myFoodList").megalist("setSelectedIndexEditR",t),jQuery("#myFoodList").megalist("setSelectedIndex",i)):($("#mp-sort-byorder-icon").attr("class")=="icon-ok"?byorderonmenu_refresh_needed=!0:($("#myFoodList").megalist("setSelectedIndexMove",parseInt(searchpos.slice(9)/41)),$("#myFoodList").megalist("clearSelectedIndex",parseInt(searchpos.slice(9)/41))),searchpos="")}function listFoodItemFunctionNoHtml(n){var r=JSON.parse(sessionStorage.getItem("menufile")),i="icon-off-menu",t="&nbsp;{blank}",u;return n.name?t="&nbsp;"+decodeURIComponent(n.name).decodeEntities().encodeEntities():n.description?t="&nbsp;"+decodeURIComponent(n.description).decodeEntities().encodeEntities():n.price?t="&nbsp;"+decodeURIComponent(n.price.replace(/%$/,"").replace(/%2$/,"")).decodeEntities().encodeEntities():n.extras&&(t="&nbsp;"+decodeURIComponent(n.extras).decodeEntities().encodeEntities()),r&&(u=r.food_item.order,i=u.indexOf(n.food_id)>-1?"icon-on-menu":"icon-off-menu"),n.notes!=""?jQuery("#mp-show-notes-icon").attr("class")=="icon-ok"?'<i class="'+i+'" id="fooditem-'+n.food_id+'" ><\/i>'+t+'<br><span class="MPNotesFont ">'+decodeURIComponent(n.notes)+"<\/span>":'<i class="'+i+'" id="fooditem-'+n.food_id+'"><\/i>'+t+'<br><span class="MPNotesFont hide ">'+decodeURIComponent(n.notes)+"<\/span>":'<i class="'+i+'" id="fooditem-'+n.food_id+'"><\/i>'+t}function listFoodItemFunction(n){var r=JSON.parse(sessionStorage.getItem("menufile")),i="icon-off-menu",t='<span class="fooditem-blank">&nbsp;{blank}<\/span>',u;return!n.name||n.description||n.extras?n.name?t='<span class="fooditem-name">'+decodeURIComponent(n.name).decodeEntities().encodeEntities()+"<\/span>":n.description?t='<span class="fooditem-description">'+decodeURIComponent(n.description).decodeEntities().encodeEntities()+"<\/span>":n.price?t='<span class="fooditem-price">'+decodeURIComponent(n.price.replace(/%$/,"").replace(/%2$/,"")).decodeEntities().encodeEntities()+"<\/span>":n.extras&&(t='<span class="fooditem-extras">'+decodeURIComponent(n.extras).decodeEntities().encodeEntities()+"<\/span>"):t='<span class="fooditem-nameprice">'+decodeURIComponent(n.name).decodeEntities().encodeEntities()+"<\/span>",r&&(u=r.food_item.order,i=u.indexOf(n.food_id)>-1?"icon-on-menu":"icon-off-menu"),n.notes!=""?$("#mp-show-notes-icon").attr("class")=="icon-ok"?'<i class="'+i+'" id="fooditem-'+n.food_id+'" ><\/i>&nbsp;'+t+'<br><span class="MPNotesFont ">'+decodeURIComponent(n.notes)+"<\/span>":'<i class="'+i+'" id="fooditem-'+n.food_id+'"><\/i>&nbsp;'+t+'<br><span class="MPNotesFont hide ">'+decodeURIComponent(n.notes)+"<\/span>":'<i class="'+i+'" id="fooditem-'+n.food_id+'"><\/i>&nbsp;'+t}function listFoodItemFunctionWide(n){var u=JSON.parse(sessionStorage.getItem("menufile")),t="icon-off-menu",r='<span class="fooditem-name WfwN"><\/span>',f='<span class="fooditem-description WfwD"><\/span>',e='<span class="fooditem-price WfwP"><\/span>',o='<span class="fooditem-extras WfwE"><\/span>',i,s;return n.name||n.description||n.price||n.extras?(n.name&&(r=!n.name||n.description||n.extras?'<span class="fooditem-name WfwN">'+decodeURIComponent(n.name).decodeEntities().encodeEntities()+"<\/span>":'<span class="fooditem-nameprice WfwN">'+decodeURIComponent(n.name).decodeEntities().encodeEntities()+"<\/span>"),n.description&&(f='<span class="fooditem-description WfwD">'+decodeURIComponent(n.description).decodeEntities().encodeEntities()+"<\/span>"),n.price&&(e='<span class="fooditem-price WfwP">'+decodeURIComponent(n.price.replace(/%$/,"").replace(/%2$/,"")).decodeEntities().encodeEntities()+"<\/span>"),n.extras&&(o='<span class="fooditem-extras WfwE">'+decodeURIComponent(n.extras).decodeEntities().encodeEntities()+"<\/span>")):r='<span class="fooditem-blank WfwN">&nbsp;{blank}<\/span>',i=r+f+e+o,u&&(s=u.food_item.order,t=s.indexOf(n.food_id)>-1?"icon-on-menu":"icon-off-menu"),n.notes!=""?$("#mp-show-notes-icon").attr("class")=="icon-ok"?'<i class="'+t+'" id="fooditem-'+n.food_id+"\" ><\/i><span class='megaflex'>&nbsp;"+i+'<\/span><div class="MPNotesFont WfwNt">'+decodeURIComponent(n.notes)+"<\/div>":'<i class="'+t+'" id="fooditem-'+n.food_id+"\" ><\/i><span class='megaflex'>&nbsp;"+i+'<\/span><div class="MPNotesFont WfwNt hide ">'+decodeURIComponent(n.notes)+"<\/div>":'<i class="'+t+'" id="fooditem-'+n.food_id+"\" ><\/i><span class='megaflex'>&nbsp;"+i+"<\/span>"}function listHeadItemFunctionNoHtml(n){var i=JSON.parse(sessionStorage.getItem("menufile")),r="icon-off-menu",t,u;return t="ontouchstart"in document||navigator.msMaxTouchPoints?"&nbsp;{blank}":'<span class="fooditem-blank">&nbsp;{blank}<\/span>',n.heading&&(t='<span class="fooditem-name">'+decodeURIComponent(n.heading).decodeEntities().encodeEntities()+"<\/span>"),i&&(u=i.food_item.order,r=u.indexOf(n.head_id)>-1?"icon-on-menu":"icon-off-menu"),'<i class="'+r+'" id="headitem-'+n.head_id+'"><\/i>&nbsp;'+t}function listMenuTitle(n){var r=getItem("menufile"),i,t;return i=n.name?n.name:"{blank}",r!=undefined&&parseInt(r.menuID)==parseInt(n.menu_id)&&(i='<span style="color:#5bb75b">'+i+"<\/span>"),t=new Date(0),t.setUTCSeconds(parseInt(n.last_update)),$("#mp-openmenu-preview-icon").hasClass("icon-list")?'<i class="icon-menufile"><\/i><span class="fooditem-name" id="menuid_'+n.menu_id+'"> '+i+'<br><\/span><br><span class="MPDateFont"><i class="icon-off-menu"><\/i>'+t.toString().slice(4,7)+"-"+t.getDate()+"-"+t.getFullYear()+"  "+t.toLocaleTimeString().replace(/((?:[^\:]*\:[^\:]*))(.*)( .*)$/,"$1$3")+"<\/span>":'<span class="fooditem-name" id="menuid_'+n.menu_id+'"> '+i+'<span class="MPDateFont"> &ndash; '+t.toString().slice(4,7)+"-"+t.getDate()+"-"+t.getFullYear()+'<\/span><br><\/span><br><img class="mp-ftn" url="https://'+s3bkt+".s3.amazonaws.com/"+s3path+"/thumb-menu-"+n.menu_id+'.jpg" src="https://'+s3bkt+".s3.amazonaws.com/"+s3path+"/thumb-menu-"+n.menu_id+".jpg?"+getJPGtime(n.menu_id)+'" >'}function reGauge(n){var t,i,r;$(".gaugevals").is(":visible")&&!demoMenu&&(n==="menu"?(t=getItem("menufile"),$("#mp-cmenu-items").text(parseInt(t.food_item.order.length))):n==="db"&&(i=jQuery("#access_token").val(),r=Date.now(),jQuery.getJSON("/api/food/count/"+i+"/"+r,function(n){n.status=="OK"&&$("#mp-acct-fooditem").text(n.total)})))}function toggleListWidth(n,t){$("#mp-thin-list-icon").removeClass("icon-ok");$("#mp-thin-list-icon").addClass("no-menu-icon");$("#mp-wide-list-icon").removeClass("icon-ok");$("#mp-wide-list-icon").addClass("no-menu-icon");$(n).removeClass("no-menu-icon");$(n).addClass("icon-ok");n=="#mp-wide-list-icon"?($(".MPClassicView").animate({marginLeft:627},200),$("#mp-food-sidebar").addClass("MPWideView"),$("#myHeadingList").addClass("MPWideView"),$("#myFoodList").addClass("megawide"),$("#myFoodList").megalist("setLabelFunction",listFoodItemFunctionWide),$(".gaugevals").show(),$("#nowidestance").html("Â«"),$("#nowidestance").attr("title","Thin list"),$("#foodbtngdiv").css("margin-bottom","-1px"),$("#mp-quick-find").animate({width:225},200),reGauge("db"),reGauge("menu")):($("#nowidestance").html("Â»"),$("#nowidestance").attr("title","Wide list"),$(".gaugevals").hide(),$("#foodbtngdiv").css("margin-bottom","0"),$("#mp-quick-find").css("width",180),$(".MPClassicView").css("margin-left","262px"),$("#mp-food-sidebar").removeClass("MPWideView"),$("#myHeadingList").removeClass("MPWideView"),$("#myFoodList").removeClass("megawide"),"ontouchstart"in document.documentElement||navigator.msMaxTouchPoints?$("#myFoodList").megalist("setLabelFunction",listFoodItemFunctionNoHtml):$("#myFoodList").megalist("setLabelFunction",listFoodItemFunction));t!="login"&&storeViewSettings()}function toggleListSize(n,t){$("#mp-short-list-icon").removeClass("icon-ok");$("#mp-short-list-icon").addClass("no-menu-icon");$("#mp-long-list-icon").removeClass("icon-ok");$("#mp-long-list-icon").addClass("no-menu-icon");$(n).removeClass("no-menu-icon");$(n).addClass("icon-ok");var i=JSON.parse(sessionStorage.getItem("fooditem"));jQuery("#myFoodList").megalist("setDataProvider",sortFoodData(i));fixFoodData(i);$("#myFoodList").megalist("setSelectedIndexMove",-1);t!="login"&&storeViewSettings()}function toggleViewFoods(n,t){$("#mp-sort-bydate-icon").removeClass("icon-ok");$("#mp-sort-bydate-icon").addClass("no-menu-icon");$("#mp-sort-byorder-icon").removeClass("icon-ok");$("#mp-sort-byorder-icon").addClass("no-menu-icon");$("#mp-sort-byalpha-icon").removeClass("icon-ok");$("#mp-sort-byalpha-icon").addClass("no-menu-icon");$("#mp-sort-bynote-icon").removeClass("icon-ok");$("#mp-sort-bynote-icon").addClass("no-menu-icon");$(n).removeClass("no-menu-icon");$(n).addClass("icon-ok");searchFoodData();t!="login"&&(storeViewSettings(),!sort_bynote_shown&&n=="#mp-sort-bynote-icon"&&$("#mp-hide-notes-icon").hasClass("icon-ok")&&(doAlert(266,null,6e3,!0),sort_bynote_shown=!0))}function toggleNotes(n,t){n=="show"?(jQuery("#mp-hide-notes-icon").removeClass("icon-ok"),jQuery("#mp-hide-notes-icon").addClass("no-menu-icon"),jQuery("#mp-show-notes-icon").addClass("icon-ok"),jQuery("#mp-show-notes-icon").removeClass("no-menu-icon"),jQuery(".MPNotesFont").show()):(jQuery("#mp-hide-notes-icon").addClass("icon-ok"),jQuery("#mp-hide-notes-icon").removeClass("no-menu-icon"),jQuery("#mp-show-notes-icon").removeClass("icon-ok"),jQuery("#mp-show-notes-icon").addClass("no-menu-icon"),jQuery(".MPNotesFont").hide());t!="login"&&storeViewSettings()}function toggleLockSidebar(n,t){n=="lock"?($("#mp-locksidebar-no-icon").removeClass("icon-ok"),$("#mp-locksidebar-no-icon").addClass("no-menu-icon"),$("#mp-locksidebar-yes-icon").addClass("icon-ok"),$("#mp-locksidebar-yes-icon").removeClass("no-menu-icon"),$("#mp-food-sidebar").css("position","fixed"),$("#mp-food-sidebar").css("margin-top","0px"),$("#mp-food-sidebar").css("padding-top","11px"),$("#mp-food-sidebar").css("border-color","#b7b7b7"),$("#mp-food-sidebar").css("border-width","1px"),$("#mp-food-sidebar").css("border-top-style","dotted")):($("#mp-locksidebar-yes-icon").removeClass("icon-ok"),$("#mp-locksidebar-yes-icon").addClass("no-menu-icon"),$("#mp-locksidebar-no-icon").addClass("icon-ok"),$("#mp-locksidebar-no-icon").removeClass("no-menu-icon"),$("#mp-food-sidebar").css("position","absolute"),$("#mp-food-sidebar").css("margin-top","12px"),$("#mp-food-sidebar").css("padding-top","0px"),$("#mp-food-sidebar").css("border-color","#f5f5f5"),$("#mp-food-sidebar").css("border-width","inherit"),$("#mp-food-sidebar").css("border-top-style","hidden"));t!="login"&&storeViewSettings()}function resetColumnLayout(n){var e=getItem("override.css"),r=getItem("origCSS"),o=getItem("menufile"),t,u,f,i;n=="override"&&jQuery.extend(!0,r,e);t=r[".style"];jQuery("#space-between-columns").val(numToNum(t["space-between-columns"],"in",unitSI));$("#width-balance").slider("value",t["width-balance"]);setWidthBalanceValText(t["width-balance"]);t["shorter-line"]=="yes"?jQuery('#myColumnLayoutOptionsDialog [name="shorter-line"]').prop("checked",!0):jQuery('#myColumnLayoutOptionsDialog [name="shorter-line"]').prop("checked",!1);t["line-between-columns"]=="yes"?$('#myColumnLayoutOptionsDialog [name="line-between-columns"]').prop("checked",!0):$('#myColumnLayoutOptionsDialog [name="line-between-columns"]').prop("checked",!1);u=tinycolor(t.fill);f=u.toRgbString().replace(/rgb/,"rgba").replace(/\)/,","+t["stroke-opacity"]+" )");jQuery("#dialog-colline-color").spectrum("set",f);jQuery('#myColumnLayoutOptionsDialog [name="stroke-width"]').val(parseInt(t["stroke-width"]));jQuery('#myColumnLayoutOptionsDialog [name="line-type"]').val(t["line-type"]);t["desc-left-indent"].indexOf(";")>-1?(i=numToNum(t["desc-left-indent"],"in",unitSI,!0)+";",i+=numToNum(t["extras-left-indent"],"in",unitSI),jQuery("#desc-left-indent").val(i)):jQuery("#desc-left-indent").val(numToNum(t["desc-left-indent"],"in",unitSI));jQuery("#desc-right-indent").val(numToNum(t["desc-right-indent"],"in",unitSI));jQuery('#myColumnLayoutOptionsDialog [name="extras-separator"]').val(t["extras-separator"].decodeEntities());jQuery('#myColumnLayoutOptionsDialog [name="desc-separator"]').val(t["desc-separator"].decodeEntities());jQuery('#myColumnLayoutOptionsDialog [name="line-spacing"]').val(parseFloat(t["line-spacing"]));jQuery('#myColumnLayoutOptionsDialog [name="type"]').val(t.type);t["line-between-columns"]=="yes"?($('#myColumnLayoutOptionsDialog [name="shorter-line"]').prop("disabled",!1),$('#myColumnLayoutOptionsDialog [name="stroke-width"]').prop("disabled",!1),$('#myColumnLayoutOptionsDialog [name="line-type"]').prop("disabled",!1),$("#dialog-colline-color").spectrum("enable"),$(".ColLineText").removeClass("muted")):($('#myColumnLayoutOptionsDialog [name="shorter-line"]').prop("disabled",!0),$('#myColumnLayoutOptionsDialog [name="stroke-width"]').prop("disabled",!0),$('#myColumnLayoutOptionsDialog [name="line-type"]').prop("disabled",!0),$("#dialog-colline-color").spectrum("disable"),$(".ColLineText").addClass("muted"))}function resetPriceOptions(n){var i=JSON.parse(sessionStorage.getItem("override.css")),r,t;r=n&&i[".price-options"]?i:JSON.parse(sessionStorage.getItem("origCSS"));t=r[".price-options"];jQuery('[name="placement"][value="'+t.layout+'"]').prop("checked",!0);jQuery('[name="currency"]').val(t.currency.decodeEntities());jQuery('[name="leader"]').val(t["price-leader"].decodeEntities());jQuery('[name="dotspacing"]').val(t["dot-space-between"]);jQuery("#dialog-priceoptions-multiprice").val(numToNum(t["space-between-prices"],"in",unitSI));var u=t["dot-space-item"]=="2",f=t["dot-space-price"]=="2",e=t["dots-match-name-color"]=="yes";jQuery("#dialog-priceoptions-spaceitem").prop("checked",u);jQuery("#dialog-priceoptions-spaceprice").prop("checked",f);jQuery("#dialog-priceoptions-matchname").prop("checked",e)}function updateSymbolOptions(n,t){n=="symA"?(jQuery("#sym1Sample").children().css("color",t.toHexString()),jQuery("#sym1Sample").children().css("opacity",t.getAlpha())):(jQuery("#sym2Sample").children().css("color",t.toHexString()),jQuery("#sym2Sample").children().css("opacity",t.getAlpha()))}function resetSymbolOptions(n){var i=JSON.parse(sessionStorage.getItem("override.css")),r,t;r=n=="override"&&i[".symbol"]?i:JSON.parse(sessionStorage.getItem("origCSS"));t=r[".symbol"];jQuery('[name="symsize"]').prop("checked",t.large=="yes");jQuery('[name="keep-inline"]').prop("checked",t["keep-inline"]=="yes");jQuery("#sym1Sample").children().css("color",t["fill-1"]);jQuery("#sym1Sample").children().css("opacity",t["fill-opacity1"]);jQuery("#sym2Sample").children().css("color",t["fill-2"]);jQuery("#sym2Sample").children().css("opacity",t["fill-opacity2"]);var u=tinycolor(t["fill-1"]),f=tinycolor(t["fill-2"]),e=u.toRgbString().replace(/rgb/,"rgba").replace(/\)/,","+t["fill-opacity1"]+" )"),o=f.toRgbString().replace(/rgb/,"rgba").replace(/\)/,","+t["fill-opacity2"]+" )");jQuery("#mp-dialog-symbol1-color").spectrum("set",e);jQuery("#mp-dialog-symbol2-color").spectrum("set",o)}function resetStyle(n){n=="all"||(n=="myPriceOptionsDialog"?(resetPriceOptions(),reset="reset_price",price_repage_needed=!0,priceoptions_changed=!0):n=="myBorderDialog"?(updateBorderUI("style"),loadBorder(),reset="reset_border",border_changed=!0):n=="myBackgroundDialog"?(updateBackgroundUI("style"),loadBackground(),reset="reset_background",background_changed=!0):n=="mySymbolOptionsDialog"?(resetSymbolOptions(),reset="reset_symbol",symopts_changed=!0):n=="myColumnLayoutOptionsDialog"?(resetColumnLayout(),reset="reset_column",layout_repage_needed=!0,layout_changed=!0):n=="myHeadingAccentsDialog"?(resetHeadingAccent(),reset="reset_accent",ha_changed=!0):n=="myPageSetup"&&(resetPageSetupMargins(),reset="reset_page_margins",pagesetup_changed=!0,pagesetup_csschanged=!0))}function initSession(){var r,t,n,i;resetArtisanUI();resetUserImageUI();initUndotmps();r=jQuery('link[title="origCSS"]').attr("href");sessionStorage.setItem("override.css","{}");sessionStorage.setItem("rx11","{}");$("#dialog-menustyle-select").val($("#dialog-menustyle-select option:first").val());t=[{head_id:"h0",heading:"Gatsby's",type:"title"},{head_id:"h1",heading:"Appetizers",type:"normal"},{head_id:"h2",heading:"Sample Heading",type:"normal"},{head_id:"h3",heading:"Subheading - you can edit or delete any headings, or add your own",type:"small"},{head_id:"h4",heading:"EntrÃ©es Sample",type:"normal"},{head_id:"h5",heading:"Alt-Font Sample",type:"alt-font"},];n={total_columns:1,menuID:1,rect_data:{},food_item:{"1":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;","2":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;","3":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;","4":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;","5":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;","6":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;","7":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;",order:["h0","h1","1","2","3","h2","h3","4","5","6","h4","7"],"default":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;"},head_item:{header:t,"default":"none;none;0;0;1;1;(style);(style);rgb(210,180,138);Style;;",h0:"none;none;0;;1;1;(style);(style);;Style;;",h1:"none;none;0;;1;1;(style);(style);;Style;;",h2:"none;none;0;;1;1;(style);(style);;Style;;",h3:"none;none;0;;1;1;(style);(style);;Style;;",h4:"none;none;0;;1;1;(style);(style);;Style;;",h5:"none;none;0;;1;1;(style);(style);;Style;;"},foot_item:{footer:"",type:"small",foot_tweaks:"none;none;;1;(none);rgb(210,180,138);center;0.25;0;0","default":"none;none;;1;(none);rgb(210,180,138);center;0.25;0;0",onmenu:1},float_images:{order:[],"default":"id;url;x;y;width;height;flip;mirror"},float_text:{ftxxx:{float_id:"ftxxx",page:"N",text:"Open 24",param:"0;none;left;(none);rgb(210, 180, 138);0.25;0.25;floating-text;0"}},pagesetup:{orientation:0,pagespacing:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],pagemarker:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],margin:0,papersize:"US-Letter",customheight:8.5,customwidth:5.5}};settings={imenupro:{userdic:["Napoletana","Faroe"],userlang:"en_US",pagespacing_adj:.03,unitSI:"in",autoSaveTime:10,smart:!0,findall:!0,findnotes:!0,sample:!0,PDFdupe:!1,keepon:!1,mobileshowtime:!1,PDFcrop:!1,giftcert:"",PDFhires:!0,fcodes:!1},grid:{is_visible:!1,x_spacing:"0.25",y_spacing:"0.25",myColor:"#d7d7d7",myFold:0},menucover:{is_visible:!1,coverstyle:"0",myColor:"#000000",preview_only:!0},zoom:{value:100},view:{mode:0,surface:0,foodview:0,viewnotes:0,listsize:0,openmenuview:0,openmenuthumb:0,locksidebar:0,listwidth:0},smartmark:{wordlist:"",wordcount:-1}};i=JSON.parse(sessionStorage.getItem("menufile"));i||sessionStorage.setItem("menufile",JSON.stringify(n));load_settings();resetPriceOptions("useOverride");resetSwitchMenuStyle();resetPageSetupPaper();resetPageSetupMargins("useOverride");updatePageMarginGlobal("initSession()");resetPageDim();resetColumnWidthGlobal();updateFooterModal();updateUI("style");drawGrid();leafd();paper=Raphael(document.getElementById("floatimages"),"100%","100%");$("#myHeadingList").megalist("setLabelFunction",listHeadItemFunctionNoHtml);fixHeadData(n.head_item.header);$("#myHeadingList").megalist("setDataProvider",sortHeadData(n.head_item.header));$("#MPCustomize").css("opacity",1);open_menu("latest");startActivityTimer();(imp_maint_msg!=""||imp_maint_msg2!="")&&setTimeout(function(){doAlert(imp_maint_msg,"noticeb",null,!0,"headsup");doAlert(imp_maint_msg2,"noticea",null,!0,"headsup")},3e3);isSafari6&&doAlert(296,"noticea",null,!0,"headsup")}function initUndotmps(){menufiletmp=[{}];origCSStmp=[{}];overridetmp=[{}];menufiletmp2=[{}];origCSStmp2=[{}];overridetmp2=[{}];undoCSStmp=[{}];redoCSStmp=[{}];mui=0;mutotal=0;undostreak=0;redostreak=0;$("#menu-edit-undo").addClass("disabled");$("#mp-undo-icon").addClass("icon2-white");$("#menu-edit-redo").addClass("disabled");$("#mp-redo-icon").addClass("icon2-white");$("#dialog-edit-undo").html(' <i id="mp-undo-icon" class="icon2-undo icon2-white"><\/i> Undo');predo_optimizer=[!1]}function mp_predo(n,t,i){if(startActivityTimer(),!ignore_openmenu_predos)if($("#dialog-edit-undo").html(' <i id="mp-undo-icon" class="icon2-undo"><\/i> Undo'),n=="na")initUndotmps(),undostate[mui]="na";else{if((t==0||t==undefined||t>0&&n!="pagespacing_shrink"&&n!="pagespacing_expand"&&n!="pagespacing_reset"&&n!="heading_remove"&&n!="heading_edit"&&n!="heading_delete"&&n!="fooditem_remove"&&n!="fooditem_edit"&&n!="draggit"&&n!="floattext"&&n!="draggit_ft")&&n!="footer"&&(menu_changes=++menu_changes),menufiletmp[mui]=getItem("menufile"),origCSStmp[mui]=getItem("origCSS"),overridetmp[mui]=getItem("override.css"),toUndo(),$("#menu-edit-undo").removeClass("disabled"),$("#mp-undo-icon").removeClass("icon2-white"),undostate[mui]=n,undo_page_no[mui]=t,i=="redo"?setUndoRedoText(mui,"redo"):setUndoRedoText(mui,"predo"),n=="style"){var r=$('link[title="origCSS"]').attr("href").replace("https://"+window.location.host+"/SVG/","");undoCSStmp[mui]=r}mui=++mui;i!="redo"&&mui<mutotal&&mui>=0?mutotal=mui:mui>mutotal&&(mutotal=mui);mutotal>maxUndos&&(menufiletmp.shift(),origCSStmp.shift(),overridetmp.shift(),menufiletmp2.shift(),origCSStmp2.shift(),overridetmp2.shift(),undoCSStmp.shift(),redoCSStmp.shift(),undostate.shift(),undo_page_no.shift(),predo_optimizer.shift(),undo_foodpos.shift(),mui>0&&(mui=--mui),mutotal>0&&(mutotal=--mutotal))}}function mp_undo(){if(mui>=1&&(mui=--mui),undostreak=++undostreak,redostreak=0,(undo_page_no[mui]==0||undo_page_no[mui]==undefined||undo_page_no[mui]>0&&undostate[mui]!="pagespacing_shrink"&&undostate[mui]!="pagespacing_expand"&&undostate[mui]!="pagespacing_reset"&&undostate[mui]!="heading_remove"&&undostate[mui]!="heading_edit"&&undostate[mui]!="heading_delete"&&undostate[mui]!="fooditem_remove"&&undostate[mui]!="fooditem_edit"&&undostate[mui]!="draggit"&&undostate[mui]!="floattext"&&undostate[mui]!="draggit_ft")&&undostate[mui]!="footer"&&(menu_changes=--menu_changes),undostate[mui]=="revert")$("#menu-edit-undo").addClass("disabled"),$("#mp-undo-icon").addClass("icon2-white"),$("#menu-edit-redo").addClass("disabled"),$("#mp-redo-icon").addClass("icon2-white"),ignore_openmenu_predos=!1,load_revert_undo(),menu_changes=--menu_changes;else{if(menufiletmp2[mui]=getItem("menufile"),origCSStmp2[mui]=getItem("origCSS"),overridetmp2[mui]=getItem("override.css"),toRedo(),setItem("menufile",menufiletmp[mui]),setItem("origCSS",origCSStmp[mui]),setItem("override.css",overridetmp[mui]),setIsUneven(parseInt(menufiletmp[mui].total_columns)),undostreak>1&&toUndo(),fromUndo(),undostate[mui]=="style"){var n=$.ajax();emptyStyleSheet();writeToStyleSheet();redoCSStmp[mui]=$('link[title="origCSS"]').attr("href");n=changeStyle(undoCSStmp[mui]);n.then(function(){redrawUndo("undo");leafd();set_page_of_x()})}else redrawUndo("undo"),leafd(),set_page_of_x();$("#menu-edit-redo").removeClass("disabled");$("#mp-redo-icon").removeClass("icon2-white")}setUndoRedoText(mui-1,"undo")}function mp_redo(){if(mp_predo(undostate[mui],undo_page_no[mui],"redo"),mui>=1&&(mui=--mui),redostreak=++redostreak,undostreak=0,setItem("menufile",menufiletmp2[mui]),setItem("origCSS",origCSStmp2[mui]),setItem("override.css",overridetmp2[mui]),setIsUneven(parseInt(menufiletmp2[mui].total_columns)),redostreak>1&&toRedo(),fromRedo(),undostate[mui]=="style"){var n=$.ajax();emptyStyleSheet();writeToStyleSheet();undoCSStmp[mui]=$('link[title="origCSS"]').attr("href");n=changeStyle(redoCSStmp[mui]);n.then(function(){redrawUndo("redo");leafd();set_page_of_x();mui++})}else redrawUndo("redo"),leafd(),set_page_of_x(),mui++}function redrawUndo(n){var t=getItem("menufile");undostate[mui]=="background"?(updateBackgroundUI("override"),loadBackground(),setTimeout(function(){make_rect_active()},20),stop_spinner()):undostate[mui]=="chalkboard"?(updateBackgroundUI("override"),loadBackground(),updateBorderUI("override"),loadBorder(),iMenuPro.updateSymbol(),resetSymbolOptions("override"),resetColumnLayout("override"),resetHeadingAccent("override"),emptyStyleSheet(),writeToStyleSheet(),iMenuPro.redraw_text(undo_page_no[mui])):undostate[mui]=="border"?(updateBorderUI("override"),loadBorder(),setTimeout(function(){make_rect_active()},20),stop_spinner()):undostate[mui]=="page"?(resetPageSetupPaper(),resetPageSetupMargins("useOverride"),updatePageMarginGlobal("undo Page"),resetPageDim(),resetColumnWidthGlobal(),drawGrid(),drawMenuCover(),loadBorder(),loadBackground(),undo_page_no[mui]>0?iMenuPro.draw_text(undo_page_no[mui]):iMenuPro.draw_text()):undostate[mui]=="price"?(resetPriceOptions("override"),iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="symbols"?(resetSymbolOptions("override"),predo_optimizer[mui]?(iMenuPro.updateSymbol(),iMenuPro.drawto_text(undo_page_no[mui],"update_text_only")):iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="resettostyle"?(emptyStyleSheet(),writeToStyleSheet(),updateUI("override"),iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="style"?(updateUI("override"),resetSwitchMenuStyle(),iMenuPro.draw_text()):undostate[mui]=="layout"?(resetColumnLayout("override"),predo_optimizer[mui]?iMenuPro.drawto_text(undo_page_no[mui],"update_text_only"):iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="accents"?(resetHeadingAccent("override"),mostRecentUndo(n)?iMenuPro.drawto_text(undo_page_no[mui],"update_text_only"):iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="pagespacing_shrink"||undostate[mui]=="pagespacing_expand"||undostate[mui]=="pagespacing_reset"?iMenuPro.redraw_text(undo_page_no[mui]):undostate[mui]=="heading"||undostate[mui]=="heading_remove"||undostate[mui]=="heading_edit"||undostate[mui]=="heading_delete"?(fixHeadData(t.head_item.header),$("#myHeadingList").megalist("setDataProvider",sortHeadData(t.head_item.header)),mostRecentUndo(n)?iMenuPro.redraw_text(undo_page_no[mui]):iMenuPro.draw_text(undo_page_no[mui]),isFF&&(make_rect_inactive(),make_rect_active())):undostate[mui]=="heading_groupup"||undostate[mui]=="heading_groupdn"?($("#myHeadingList").megalist("setDataProvider",sortHeadData(t.head_item.header)),predo_optimizer[mui]?iMenuPro.redraw_text(undo_page_no[mui]):iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="fooditem_remove"||undostate[mui]=="fooditem"?($("#myFoodList").megalist("setSelectedIndexEditR",-1),mostRecentUndo(n)?iMenuPro.redraw_text(undo_page_no[mui]):iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="fooditem_edit"?($("#myFoodList").megalist("setSelectedIndexEditR",-1),mostRecentUndo(n)?iMenuPro.redraw_text(undo_page_no[mui]):iMenuPro.draw_text(undo_page_no[mui]),isFF&&(make_rect_inactive(),make_rect_active())):undostate[mui]=="draggit"?($("#myHeadingList").megalist("setDataProvider",sortHeadData(t.head_item.header)),fixHeadData(t.head_item.header),predo_optimizer[mui]==!1?iMenuPro.draw_text(undo_page_no[mui]):iMenuPro.redraw_text(undo_page_no[mui])):undostate[mui]=="floattext"?t.food_item.order.length==0?(iMenuPro.draw_floattext(),stop_spinner()):iMenuPro.drawto_text(undo_page_no[mui]):undostate[mui]=="draggit_ft"?t.food_item.order.length==0?(iMenuPro.draw_floattext(),stop_spinner()):iMenuPro.drawto_text(undo_page_no[mui]):undostate[mui]=="footer"?(updateFooterModal(),t.food_item.order.length==0?(iMenuPro.print_footer(),stop_spinner()):iMenuPro.drawto_text(undo_page_no[mui])):undostate[mui]=="image"?t.food_item.order.length==0?(iMenuPro.draw_images(),stop_spinner()):iMenuPro.drawto_text(undo_page_no[mui]):undostate[mui]=="image_drag"?(t.food_item.order.length==0||undo_page_no[mui]==page_no?(iMenuPro.draw_images(),stop_spinner()):iMenuPro.drawto_text(undo_page_no[mui]),setTimeout(function(){make_rect_active()},20)):undostate[mui]=="fit"?(emptyStyleSheet(),writeToStyleSheet(),iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="clearall"?(predo_optimizer[mui]?iMenuPro.drawto_text(undo_page_no[mui]):(iMenuPro.draw_text(undo_page_no[mui]),undo_foodpos[mui]!=0&&($("#myFoodList").megalist("setSelectedIndexMove",parseInt(undo_foodpos[mui].slice(9)/41)),$("#myFoodList").megalist("clearSelectedIndex",parseInt(undo_foodpos[mui].slice(9)/41)))),makeJoinery()):undostate[mui]=="autobin"?iMenuPro.draw_text(undo_page_no[mui]):undostate[mui]=="growfonts"||undostate[mui]=="shrinkfonts"||undostate[mui]=="resetfonts"?(emptyStyleSheet(),writeToStyleSheet(),iMenuPro.draw_text(undo_page_no[mui])):undostate[mui]=="font"?(emptyStyleSheet(),writeToStyleSheet(),predo_optimizer[mui]?iMenuPro.drawto_text(undo_page_no[mui]):iMenuPro.draw_text(undo_page_no[mui])):iMenuPro.draw_text()}function mostRecentUndo(n){return n=="undo"&&undostreak==1&&redostreak==0||n=="redo"&&undostreak==0&&redostreak==1?!0:!1}function setPredoOptimizer(n){mui>=1?predo_optimizer[mui-1]=n:predo_optimizer[0]=n}function setUndoFoodPos(n){mui>=1?undo_foodpos[mui-1]=n:undo_foodpos[0]=0}function setUndoRedoText(n,t){if(n<0&&t=="undo")$("#dialog-edit-undo").html(' <i id="mp-undo-icon" class="icon2-undo icon2-white"><\/i> Undo'),$("#menu-edit-undo").addClass("disabled"),$("#mp-undo-icon").addClass("icon2-white");else{n>=mutotal-1&&t=="redo"&&($("#menu-edit-redo").addClass("disabled"),$("#mp-redo-icon").addClass("icon2-white"));$("#dialog-edit-undo").html(' <i id="mp-undo-icon" class="icon2-undo"><\/i> Undo');t=="predo"&&($("#menu-edit-redo").addClass("disabled"),$("#mp-redo-icon").addClass("icon2-white"));switch(undostate[n]){case"revert":$("#dialog-edit-undo").append(" Revert");break;case"background":$("#dialog-edit-undo").append(" Background Change");break;case"border":$("#dialog-edit-undo").append(" Border Change");break;case"page":$("#dialog-edit-undo").append(" Page Setup");break;case"price":$("#dialog-edit-undo").append(" Price Options");break;case"symbols":$("#dialog-edit-undo").append(" Symbol Options");break;case"resettostyle":$("#dialog-edit-undo").append(" Reset To Style defaults");break;case"style":$("#dialog-edit-undo").append(" Style Change");break;case"layout":$("#dialog-edit-undo").append(" Layout Options");break;case"accents":$("#dialog-edit-undo").append(" Heading Accents");break;case"pagespacing_shrink":$("#dialog-edit-undo").append(" Shrink Page Spacing");break;case"pagespacing_expand":$("#dialog-edit-undo").append(" Expand Page Spacing");break;case"pagespacing_reset":$("#dialog-edit-undo").append(" Reset Page Spacing");break;case"heading":$("#dialog-edit-undo").append(" Heading Move");break;case"heading_remove":$("#dialog-edit-undo").append(" Remove Heading");break;case"heading_edit":$("#dialog-edit-undo").append(" Heading Change");break;case"heading_delete":$("#dialog-edit-undo").append(" Delete Heading");break;case"heading_groupup":$("#dialog-edit-undo").append(" Move Section Up");break;case"heading_groupdn":$("#dialog-edit-undo").append(" Move Section Down");break;case"fooditem_remove":$("#dialog-edit-undo").append(" Remove Food Item");break;case"fooditem":$("#dialog-edit-undo").append(" Food Item Move");break;case"fooditem_edit":$("#dialog-edit-undo").append(" Food Item Change");break;case"draggit":$("#dialog-edit-undo").append(" Drag Menu Text");break;case"floattext":$("#dialog-edit-undo").append(" Floating Text Change");break;case"draggit_ft":$("#dialog-edit-undo").append(" Drag Floating Text");break;case"footer":$("#dialog-edit-undo").append(" Footer Change");break;case"image":$("#dialog-edit-undo").append(" Image Change");break;case"image_drag":$("#dialog-edit-undo").append(" Drag Image");break;case"fit":$("#dialog-edit-undo").append(" FIT");break;case"chalkboard":$("#dialog-edit-undo").append(" Chalkboard");break;case"clearall":$("#dialog-edit-undo").append(" Clear All");break;case"autobin":$("#dialog-edit-undo").append(" Auto Bin/Number");break;case"growfonts":$("#dialog-edit-undo").append(" Grow all fonts");break;case"shrinkfonts":$("#dialog-edit-undo").append(" Shrink all fonts");break;case"resetfonts":$("#dialog-edit-undo").append(" Reset fonts");break;case"font":$("#dialog-edit-undo").append(" Font Change");break;default:$("#dialog-edit-undo").html(' <i id="mp-undo-icon" class="icon2-undo"><\/i> Undo')}}}function changeStyle(n){var n,t,i,u,r;return jQuery("#joiner image").remove(),isFF&&jQuery("#colline").children().remove(),storeStyle(),n?(u=1,jQuery("#dialog-menustyle-select").val(n.replace(/styles\//g,""))):(n="styles/"+jQuery("#dialog-menustyle-select").val(),t=jQuery("#dialog-menustyle-keepon").prop("checked"),t&&!cameviaresetcmd||ignoreoverride||(i="{ }",sessionStorage.setItem("override.css",i),emptyStyleSheet())),jQuery('link[title="origCSS"]').attr("href",n),r=promiseCSS(n,"origCSS"),jQuery("#MPstatusBarCurrentStyle").text(" Style: "+n.replace(/styles\//g,"").replace(/_/g," ").replace(/.css/g,"")),r}function updateUI(n){n=="override"?(updateBorderUI("override"),updateBackgroundUI("override")):(updateBorderUI("style"),updateBackgroundUI("style"));loadBorder();loadBackground();resetPageSetupMargins("useOverride");updatePageMarginGlobal("updateUI");resetPageDim();resetColumnWidthGlobal();resetPriceOptions("override");resetSymbolOptions("override");resetColumnLayout("override");resetHeadingAccent("override");drawGrid();updateFooterModal()}function resetPageSpacing(n){var i=JSON.parse(sessionStorage.getItem("menufile")),t;n?(t=parseFloat(i.pagesetup.pagespacing[0]).toFixed(2),parseFloat(t)==0&&(t="0.0"),jQuery("#MPstatusBarPageSpacing").text(t),$("#exact-page-spacing").val(t)):(i.pagesetup.pagespacing=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i.pagesetup.pagemarker=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],sessionStorage.setItem("menufile",JSON.stringify(i)),jQuery("#MPstatusBarPageSpacing").text("0.0"),$("#exact-page-spacing").val("0.0"))}function set_pagespacing(n){iMenuPro.pagespacing_delta(parseFloat(n)*96);n==0?($("#MPstatusBarPageSpacing").css("cssText","color: #e2e2e2"),jQuery("#MPstatusBarPageSpacing").text("0.0"),$("#exact-page-spacing").val("0.0")):($("#MPstatusBarPageSpacing").css("cssText","color: #fe9225"),jQuery("#MPstatusBarPageSpacing").text(parseFloat(n).toFixed(2)),$("#exact-page-spacing").val(parseFloat(n).toFixed(2)))}function set_page_of_x(n){var r=getItem("menufile"),t=jQuery("#textcanvas g").last().attr("id"),u,i;if(t=t!=undefined?t.replace(/u$/,""):undefined,n=="new_menu")page_no=0,jQuery("#MPstatusBarPage").text(1),jQuery("#prev-page-num").text(" "),$(".icon-prev-page").css("opacity",.95),jQuery("#next-page-num").text(" "),$(".icon-next-page").css("opacity",.95),$("#MPstatusBarPage").css("cssText","color: #e2e2e2 !important;");else if(t!=undefined){if(u=t.split("_")[1],n=n==undefined?page_no+1:parseInt(n),$("#btn-prev-page").attr("data-original-title",""),$("#btn-next-page").attr("data-original-title",""),jQuery("#MPstatusBarPage").text(n),n==1?(jQuery("#prev-page-num").text(" "),$(".icon-prev-page").css("opacity",.95)):(jQuery("#prev-page-num").text(n-1),$(".icon-prev-page").css("opacity",1),$("#btn-prev-page").attr("data-original-title","View Previous Page")),isLastOrder()==!1)jQuery("#next-page-num").text(n+1),$(".icon-next-page").css("opacity",1),$("#btn-next-page").attr("data-original-title","View Next Page");else{for(i=page_no+1;i<20;++i)r.pagesetup.pagemarker[i]=-1,setItem("menufile",r);jQuery("#next-page-num").text(" ");$(".icon-next-page").css("opacity",.95)}$("#next-page-num").text()==" "&&$("#prev-page-num").text()==" "?$("#MPstatusBarPage").css("cssText","color: #e2e2e2 !important;"):$("#MPstatusBarPage").css("cssText","color: #fe9225 !important;")}}function updateBackgroundUI(n){var t,i;n=="override"?(t=JSON.parse(sessionStorage.getItem("override.css")),typeof t[".background"]=="undefined"&&(t=JSON.parse(sessionStorage.getItem("origCSS")))):t=JSON.parse(sessionStorage.getItem("origCSS"));jQuery("#dialog-background-select").val(t[".background"].image);i=numToNum(t[".background"]["background-margin"],"in",unitSI);jQuery("#dialog-background-margin").val(i);jQuery("#dialog-paper-color").spectrum("set",t[".background"]["paper-color"]);loadPaperColor();jQuery("#dialog-background-flip").prop("checked",t[".background"].flip=="yes");jQuery("#dialog-background-mirror").prop("checked",t[".background"].mirror=="yes");jQuery("#dialog-background-stretch").prop("checked",t[".background"].preserveAspectRatio=="no");jQuery("#dialog-background-lighten").prop("checked",parseFloat(t[".background"].opacity)==BackgroundLighterOpacity)}function updateBorderUI(n){var t,r,i,u;n=="override"?(t=JSON.parse(sessionStorage.getItem("override.css")),typeof t[".border"]=="undefined"&&(t=JSON.parse(sessionStorage.getItem("origCSS")))):t=JSON.parse(sessionStorage.getItem("origCSS"));jQuery("#dialog-border-select").val(t[".border"].image);r=numToNum(t[".border"]["border-margin"],"in",unitSI);$("#dialog-border-margin").val(r);t[".border"].color=="none"?(jQuery("#dialog-border-color").spectrum("set","#000000"),jQuery("#dialog-border-colorize").prop("checked",!1)):(jQuery("#dialog-border-color").spectrum("set",t[".border"].color),jQuery("#dialog-border-colorize").prop("checked","checked"));loadColorize();parseFloat(t[".border"]["fill-opacity"])!=1&&(i=jQuery("#dialog-border-color").spectrum("get").toRgb(),i.a=parseFloat(t[".border"]["fill-opacity"]),jQuery("#dialog-border-color").spectrum("set","rgba("+i.r+","+i.g+","+i.b+","+i.a+")"));jQuery("#dialog-border-flip").prop("checked",t[".border"].flip=="yes");jQuery("#dialog-border-mirror").prop("checked",t[".border"].mirror=="yes");u=jQuery("#dialog-border-select option:selected").index()}function promiseCSS(n,t){var i=promiseGet(n);return $("#background").css("opacity",0),$("#menuborder").css("opacity",0),$("#colline").css("opacity",0),$("#footer").css("opacity",0),$("#textcanvas").css("opacity",0),i.then(function(n){jQuery.parsecss(n,function(n){sessionStorage.setItem(t,JSON.stringify(n));$("#background").animate({opacity:1},250);$("#menuborder").css("opacity",1);$("#colline").css("opacity",1);$("#footer").css("opacity",1);$("#MPtextlocked").text()=="menu text"?$("#textcanvas").css("opacity","0.35"):$("#textcanvas").css("opacity",1)})}),i}function loadBackground(){var n=jQuery("#dialog-background-select").val(),e,i;(n==null||n=="undefined")&&(n="none",jQuery("#dialog-background-select").prop("selectedIndex",0),jQuery("#dialog-background-select").click());jQuery("#background").find("image").remove();var t=numToNum(parseFloat(jQuery("#dialog-background-margin").val()),unitSI,"in",!0),o=jQuery("#dialog-background-stretch").prop("checked"),s=jQuery("#dialog-background-flip").prop("checked"),h=jQuery("#dialog-background-mirror").prop("checked"),c=$("#dialog-background-lighten").prop("checked")?BackgroundLighterOpacity:1;if(isNaN(t)||t==0)var r=0,u=page_width*96,f=page_height*96;else var r=t*96,u=page_width*96-t*192,f=page_height*96-t*192;n=="none"?jQuery("#background-rect").attr("fill","none"):n=="paper"?(e=jQuery("#dialog-paper-color").spectrum("get").toHexString("hex6"),jQuery("#background-rect").attr("fill",e),jQuery("#background-rect").attr("x",r),jQuery("#background-rect").attr("y",r),jQuery("#background-rect").attr("width",u),jQuery("#background-rect").attr("height",f)):(i=imgSVG("https://"+window.location.host+"/SVG/backgrounds/"+n,r,r,u,f),jQuery(i).attr("id","background-image"),o||i.setAttributeNS(null,"preserveAspectRatio","xMidYMid meet"),jQuery("#background").append(i),jQuery("#background-rect").attr("fill","none"),i.setAttributeNS(null,"opacity",c));transformElement("#background",h,s)}function loadBorder(){var t,i,r,f,e;t=page_height>=page_width?"/SVG/borders/"+jQuery("#dialog-border-select").val():"/SVG/borders/landscape/"+jQuery("#dialog-border-select").val();var o=jQuery("#dialog-border-colorize").prop("checked"),n=numToNum(parseFloat(jQuery("#dialog-border-margin").val()),unitSI,"in",!0),s=jQuery("#dialog-border-flip").prop("checked"),h=jQuery("#dialog-border-mirror").prop("checked");if(jQuery("#menuborder").find("image").remove(),isNaN(n)||n==0)var u=0,c=page_width*96,l=page_height*96;else var u=n*96,c=page_width*96-n*192,l=page_height*96-n*192;o?(i=jQuery("#dialog-border-color").spectrum("get").toHexString().slice(1),r=jQuery("#dialog-border-color").spectrum("get").getAlpha()):(i="",r="");t!="/SVG/borders/none"&&t!="/SVG/borders/landscape/none"&&(f="https://"+window.location.host+"/svgimg/"+base64.encode(i+":"+r+":"+t),e=imgSVG(f,u,u,c,l),jQuery("#menuborder").append(e));transformElement("#menuborder",h,s)}function loadPaperColor(){jQuery("#dialog-background-select").val()=="paper"?(jQuery(".spanPaperColorText").removeClass("muted"),jQuery("#dialog-paper-color").spectrum("enable"),$(".spanLightenBackground").addClass("muted"),$("#dialog-background-lighten").attr("disabled",!0),$("#dialog-background-lighten").prop("checked",0)):(jQuery(".spanPaperColorText").addClass("muted"),jQuery("#dialog-paper-color").spectrum("disable"),$(".spanLightenBackground").removeClass("muted"),$("#dialog-background-lighten").attr("disabled",!1))}function loadColorize(){var n=jQuery("#dialog-border-colorize").prop("checked");n?jQuery("#dialog-border-color").spectrum("enable"):jQuery("#dialog-border-color").spectrum("disable")}function storeStyle(){var n=jQuery('link[title="origCSS"]').attr("href").replace("https://"+window.location.host+"/SVG/","")}function noOverride(n){var t=JSON.parse(sessionStorage.getItem("override.css"));delete t[n];sessionStorage.setItem("override.css",JSON.stringify(t))}function storeBackground(){var n=JSON.parse(sessionStorage.getItem("override.css"));n[".background"]={};n[".background"].image=jQuery("#dialog-background-select").val();n[".background"]["background-margin"]=numToNum(parseFloat(jQuery("#dialog-background-margin").val()),unitSI,"in",!0);n[".background"].flip=jQuery("#dialog-background-flip").prop("checked")?"yes":"no";n[".background"].mirror=jQuery("#dialog-background-mirror").prop("checked")?"yes":"no";n[".background"].opacity=jQuery("#dialog-background-lighten").prop("checked")?BackgroundLighterOpacity:1;n[".background"].preserveAspectRatio=jQuery("#dialog-background-stretch").prop("checked")?"no":"yes";n[".background"]["paper-color"]=jQuery("#dialog-paper-color").spectrum("get").toRgbString();sessionStorage.setItem("override.css",JSON.stringify(n))}function storeBorder(){var n=JSON.parse(sessionStorage.getItem("override.css")),t;n[".border"]={};n[".border"].image=jQuery("#dialog-border-select").val();n[".border"]["border-margin"]=numToNum(parseFloat(jQuery("#dialog-border-margin").val()),unitSI,"in",!0);n[".border"].flip=jQuery("#dialog-border-flip").prop("checked")?"yes":"no";n[".border"].mirror=jQuery("#dialog-border-mirror").prop("checked")?"yes":"no";t=jQuery("#dialog-border-colorize").prop("checked");t?(n[".border"].color=jQuery("#dialog-border-color").spectrum("get").toRgbString(),n[".border"]["fill-opacity"]=jQuery("#dialog-border-color").spectrum("get").toRgb().a):(n[".border"].color="none",n[".border"]["fill-opacity"]="1.0");sessionStorage.setItem("override.css",JSON.stringify(n))}function storeReset(){sessionStorage.setItem("reset",JSON.stringify({}))}function restoreReset(){var n=JSON.parse(sessionStorage.getItem("reset"))}function leafd(){var n=JSON.parse(sessionStorage.getItem("override.css"));Object.getOwnPropertyNames(n).length>0?(jQuery("#MPCustomize").show(),jQuery("#menu-reset-style1").removeClass("disabled"),jQuery("#mp-reset-icon").removeClass("icon2-white")):(jQuery("#MPCustomize").hide(),jQuery("#menu-reset-style1").addClass("disabled"),jQuery("#mp-reset-icon").addClass("icon2-white"));var t=_.pluck(document.styleSheets,"href"),i=_.indexOf(t,"https://"+window.location.host+"/SVG/fontsoverride.css"),r=document.styleSheets[i].cssRules.length;r>0?(jQuery("#menu-reset-fonts1").removeClass("disabled"),jQuery("#mp-reset-fonts-icon").removeClass("icon2-white")):(jQuery("#menu-reset-fonts1").addClass("disabled"),jQuery("#mp-reset-fonts-icon").addClass("icon2-white"));$("[name=placement]:checked").val()=="hidden"?$("#MPnoprice").text("p"):$("#MPnoprice").text("");$("[name=desc-separator]").val()=="notext"?$("#MPnodesc").text("d"):$("#MPnodesc").text("");$("[name=extras-separator]").val()=="notext"?$("#MPnoextras").text("e"):$("#MPnoextras").text("")}function setIsUneven(n){var t=getItem("override.css");isUneven=!1;t[".style"]!=undefined&&t[".style"]["width-balance"]!=undefined&&(t[".style"]["width-balance"].selector!=undefined&&(t[".style"]["width-balance"]=100,$("#width-balance").slider("value",100),setItem("override.css",t)),t[".style"]["width-balance"]!=100&&n>1&&(isUneven=!0))}function setLeafColor(){var n=jQuery("#dialog-menustyle-keepon").prop("checked");n?jQuery(".icon-customize ").css("background","url('bootstrap/img/scott-icons.png') -42px -70px"):jQuery(".icon-customize ").css("background","url('bootstrap/img/scott-icons.png') 0px 0px")}function reset_mobileUI(){var n=getItem("origCSS"),t=getItem("override.css");jQuery.extend(!0,n,t);Mobile="";jQuery("#mp-live-sync").prop("checked",0);$("#mp-live-sync").prop("disabled",!0);$("#live-sync-text").addClass("muted");$("#mp-change-tcolor").prop("checked",0);$("#dialog-mobile-tcolor").spectrum("set","rgb(0,0,0)");$("#dialog-mobile-tcolor").spectrum("disable");$("#more-no-titles").prop("checked",0);$("#more-no-prices").prop("checked",0);$("#more-no-ftext").prop("checked",0);$("#more-no-footer").prop("checked",0);$("#more-no-cols").prop("checked",0);$("#more-click-pics").prop("checked",0);jQuery("#mp-mobile-appearance").val("match");jQuery("#dialog-mobile-color").spectrum("set","rgb(255,255,255)");n[".background"].image=="paper"&&jQuery("#dialog-mobile-color").spectrum("set",n[".background"]["paper-color"]);jQuery("#mp-mobile-updated").text("Not synced yet");jQuery("#mobile-dothis").hide();jQuery("#mobile-embed").hide();jQuery("#mobile-sendto").hide()}function save_mobile(n){var i,r;if(nosaveMenu||noloadedMenu){doAlert("No save mobile","success",1e3,!0,"top-right");return}var u=getItem("menufile"),f=jQuery("#access_token").val(),e=new Date,t={};t.sync=jQuery("#mp-live-sync").prop("checked")?1:0;t.appearance=jQuery("#mp-mobile-appearance").val();t.color=jQuery("#dialog-mobile-color").spectrum("get").toRgbString();t.published=Mobile.published||"";t.shorturl=Mobile.shorturl||"";t.tcolor=jQuery("#dialog-mobile-tcolor").spectrum("get").toRgbString();t.changetcolor=jQuery("#mp-change-tcolor").prop("checked")?1:0;t.notitles=$("#more-no-titles").prop("checked")?1:0;t.noprices=$("#more-no-prices").prop("checked")?1:0;t.noftext=$("#more-no-ftext").prop("checked")?1:0;t.nofooter=$("#more-no-footer").prop("checked")?1:0;t.nocols=$("#more-no-cols").prop("checked")?1:0;t.clickpics=$("#more-click-pics").prop("checked")?1:0;i=base64.encode(JSON.stringify(t));r="/api/mobile/"+u.menuID+"/"+f+"/"+Date.now();jQuery.ajax({timeout:6e3,type:"POST",url:r,dataType:"json",data:{mobile:i},success:function(t){t.status=="OK"?(Mobile=JSON.parse(base64.decode(t.mobile)),n=="verbose"&&doAlert(246,null,1200,!0)):doAlert(150,null,12e3,!0)},error:function(n,t){t=="timeout"||n.responseJSON==undefined?(doAlert(240,null,9e3,!0),console.log("Connection seems dead! (save mobile)")):n.responseJSON.error=="invalid_client"?(doAlert(242,null,9e3,!0),console.log("Token has expired! (save mobile)")):(doAlert(244,null,9e3,!0),console.log("Something failed on server! (save menu mobile)"))}})}function sync_html(n,t){t=t==undefined||t=="no_html"?"no":"yes";var r=getItem("menufile"),u=jQuery("#access_token").val(),f=JSON.stringify(createJSON()),s=new Date,i={};i.sync=jQuery("#mp-live-sync").prop("checked")?1:0;i.appearance=jQuery("#mp-mobile-appearance").val();i.color=jQuery("#dialog-mobile-color").spectrum("get").toRgbString();i.published=(new Date).getTime();i.tcolor=jQuery("#dialog-mobile-tcolor").spectrum("get").toRgbString();i.changetcolor=jQuery("#mp-change-tcolor").prop("checked")?1:0;i.notitles=$("#more-no-titles").prop("checked")?1:0;i.noprices=$("#more-no-prices").prop("checked")?1:0;i.noftext=$("#more-no-ftext").prop("checked")?1:0;i.nofooter=$("#more-no-footer").prop("checked")?1:0;i.nocols=$("#more-no-cols").prop("checked")?1:0;i.clickpics=$("#more-click-pics").prop("checked")?1:0;var e=base64.encode(JSON.stringify(i)),o=i.appearance=="match"?createCSS():"none";jQuery.ajax({timeout:6e3,type:"POST",url:"/tools/token-S3html",dataType:"json",data:{no_html:t,date:Date.now(),menuid:r.menuID,access_token:u,mobile:e,mycss:o,myjson:f},success:function(t){var i,u;if(t.status=="OK"){if(setMobileUI=="sync"){Mobile=JSON.parse(base64.decode(t.mobile));i=new Date(Mobile.published);u=i.toString().slice(4,7)+"-"+i.getDate()+"-"+i.getFullYear()+"  "+i.toLocaleTimeString().replace(/((?:[^\:]*\:[^\:]*))(.*)( .*)$/,"$1$3");jQuery("#mp-mobile-updated").text(u);var r=Mobile.shorturl.replace(/^.*\/([^\/.]+)+\.js/,"$1"),f='<script id="'+r+'" type="text/javascript"  src="https://imenupro.com/!'+r+'"> <\/script>',e=encodeURIComponent(twitter_arr[twitter_cnt%twitter_arr.length]),o="https://twitter.com/intent/tweet?text="+e+"%20our%20new%20menu&url=https://imenupro.com/@"+r;jQuery("#mp-mobile-embedcode").text(f);jQuery("#mp-tweet-btn").attr("href",o)}else setMobileUI="after_sync";n=="verbose"&&doAlert(246,null,1200,!0)}else doAlert(150,null,12e3,!0)},error:function(n,t){t=="timeout"||n.responseJSON==undefined?(doAlert(240,null,9e3,!0),console.log("Connection seems dead! (save mobile)")):n.responseJSON.error=="invalid_client"?(doAlert(242,null,9e3,!0),console.log("Token has expired! (save mobile)")):(doAlert(244,null,9e3,!0),console.log("Something failed on server! (save menu mobile)"))}})}function save_menutitle(n,t){var r,i,u,f,e;if(nosaveMenu||noloadedMenu){doAlert("No save title","warning",1e3,!0,"top-left");return}r=jQuery("#access_token").val();n==undefined&&(n=jQuery("#MPstatusBarMenuName").html(),n==""&&(i=jQuery(".spanRenameInput").val(),n=i==""?"Untitled Menu":i));t==undefined&&(u=getItem("menufile"),t=u.menuID);f=encodeURIComponent(LZString.compressToBase64(n));e="/api/menutitle/"+t+"/"+r+"/"+f+"/"+Date.now();jQuery.post(e,function(i){if(i.status=="OK"){var r=getItem("menuTitle"),f=_.pluck(r,"menu_id"),u=_.indexOf(f,t);r[u]!=undefined&&(r[u].name=n,setItem("menuTitle",r));isMenuSaved+=":title_OK"}else doAlert(150,null,12e3,!0)},"json").fail(function(n,t){t=="timeout"||n.responseJSON==undefined?(doAlert(206,null,9e3,!0),console.log("Connection seems dead! (save menutitle)")):n.responseJSON.error=="invalid_client"?(doAlert(208,null,9e3,!0),console.log("Token has expired! (save menutitle)")):(doAlert(210,null,9e3,!0),console.log("Something failed on server! (save menutitle)"))})}function new_menu(n){var f=jQuery("#access_token").val(),t,i;n==undefined&&save_menu("current","new",fileTimestamp);clear_menu();setMobileUI="new";t=init_menufile();set_page_of_x("new_menu");emptyStyleSheet();i=jQuery('link[title="origCSS"]').attr("href");t.override={};t.myStyle=i;var r="foodpos:"+parseInt(jQuery("#myFoodList ul").css("top")),u=LZString.compressToBase64(JSON.stringify(t)),e="/api/menu/new/"+f+"/encoded_menu_in_POST/"+CryptoJS.MD5(u).toString()+"/"+Date.now();jQuery.post(e,{menu_data:u},function(n){n.status=="OK"?(fileTimestamp=n.last_update,t.menuID=n.menu_id,delete t.override,delete t.myStyle,setItem("menufile",t),reset_mobileUI("new"),jQuery(".spanRenameInput").val("Untitled Menu"),jQuery("#MPstatusBarMenuName").html("Untitled Menu"),$("#MPstatusBarMenuName").addClass("untitledName"),$("#myFoodList").megalist("setSelectedIndexMove",parseInt(r.slice(9)/41)),$("#myFoodList").megalist("clearSelectedIndex",parseInt(r.slice(9)/41)),fixHeadData(t.head_item.header),jQuery("#myHeadingList").megalist("setDataProvider",sortHeadData(t.head_item.header)),asyncjs_menutitle(null,function(i,r){var f=sortMenuTitle(r),u,e;fixMenuData(f);jQuery("#myMenuList").megalist("setDataProvider",f);u=_.filter(f,function(t){return t.menu_id==n.menu_id});e=jQuery('link[title="origCSS"]').attr("href");t.override={};t.myStyle=e;demoMenu||(u[0].data=encodeURIComponent(LZString.compressToBase64(JSON.stringify(t))),u[0].name=encodeURIComponent(LZString.compressToBase64(u[0].name)),u[0].mobile=Mobile,save_revert(u[0]));sessionStorage.setItem("override.css","{}");updateUI("style");leafd();setIsUneven(global_columns);check_mobile_icon();iMenuPro.draw_text();save_thumbnail()})):n.status=="limit"?(doAlert(90,null,9e3,!0),iMenuPro.draw_text(),iMenuPro.redraw_text(page_no)):(doAlert(140,null,9e3,!0),iMenuPro.redraw_text(page_no))},"json")}function save_menufile(n,t,i,r){var f=!1,h=jQuery("#access_token").val(),e,o,u,s;t==undefined&&(t=getItem("menufile"),e=getItem("override.css"),o=jQuery('link[title="origCSS"]').attr("href"),t.override=e,t.myStyle=o);i==undefined&&(i=t.menuID);Mobile.sync==1&&n=="verbose"&&(sync_html("quiet"),f=!0);u=LZString.compressToBase64(JSON.stringify(t));s="/api/menu/"+i+"/"+h+"/encoded_menu_in_POST/"+CryptoJS.MD5(u).toString()+"/"+Date.now();jQuery.post(s,{menu_data:u},function(t){var i=JSON.parse(t);i.status=="OK"?(n=="verbose"&&(f?doAlert(262,null,2200,!0):doAlert(126,null,1200,!0)),isMenuSaved+=":menufile_OK",r!="copy"&&r!="current"&&(fileTimestamp=i.last_update)):i.status=="md5"?doAlert(170,null,0,!0):r=="copy"?doAlert(182,null,5e3,!0):doAlert(152,null,0,!0)})}function save_revert_predo(){var n=getItem("revert"),t=getItem("menufile"),i=getItem("override.css"),r=jQuery('link[title="origCSS"]').attr("href");t.override=i;t.myStyle=r;n.data=encodeURIComponent(LZString.compressToBase64(JSON.stringify(t)));n.name=encodeURIComponent(LZString.compressToBase64(jQuery("#MPstatusBarMenuName").html()));setItem("revert.tmp","{}");sessionStorage.setItem("revert.tmp",JSON.stringify(n))}function check_menu(n){var t,i,r;return n==undefined&&(t=getItem("menufile"),n=t.menuID),i=jQuery("#access_token").val(),r="/api/checkmenu/"+n+"/"+i+"/"+Date.now(),$.ajax({url:r,type:"get",dataType:"json",timeout:12e3})}function save_menu(n,t,i){var s,r,e;if(nosaveMenu||noloadedMenu){doAlert("No save","info",1e3,!0);return}if(s=i==undefined?fileTimestamp:i,n==undefined&&(n="save"),isMenuSaved="",t!="use_sessionStorage"){var f=getItem("menufile"),o=f.menuID,u=jQuery("#MPstatusBarMenuName").html(),h=getItem("override.css"),c=jQuery('link[title="origCSS"]').attr("href");f.override=h;f.myStyle=c;r=n;e=!1;t=="new"&&(e=!0)}else{var f=getItem("ss_menufile"),u=getItem("ss_mytitle"),o=f.menuID;r="copy";e=!1}n=="autosave"&&activityTimer==0||(menu_changes!=0&&save_thumbnail(),menu_changes=0,check_menu(o).done(function(t){var i;if(t.results==0){n=="current"?doAlert(184,null,12e3,!0):doAlert(166,null,12e3,!0);return}if(kill_userAB||t.last_update==s||userA_loggingout_andsaving)startAutoSave(),save_menutitle(u,o),save_menufile(n,f,o,r),n=="verbose"&&save_settings();else{if(n=="current")$("#myLoadingMenu").modal("hide"),i=r=="copy"?confirm("Your copy has been created. But when trying to save your previous menu, "+u+", it appears that menu has been edited by another login. Is it OK to save your version?  (click Cancel to not save "+u+" )"):confirm(u+" appears to have been edited by another login. Is it OK to save your version?  (click Cancel to not save "+u+" )");else if(doAlert(),n!="autosave")i=confirm(u+" appears to have been edited by another login. Is it OK to save your version?");else{doAlert(270,"noticea",null,!0);return}if(i==!0)n=="current"?e||r=="copy"||spinner2_stopped||$("#myLoadingMenu").modal("show"):n!="autosave"&&doAlert(124,null,0,!0),startAutoSave(),save_menutitle(u,o),save_menufile(n,f,o,r),n=="verbose"&&save_settings();else{n=="current"&&r!="copy"?e||spinner2_stopped||$("#myLoadingMenu").modal("show"):doAlert(268,null,1500,!0);return}}}).fail(function(t,i){if(i=="timeout"||t.responseJSON==undefined){n=="autosave"?doAlert(186,null,9e3,!0):doAlert(212,null,9e3,!0);console.log("Connection seems dead! (save menu)");clearTimeout(autoSessionLogout);return}t.responseJSON.error=="invalid_client"?(doAlert(202,null,9e3,!0),console.log("Token has expired! (save menu)")):(doAlert(204,null,9e3,!0),console.log("Something failed on server! (save menu)"))}))}function copy_menu(){var t,i,r;setMobileUI="copy";var u=jQuery("#access_token").val(),n=getItem("menufile"),o=n.menuID,f=getItem("override.css"),e=jQuery('link[title="origCSS"]').attr("href");n.override=f;n.myStyle=e;t=LZString.compressToBase64(JSON.stringify(n));i=jQuery("#MPstatusBarMenuName").html();setItem("ss_menufile",n);setItem("ss_mytitle",i);r="/api/menu/new/"+u+"/encoded_menu_in_POST/"+CryptoJS.MD5(t).toString()+"/"+Date.now();jQuery.ajax({url:r,type:"POST",data:{menu_data:t},dataType:"json",timeout:12e3,success:function(t){if(t.status=="OK"){save_menu("current","use_sessionStorage",fileTimestamp);n.menuID=t.menu_id;setItem("menufile",n);fileTimestamp=t.last_update;reset_mobileUI("copy");var i="Copy of "+jQuery("#MPstatusBarMenuName").html();jQuery("#MPstatusBarMenuName").html(i);$("#MPstatusBarMenuName").animate({opacity:.1},100);$("#MPstatusBarMenuName").animate({opacity:1},800);save_menutitle();check_mobile_icon();asyncjs_menutitle(null,function(i,r){var f=sortMenuTitle(r);fixMenuData(f);jQuery("#myMenuList").megalist("setDataProvider",f);var u=_.filter(f,function(n){return n.menu_id==t.menu_id}),e=getItem("override.css"),o=jQuery('link[title="origCSS"]').attr("href");n.override=e;n.myStyle=o;u[0].data=encodeURIComponent(LZString.compressToBase64(JSON.stringify(n)));u[0].name=encodeURIComponent(LZString.compressToBase64(u[0].name));save_revert(u[0]);doAlert(142,null,2e3,!0);save_thumbnail()})}else t.status=="limit"?doAlert(90,null,6e3,!0):doAlert(154,null,0,!0)},error:function(n,t){t=="timeout"||n.responseJSON==undefined?(doAlert(188,null,9e3,!0),console.log("Connection seems dead! (make a copy)")):n.responseJSON.error=="invalid_client"?(doAlert(208,null,9e3,!0),console.log("Token has expired! (make a copy)")):(doAlert(210,null,9e3,!0),console.log("Something failed on server! (make a copy)"))}})}function delete_menu(){var n=jQuery("#access_token").val(),t=getItem("menufile"),i=t.menuID,r="/api/menu/"+i+"/"+n;jQuery.ajax({url:r,type:"DELETE",dataType:"json",success:function(n){n.status=="OK"?(clearInterval(autoSaveEvent),asyncjs_menutitle(null,function(n,t){var i=sortMenuTitle(t);fixMenuData(i);jQuery("#myMenuList").megalist("setDataProvider",i);i.length>0?(menu_changes=0,doAlert(144,null,2e3,!0),open_menu("latest")):(new_menu("nosave"),doAlert(146,null,2e3,!0))})):doAlert(148,null,9e3,!0)},error:function(n,t){t=="timeout"||n.responseJSON==undefined?(doAlert(206,null,9e3,!0),console.log("Connection seems dead! (delete menu)")):n.responseJSON.error=="invalid_client"?(doAlert(208,null,9e3,!0),console.log("Token has expired! (delete menu)")):(doAlert(210,null,9e3,!0),console.log("Something failed on server! (delete menu)"))}})}function open_menu(n){heading_desynced_shown=!1;setMobileUI="open";n!="latest"&&save_menu("current","normal",fileTimestamp);$("#SVGMenuPro11").css("opacity",0);n!="latest"?$("#mp-loading-text").html("Loading your menu"):$("#mp-loading-text").html("Loading your last edited menu");firstRunMenu||(start_spinner2(),$("#myLoadingMenu").modal("show"));clear_menu();var t=jQuery("#access_token").val(),i="/api/menu/"+n+"/"+t+"/"+Date.now();jQuery.getJSON(i,function(t){if(n=="latest"||t.menu_id==n)if(t.menu_id==undefined)new_menu("nosave"),stop_spinner(),stop_spinner2(),$("#myLoadingMenu").modal("hide"),setTimeout(function(){doAlert(310,null,11e3,!0);load_revert()},300);else{if(t.data==""||t.data==undefined||t.data==null||t.name==""||t.name==undefined||t.name==null){doAlert(314,null,0,!1);return}fileTimestamp=t.last_update;var i=CryptoJS.MD5(t.data).toString();i!=t.md5&&doAlert(168,null,12e3,!0);set_page_of_x("new_menu");startAutoSave();save_revert(t);$("#loading-status").text("to process");megaloggedin?process_menu(t):(doAlert(274,null,0,!0),setTimeout(function(){process_menu(t);doAlert("",null,0,!0)},4e3))}else doAlert(134,null,0,!0),console.log("open menufile() Error in opening menuID=",n)});heading_desynced_shown=!0}function process_menu(n,t){var r,u,i,f,e;if(!megaloggedin){stop_spinner();stop_spinner2();$("#myLoadingMenu").modal("hide");setTimeout(function(){doAlert(276,"noticea",0,!0)},300);return}$("#loading-status").text("processing");r=LZString.decompressFromBase64(decodeURIComponent(n.name));u="foodpos:"+parseInt(jQuery("#myFoodList ul").css("top"));jQuery("#MPstatusBarMenuName").html(r);jQuery(".spanRenameInput").val(r);r=="Untitled Menu"?$("#MPstatusBarMenuName").addClass("untitledName"):$("#MPstatusBarMenuName").removeClass("untitledName");t!="revert"&&(n.mobile!=""&&n.mobile!=undefined?(Mobile=JSON.parse(base64.decode(n.mobile)),jQuery("#mp-live-sync").prop("checked",Mobile.sync==1),jQuery("#mp-mobile-appearance").val(Mobile.appearance),jQuery("#dialog-mobile-color").spectrum("set",Mobile.color),$("#dialog-mobile-tcolor").spectrum("set",Mobile.tcolor),Mobile.changetcolor==1?($("#mp-change-tcolor").prop("checked",!0),$("#dialog-mobile-tcolor").spectrum("enable")):($("#mp-change-tcolor").prop("checked",!1),$("#dialog-mobile-tcolor").spectrum("disable"),$("#dialog-mobile-tcolor").spectrum("set","rgb(0,0,0)")),$("#more-no-titles").prop("checked",Mobile.notitles==1),$("#more-no-prices").prop("checked",Mobile.noprices==1),$("#more-no-ftext").prop("checked",Mobile.noftext==1),$("#more-no-footer").prop("checked",Mobile.nofooter==1),$("#more-no-cols").prop("checked",Mobile.nocols==1),$("#more-click-pics").prop("checked",Mobile.clickpics==1)):Mobile="");check_mobile_icon();$("#loading-status").text("decoding");i=JSON.parse(LZString.decompressFromBase64(decodeURIComponent(n.data)));ignoreoverride=!0;setItem("override.css",i.override);delete i.override;i.menuID=n.menu_id;setItem("menufile",i);menuVer=i.rect_data.ver==undefined?0:i.rect_data.ver;$("#loading-status").text("sanitize");sanitizeOverride();$("#loading-status").text("writing");emptyStyleSheet();writeToStyleSheet();noloadedMenu=!1;$("#MPFileMenuNav").css("pointer-events","all");$("#mp-topnav-container").css("pointer-events","all");$("#loading-status").text("updating");setTimeout(function(){asyncjs_menutitle(null,function(n,t){$("#myMenuList").megalist("setDataProvider",sortMenuTitle(t))})},300);$("#loading-status").text("refreshing");$("#myFoodList").megalist("setSelectedIndexMove",parseInt(u.slice(9)/41));$("#myFoodList").megalist("clearSelectedIndex",parseInt(u.slice(9)/41));$("#mp-sort-byorder-icon").attr("class")=="icon-ok"&&(f=JSON.parse(sessionStorage.getItem("fooditem")),$("#myFoodList").megalist("setDataProvider",sortFoodData(f)));fixHeadData(i.head_item.header);$("#myHeadingList").megalist("setDataProvider",sortHeadData(i.head_item.header));$("#loading-status").text("promising");e=changeStyle(i.myStyle,"processing");e.then(function(){$("#loading-status").text("resetting");global_columns=parseInt(i.total_columns);$('#myMenuStyleDialog [name="total_columns"]').val(global_columns);setIsUneven(global_columns);resetPageSetupMargins("useOverride");resetPageSetupPaper();resetPageDim();reset="open_menu";$("#loading-status").text("style ok");jQuery("#dialog-menustyle-ok").click();$("#loading-status").text("getting ready");setTimeout(function(){$("#SVGMenuPro11").css("opacity",1);drawMenuCover();$("#mp-food-sidebar").css("opacity",1)},30);ignoreoverride=!1;ignore_openmenu_predos=!1;t!="revert"&&(menu_changes=0);missing_foods&&(menu_changes=1,missing_foods=!1);firstRunMenu&&(firstRunMenu=!1,doWelcome())})}function loadMenuTitleAsync(n,t){var r=jQuery("#access_token").val(),i=newXMLHttpRequest(),u="/api/menu/list/"+r+"/"+Date.now();i.open("get",u,!0);i.onreadystatechange=function(){if(i.readyState==4&&i.status==200)if(i.responseText.match("menu_id")){var n=JSON.parse(i.responseText);n=_.map(n,function(n){return n.name=LZString.decompressFromBase64(decodeURIComponent(n.name)),n});setItem("menuTitle",n);t(null,n)}else i.responseText.match("Food item not found")?t(null,[]):(doAlert(156,null,0,!0),t(null,[]))};i.send()}function sortMenuTitle(n){var i,r,t;return n!=null&&n!=[]?(i=jQuery("#mp-view-menus-bylast").attr("class")=="icon-ok",r=jQuery("#mp-view-menus-byalpha").attr("class")=="icon-ok",i?(t={last_update:"desc",menu_id:"asc"},n.keySort(t)):(t={name:"asc",menu_id:"asc"},n.keySort(t))):[]}function searchMenuTitle(){var t=jQuery("#mp-search-menus").val().toLowerCase(),n=getItem("menuTitle");return t!=""?(n=_.filter(n,function(n){return n.name.toLowerCase().indexOf(t)>-1}),jQuery("#myMenuList").addClass("bluehalo")):jQuery("#myMenuList").removeClass("bluehalo"),n}function fixMenuData(n){var t,i;$("#mp-openmenu-preview-icon").hasClass("icon-list")?(t=7,i=47,jQuery("#myMenuList").megalist("setCellHeight",47),$("#mp-openmenu-megadiv").css("margin-bottom","11px")):(t=2,i=165,$("#myMenuList").megalist("setCellHeight",165),$("#mp-openmenu-megadiv").css("margin-bottom","10px"));typeof n=="boolean"?$("#myMenuList").css("height","0px"):n.length<=t-1?$("#myMenuList").css("height",i*n.length-1+"px"):$("#myMenuList").css("height",i*t-1+"px")}function init_menufile(){var n=getItem("menufile");return n.food_item={order:[],"default":"none;none;;0;0;1;(none);rgb(210,180,138);;Style;;;;"},n.head_item={header:[{head_id:"h0",heading:"My Title",type:"title"},{head_id:"h1",heading:"Sample Heading",type:"normal"},{head_id:"h2",heading:"Subheading - you can edit or delete these headings, or add your own",type:"small"}],"default":"none;none;0;0;1;1;(style);(style);rgb(210,180,138);Style;;",h0:"none;none;0;;1;1;(style);(style);;Style;;",h1:"none;none;0;;1;1;(style);(style);;Style;;",h2:"none;none;0;;1;1;(style);(style);;Style;;"},n.foot_item={footer:"",type:"small",foot_tweaks:"none;none;;1;(none);rgb(210,180,138);center;0.25;0;0","default":"none;none;;1;(none);rgb(210,180,138);center;0.25;0;0",onmenu:1},n.float_text={ftxxx:{float_id:"ftxxx",page:"N",text:"Open 24",param:"0;none;left;(none);rgb(210, 180, 138);0.25;0.25;floating-text;0"}},n.float_images={order:[],"default":"id;url;x;y;width;height;flip;mirror"},n.pagesetup.pagespacing=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],n.pagesetup.pagemarker=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1],n.total_columns=1,global_columns=1,$('#myMenuStyleDialog [name="total_columns"]').val(1),menuVer=n.rect_data.ver=1,n}function clear_menu(n){jQuery("#colline line").remove();jQuery("#colline rect").remove();paper.clear();jQuery("#textcanvas g").remove();jQuery("#footertext g").remove();jQuery("#floattext g").remove();jQuery("#joiner image").remove();n!=undefined&&(jQuery("#menuborder image").remove(),jQuery("#background image").remove())}function isConnected(n){return $.ajax({url:"/tools/isConnected",type:"post",dataType:"text",timeout:12e3,success:function(t){var i=JSON.parse(t);i.status=="OK"?(console.log("Connection is live!"),n()):(doAlert(160,null,9e3,!0),console.log("Server error!"))},error:function(n,t){t=="timeout"||n.responseJSON==undefined?(doAlert(158,null,9e3,!0),console.log("Connection seems dead! (Connected)")):n.responseJSON.error=="invalid_client"?(doAlert(200,null,9e3,!0),console.log("Token has expired! (Connected)")):(doAlert(198,null,9e3,!0),console.log("Something failed on server! (Connected)"))}})}function save_revert(n){sessionStorage.setItem("revert",JSON.stringify(n))}function load_revert(){$("#mp-loading-text").html("Reverting to last opened version");start_spinner2();$("#myLoadingMenu").modal("show");var n=JSON.parse(sessionStorage.getItem("revert"));clear_menu();process_menu(n,"revert");save_menutitle()}function load_revert_undo(){var n=JSON.parse(sessionStorage.getItem("revert.tmp"));clear_menu();process_menu(n,"revert");save_menutitle()}function load_settings(){var n=jQuery("#access_token").val(),t="/api/settings/"+n+"/"+Date.now();$.ajax({url:t,type:"get",dataType:"text",timeout:12e3,success:function(n){var t=JSON.parse(n),i;t["global.ini"]==""?(settings_loaded_from_db=!0,save_settings()):t["global.ini"]!=""&&(i=LZString.decompressFromBase64(decodeURIComponent(t["global.ini"])),i!=""&&(settings=JSON.parse(i),settings_loaded_from_db=!0));reset_settings_UI();loadSmartmarkUI();unitSI=jQuery("#dialog-setting-unitSI").val()},error:function(n,t){t=="timeout"||n.responseJSON==undefined?(settings_loaded_from_db=!1,reset_settings_UI(),doAlert(190,null,9e3,!0),console.log("Connection seems dead! (load settings)")):n.responseJSON.error=="invalid_client"?(doAlert(194,null,9e3,!0),console.log("Token has expired! (load settings)")):(doAlert(196,null,9e3,!0),console.log("Something failed on server! (load settings)"))}})}function save_settings(){if(settings_loaded_from_db){var n=jQuery("#access_token").val(),t=LZString.compressToBase64(JSON.stringify(settings)),i="/api/settings/"+n+"/settings_in_POST/"+Date.now();jQuery.post(i,{settings:t},function(n){var t=JSON.parse(n);t.status=="OK"?isMenuSaved+=":settings_OK":doAlert(162,null,3e3,!0)})}}function reset_settings_UI(){restoreSettings();resetZoomSettings();resetGrid();resetMenuCover();resetUnitSI();restoreCertificate();resetViewSettings();var n=JSON.parse(sessionStorage.getItem("fooditem"));setTimeout(function(){jQuery("#myFoodList").megalist("setDataProvider",sortFoodData(n))},80)}function save_thumbnail(){var n,t;if(!kill_thumbs&&!nosaveMenu&&!noloadedMenu){make_rect_inactive();n=getItem("menufile");last_thumb_id=n.menuID;var i=jQuery("#access_token").val(),r=jQuery('link[title="origCSS"]').attr("href"),u=xmltopdf("thumb");jQuery('#genpdf input[name="mySVGstr[]"]').remove();t="/tools/MenuProJPG";jQuery.ajax({timeout:6e3,type:"POST",url:t,dataType:"json",data:{isLandscape:n.pagesetup.orientation,myPDFMenuTitle:n.menuID,access_token:i,mySVGstr:u,myStyleSheet:r},success:function(){setJPGtime(n.menuID)}});make_rect_active()}}function getJPGtime(n){return myJPGtime[n+""]||curr_time}function setJPGtime(n){myJPGtime[n+""]=Date.now()}function rx11(){var t=sessionStorage.getItem("rx11"),i=getItem("revert"),n=getItem("menufile"),r;$("#MPstatusBarMenuName").hasClass("untitledName")&&n.food_item.order.length==0&&nosaveMenu!=!1&&t!="{}"?(nosaveMenu=!1,i.data=t,sessionStorage.setItem("revert",JSON.stringify(i)),load_revert(),n=getItem("menufile"),r=n.menuID,doAlert("menuID = "+r+" If all looks OK:<br><br>1) rename menu<br>2) click SAVE<br>3) then refresh to exit and return with noSave.<br><br>Else, refresh (exit) WITHOUT saving.","noticeb",0,!0)):doAlert("Must be new menu, blank, and noSave mode with rx11 file loaded","noticea",3e3,!0)}function disableFontSelects(){$("#fontFamTitle").addClass("muted");$("#fontStyleTitle").addClass("muted");$("#fontFamily-select").attr("disabled",!0);$("#fontStyle-select").attr("disabled",!0)}function enableFontSelects(){$("#fontFamTitle").removeClass("muted");$("#fontStyleTitle").removeClass("muted");$("#fontFamily-select").attr("disabled",!1);$("#fontFamily-select").attr("disabled",!1);$("#fontStyle-select").attr("disabled",!1);var n=jQuery('[name="fontFamily"]').selected().val();sampleFontFamily(n,"cufonts")}function showImportFontAlert(n){var t=JSON.parse(n);async.parallel([function(){t.status=="OK"?(doAlert(6,null,1e3,!0),importImageData("user_font"),drawUserImageFONT("https://"+s3bkt+".s3.amazonaws.com/"+t.s3name,t.idx,t.TTF_name),$("#myUploadPreviewFONT").addClass("mpFontInUse"),disableFontSelects(),$("#jansy-img-uploadFONT").fileupload("reset"),$("#jansyConfirmWellFONT").hide(),$("#jansyUploadWellFONT").hide(),$("#jansyRemoveWellFONT").show(),$("#mp-acct-cufonts").text(parseInt($("#mp-acct-cufonts").text())+1),sampleFontFamily(),uploaded_font=!0,setTimeout(function(){warnIEFontUsers()},1500)):doAlert(t.error,"error",8e3,!0)}],function(){});setTimeout(function(){enableUploadUI()},300)}function disableUploadUI(){$("#mp-font-img-confirm").attr("disabled",!0);$("#mp-imgupload-remove-btnFONT").attr("disabled",!0);$("#chngfontup").addClass("muted");$("#dialog-changefont-default").attr("disabled",!0);$("#dialog-changefont-ok").attr("disabled",!0)}function enableUploadUI(){$("#mp-font-img-confirm").attr("disabled",!1);$("#mp-imgupload-remove-btnFONT").attr("disabled",!1);$("#chngfontup").removeClass("muted");$("#dialog-changefont-default").attr("disabled",!1);$("#dialog-changefont-ok").attr("disabled",!1)}function drawUserImageFONT(n,t,i){jQuery("#jansy-img-uploadFONT").fileupload("reset");jQuery("#myUploadPreviewFONT").html('<img src="" >');jQuery("#myUploadPreviewFONT img").attr("src",n);i!=undefined&&jQuery("#myUploadPreviewFONT").html('<img src="" style="display:none" >'+i);jQuery("#myUploadPreviewFONT img").attr("class",t)}function resetCustomFontUI(){$("#myUploadPreviewFONT").removeClass("dont_select_ptr");$("#mp-fi-fontmap, #mp-up-browse-noteFONT").hide();$("#mp-font-footer").show();$("#mp-fontstate").hasClass("mp-newfont")?($("#jansyUploadWellFONT").show(),$("#jansyRemoveWellFONT").hide(),enableFontSelects(),jQuery("#myUploadPreviewFONT").html('<img src="" >'),jQuery("#myUploadPreviewFONT img").attr("src","bootstrap/img/noFont.png")):($("#jansyUploadWellFONT").hide(),$("#jansyRemoveWellFONT").show(),disableFontSelects());$("#jansyConfirmWellFONT").hide();enableUploadUI();$("#mp-imgupload-deletepanelFONT").hide();$("#mp-imgupload-trashcanFONT").hide();$("#mp-font-useimg-div").show();$("#mp-font-useimg-hr").show();$("#mp-imgupload-findFONT").show();$("#mp-up-trash-divFONT").show();$("#mp-imgupload-searchFONT").show();$("#mp-imgupload-cancel-selectFONT").show();$("#mp-imgupload-selectFONT").show();$("#mp-up-browse-noteFONT").show();$("#jansy-img-uploadFONT").fileupload("reset");resetUISearchFONT()}function setFontState(n){n==="new"?($("#mp-fontstate").removeClass("mp-editfont"),$("#mp-fontstate").addClass("mp-newfont")):($("#mp-fontstate").removeClass("mp-newfont"),$("#mp-fontstate").addClass("mp-editfont"))}function warnIEFontUsers(){!demoMenu&&parseInt($("#mp-acct-cufonts").text())>0&&(isIE||isIE9)&&doAlert(334,null,9e3,!0)}function setFSize(n){var t=$("#fontSize").val();t!=n&&($("#fontSize").val(n),$("#fontSize").trigger("change"))}var asyncjs_menutitle=async.compose(loadMenuTitleAsync),async_get=async.compose(async_library.get),doNothing=function(){},s3bkt="menupro",heading_changed=!1,gicon_px=20,imageData="",font_serif={arimo:'"arimo", sans-serif',tangerine:'"tangerine", sans-serif',"open sans":'"open sans", sans-serif',"open sans condensed":'"open sans condensed", sans-serif',"open sans condensed light":'"open sans condensed light", sans-serif',cabin:'"cabin", sans-serif',"archivo narrow":'"archivo narrow", sans-serif',balthazar:'"balthazar", serif',lobster:'"lobster", sans-serif',"josefin slab":'"josefin slab", serif',matchbook:'"matchbook", sans-serif',"monsieur la doulaise":'"monsieur la doulaise", sans-serif',"montserrat subrayada":'"montserrat subrayada", sans-serif',montserrat:'"montserrat", sans-serif',"six caps":'"six caps", sans-serif',unifrakturmaguntia:'"unifrakturmaguntia", sans-serif',"carrois gothic sc":'"carrois gothic sc", sans-serif',"anonymous pro":'"anonymous pro", serif',oswald:'"oswald", sans-serif',benchnine:'"benchnine", sans-serif',smokum:'"smokum", serif',petrona:'"petrona", serif',"lilita one":'"lilita one", sans-serif',"oleo script":'"oleo script", sans-serif',"cac champagne":'"cac champagne", sans-serif',"special elite":'"special elite", serif',"playfair display sc":'"playfair display sc", serif',"gravitas one":'"gravitas one", serif',buenard:'"buenard", serif',"jenna sue":'"jenna sue", sans-serif',"gandhi serif":'"gandhi serif", serif',cantarell:'"cantarell", sans-serif',raleway:'"raleway", sans-serif',bevan:'"bevan", serif',rokkitt:'"rokkitt", serif',"antic slab":'"antic slab", serif',"londrina solid":'"londrina solid", sans-serif',"rammetto one":'"rammetto one", sans-serif',"josefin sans":'"josefin sans", sans-serif',engagement:'"engagement", sans-serif',"delius unicase":'"delius unicase", sans-serif',delius:'"delius", sans-serif',asap:'"asap", sans-serif',"vast shadow":'"vast shadow", serif',cardo:'"cardo", serif',"della respira":'"della respira", serif',alegreya:'"alegreya", serif',stoke:'"stoke", serif',elsie:'"elsie", serif',inika:'"inika", serif',volkhov:'"volkhov", serif',"source sans pro":'"source sans pro", sans-serif',niconne:'"niconne", sans-serif',"contrail one":'"contrail one", sans-serif',"germania one":'"germania one", sans-serif',amaranth:'"amaranth", sans-serif',fondamento:'"fondamento", serif',"quattrocento sans":'"quattrocento sans", sans-serif',"holtwood one sc":'"holtwood one sc", sans-serif',rancho:'"rancho", sans-serif',"maiden orange":'"maiden orange", serif',acme:'"acme", sans-serif',"arbutus slab":'"arbutus slab", serif',"stint ultra expanded":'"stint ultra expanded", serif',"kaushan script":'"kaushan script", sans-serif',alice:'"alice", serif',yesteryear:'"yesteryear", sans-serif',oregano:'"oregano", sans-serif',pacifico:'"pacifico", sans-serif',"architects daughter":'"architects daughter", sans-serif',"stardos stencil":'"stardos stencil", serif',frijole:'"frijole", sans-serif',sancreek:'"sancreek", sans-serif',felipa:'"felipa", sans-serif',"pinyon script":'"pinyon script", sans-serif',aladin:'"aladin", sans-serif',muli:'"muli", sans-serif',prata:'"prata", serif',podkova:'"podkova", serif',"diplomata sc":'"diplomata sc", serif',airbag:'"airbag", serif',abel:'"abel", sans-serif',"grand hotel":'"grand hotel", sans-serif',"alegreya sc":'"alegreya sc", serif',"shadows into light two":'"shadows into light two", sans-serif',aubrey:'"aubrey", sans-serif',"bilbo swash caps":'"bilbo swash caps", sans-serif',salsa:'"salsa", sans-serif',tinos:'"tinos", serif'},footer_changed,ha_changed,up_image_changed,ai_image_changed,floatingtext_changed,stylebyname,cameviaresetcmd,byorderonmenu_refresh_needed,background_changed,border_changed,price_repage_needed,priceoptions_changed,newMenu_headings,ignoreoverride,settings_loaded_from_db,editFont;jQuery('[name="HeadingType"],[name="HeadingSpacing"]').on("change",function(n){n.preventDefault();resetHeadItemCustomSpacing();$('[name="HeadingType"]').val()=="small"||global_columns>1?($("#foodcols").prop("disabled",!0),$("#foodcols").addClass("muted"),$(".spanItemsColsTextHD").prop("disabled",!0),$(".spanItemsColsTextHD").addClass("muted")):($("#foodcols").prop("disabled",!1),$("#foodcols").removeClass("muted"),$(".spanItemsColsTextHD").prop("disabled",!1),$(".spanItemsColsTextHD").removeClass("muted"));var t=reset.split(":"),i=t[3];isTitleSpan(i)&&($('[name="HeadingType"]').val()=="small"||$('[name="HeadingType"]').val()=="title"||($('[name="HeadingType"]').val()=="normal"||$('[name="HeadingType"]').val()=="alt-font")&&$("#mp-heading-span").prop("checked")==!0?($("#mp-heading-newpage").prop("disabled",!0),$("#mp-heading-newpage-label").addClass("muted"),$("#np_pin").hide()):($("#mp-heading-newpage").prop("disabled",!1),$("#mp-heading-newpage-label").removeClass("muted"),$("#np_pin").show()))});$("#mp-heading-span").on("change",function(n){n.preventDefault();var t=reset.split(":"),i=t[3];isTitleSpan(i)&&(($('[name="HeadingType"]').val()=="normal"||$('[name="HeadingType"]').val()=="alt-font")&&$("#mp-heading-span").prop("checked")==!1?($("#mp-heading-newpage").prop("disabled",!1),$("#mp-heading-newpage-label").removeClass("muted"),$("#np_pin").show()):($("#mp-heading-newpage").prop("disabled",!0),$("#mp-heading-newpage-label").addClass("muted"),$("#np_pin").hide()))});jQuery("#mp-hd-sym1, #mp-hd-sym2").on("click",function(n){n.preventDefault();heading_changed=!0;$("#mp-delete-heading-alert").hide();$("#mp-headingbox-footer").show();$("#mp-hd-col1, #mp-hd-col2, #mp-hd-col3").hide();$("#mp-hd-symmap").show();symbol_pos=n.target.id=="mp-hd-sym1"?"select-symbol:mp-hd-sym1":"select-symbol:mp-hd-sym2"});jQuery(".mp-hdsym").on("click",function(n){n.preventDefault();$("#mp-hd-symmap").hide();$("#mp-headingbox-footer").show();$("#mp-hd-col1, #mp-hd-col2, #mp-hd-col3").show();var r=symbol_pos.split(":"),t=r[1],i=n.target.innerHTML;i=="none"?(jQuery("#"+t).removeClass("mp-syms"),jQuery("#"+t).addClass("mp-syms-none")):i=="cancel"?i=jQuery("#"+t).html():(jQuery("#"+t).removeClass("mp-syms-none"),jQuery("#"+t).addClass("mp-syms"));jQuery("#"+t).html(i)});$('.spanHeadingTextArea, #foodcols, #mp-heading-newpage, #mp-heading-wrap, #mp-heading-span, #dialog-heading-onmenu, [name="HeadingType"], [name="HeadingAlignment"], [name=HeadingSpacing], #mp-heading-before, #mp-heading-after,  #mp-heading-accent-select').on("change",function(){heading_changed=!0});jQuery("#dialog-heading-ok").on("click",function(n){n.preventDefault();var i=getItem("menufile"),r=_.keys(i.head_item),t=r.length-2;reset&&t--;t>=maxHead&&(demoMenu?doAlert(230,null,4e3,!0):doAlert(232,null,6e3,!0),heading_changed=!1);heading_changed?(jQuery("#myHeadingDialog").modal("hide"),mp_predo("heading_edit",page_no),start_spinner(),disable_toolbar(),setTimeout(function(){var i=getItem("menufile"),w=getItem("origCSS"),c=!1,v,r,p,e,k,t,h,o,nt,tt,it,s,u,f;if(reset){var a=reset.split(":"),l=a[1],n=a[3],ct=a[5],b=i.head_item[n].replace(/^((?:[^;]*;){4})([^;]*)(.*)/,"$2"),v=list_foodgroup(n),r=list_titlespan();c=i.head_item.header[l].type=="small"}else{var y=_.pluck(i.head_item.header,"head_id"),rt=_.range(y.length+5),ut=_.map(rt,function(n){return"h"+n}),ft=_.difference(ut,y),n=ft[0],l=y.length,b=jQuery("#foodcols").val();i.head_item.header[l]={head_id:n};v=[];r="new"}if(p=jQuery("#foodcols").val(),p!=b&&$("#colline").hide(),e=jQuery(".spanHeadingTextArea").val(),e=fixEntitiesHackx(e.decodeLTGT()),settings.imenupro.fcodes&&$("#dialog-heading-onmenu").prop("checked")&&mismatchedTags(e)===!0&&doAlert(344,null,9e3,!0),i.head_item.header[l].heading=encodeData(e),i.head_item.header[l].type=jQuery('[name="HeadingType"]').val(),c=c||jQuery('[name="HeadingType"]').val()=="small",k=jQuery("#dialog-heading-onmenu").prop("checked"),t=$("#mp-hd-sym1").text().length>1?"none":encodeData(jQuery("#mp-hd-sym1").text()),t+=$("#mp-hd-sym2").text().length>1?";none":";"+encodeData(jQuery("#mp-hd-sym2").text()),t+=";"+(jQuery("#mp-heading-newpage").prop("checked")==!0?1:0),t+=";"+isRTLtext(e),t+=";"+jQuery("#foodcols").val(),t+=";"+(jQuery("#mp-heading-wrap").prop("checked")==!0?1:0),t+=";"+jQuery('[name="HeadingAlignment"]').val(),h=jQuery('[name="HeadingAccent"]').selectpicker("val"),t+=h==null||h==undefined||h==""?";(style)":";"+h,t+=";"+($("#mp-heading-span").prop("checked")==!0?1:0),jQuery("input[name=HeadingSpacing]:checked").val()=="Style")t+=";Style;;";else{t+=";Custom";o=jQuery('[name="HeadingType"]').val();o=o=="normal"?"heading":o+"-heading";var et=parseFloat(w["."+o]["space-before"]),ot=parseFloat(w["."+o]["space-after"]),st=numToNum(jQuery("#mp-heading-before").val(),unitSI,"in",!0),ht=numToNum(jQuery("#mp-heading-after").val(),unitSI,"in",!0),d=numCheck(st,"-0.2","8.0",et,!0),g=numCheck(ht,"0.0","8.0",ot,!0);jQuery("input[name=HeadingSpacing]:checked").val()=="Style"&&(d="",g="");t+=";"+d;t+=";"+g}if(i.head_item[n+""]=t,setItem("menufile",i),useDrawTo=page_no+"update_text_only",k){jQuery("#headitem_"+n).remove();jQuery("#headitem_"+n+"u").remove();update_headitem_menufile(n,"on_edit");var u=list_titlespan(),lt=_.union(_.difference(u,r),_.difference(r,u)),s=[];r!="new"&&(u=list_titlespan(),s=_.union(_.difference(u,r),_.difference(r,u)));nt=list_foodgroup(n);f=_.union(s,v,nt);(b!=p||c||s.length>0)&&(_.each(f,function(n){n.indexOf("h")==-1?(jQuery("#fooditem_"+n).remove(),jQuery("#fooditem_"+n+"u").remove()):(jQuery("#headitem_"+n).remove(),jQuery("#headitem_"+n+"u").remove())}),_.each(f,function(n){var t,i;n.indexOf("h")==-1?(t=calculate_col_food(n),iMenuPro.print_fooditem(n,t),isUneven&&(i=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_fooditem(n,i,"isUneven"))):(t=calculate_col_width(null,"with_col_width")[0],iMenuPro.print_headitem(n,t,isTitleSpan(n)),isUneven&&(i=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_headitem(n,i,isTitleSpan(n),"isUneven")))}));tt=calculate_col_width(null,"with_col_width")[0];iMenuPro.print_headitem(n,tt,isTitleSpan(n));isUneven&&(it=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_headitem(n,it,isTitleSpan(n),"isUneven"))}else s=[],update_headitem_menufile(n,"off_edit"),u=list_titlespan(),r!="new"&&(s=_.difference(u,r)),f=_.union(s,v),jQuery("#headitem_"+n).remove(),jQuery("#headitem_"+n+"u").remove(),f.length>0?(_.each(f,function(n){n.indexOf("h")==-1?(jQuery("#fooditem_"+n).remove(),jQuery("#fooditem_"+n+"u").remove()):(jQuery("#headitem_"+n).remove(),jQuery("#headitem_"+n+"u").remove())}),_.each(f,function(n){var t,i;n.indexOf("h")==-1?(t=calculate_col_food(n),iMenuPro.print_fooditem(n,t),isUneven&&(i=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_fooditem(n,i,"isUneven"))):(t=calculate_col_width(null,"with_col_width")[0],iMenuPro.print_headitem(n,t,isTitleSpan(n)),isUneven&&(i=calculate_col_width(null,"with_col_width")[1],iMenuPro.print_headitem(n,i,isTitleSpan(n),"isUneven")))})):r!="new"?iMenuPro.drawto_text(page_no,"update_text_only"):stop_spinner();make_rect_active();fixHeadData(i.head_item.header);jQuery("#myHeadingList").megalist("setDataProvider",sortHeadData(i.head_item.header))},minSpinOffload)):jQuery("#dialog-heading-cancel").click();heading_changed=!1});jQuery("#mp-heading-trashcan").on("click",function(n){n.preventDefault();$("#mp-hd-symmap").hide();$("#mp-hd-col1, #mp-hd-col2, #mp-hd-col3").show();$("#mp-headingbox-footer").hide();$("#mp-delete-heading-alert").show()});jQuery("#mp-cancel-deleteheading-button").on("click",function(n){n.preventDefault();$("#mp-delete-heading-alert").hide();$("#mp-headingbox-footer").show()});jQuery("#dialog-heading-cancel, #dialog-heading-x").on("click",function(n){n.preventDefault();heading_changed=!1;$("#mp-hd-symmap").hide();$("#mp-hd-col1, #mp-hd-col2, #mp-hd-col3").show();$("#mp-delete-heading-alert").hide();$("#mp-headingbox-footer").show()});jQuery("#myHeadingDialog").keyup(function(n){n.which==27&&(heading_changed=!1,$("#mp-hd-symmap").hide(),$("#mp-hd-col1, #mp-hd-col2, #mp-hd-col3").show(),$("#mp-delete-heading-alert").hide(),$("#mp-headingbox-footer").show(),$("#headaccent-hidden-select").trigger("click"))});jQuery("#mp-deleteheading-button,#mp-deleteheading-confirm").on("click",function(n){n.preventDefault();mp_predo("heading_delete",page_no);start_spinner();setTimeout(function(){isFF&&jQuery("#colline").children().remove();var n=getItem("menufile"),t=reset.split(":"),r=t[1],i=t[3],e=t[5],u=jQuery("#"+u).index(),f=_.indexOf(n.food_item.order,i);f>-1?remove_from_menu("delete"):setTimeout(function(){stop_spinner()},minSpinOffloadStop);n.food_item.order=_.without(n.food_item.order,i);n.head_item.header.splice(r,1);delete n.head_item[i];setItem("menufile",n);jQuery("#myHeadingDialog").modal("hide");jQuery("#myDeleteHeading").modal("hide");fixHeadData(n.head_item.header);jQuery("#myHeadingList").megalist("setDataProvider",sortHeadData(n.head_item.header))},minSpinOffload);$("#mp-delete-heading-alert").hide();$("#mp-headingbox-footer").show();heading_changed=!1});jQuery("#dialog-heading-help").on("click",function(){window.open("http://help.imenupro.com/food-items-headings.htm#menu-headings")});jQuery("#mp-menuhead-new,#menu-new-heading").on("click",function(n){n.preventDefault();reset="";updateHeadItemModal();focusOnThis(".spanHeadingTextArea")});$("#mp-heading-newpage").on("click",function(){$("#mp-heading-newpage").prop("checked")==!0?$("#np_pin").addClass("icon-pushpin"):$("#np_pin").removeClass("icon-pushpin")});$("#myHeadingDialog").on("shown",function(){global_columns>1||$('[name="HeadingType"]').val()=="small"?($("#foodcols").prop("disabled",!0),$("#foodcols").addClass("muted"),$(".spanItemsColsTextHD").prop("disabled",!0),$(".spanItemsColsTextHD").addClass("muted")):($("#foodcols").prop("disabled",!1),$("#foodcols").removeClass("muted"),$(".spanItemsColsTextHD").prop("disabled",!1),$(".spanItemsColsTextHD").removeClass("muted"));global_columns==1?($("#mp-heading-span").prop("disabled",!0),$("#mp-heading-span-label").addClass("muted")):($("#mp-heading-span").prop("disabled",!1),$("#mp-heading-span-label").removeClass("muted"));$("#mp-heading-newpage").prop("checked")==!0?$("#np_pin").addClass("icon-pushpin"):$("#np_pin").removeClass("icon-pushpin");var n=reset.split(":"),t=n[3];isTitleSpan(t)&&($('[name="HeadingType"]').val()=="small"||$('[name="HeadingType"]').val()=="title"||($('[name="HeadingType"]').val()=="normal"||$('[name="HeadingType"]').val()=="alt-font")&&$("#mp-heading-span").prop("checked")==!0)?($("#mp-heading-newpage").prop("disabled",!0),$("#mp-heading-newpage-label").addClass("muted"),$("#np_pin").hide()):($("#mp-heading-newpage").prop("disabled",!1),$("#mp-heading-newpage-label").removeClass("muted"),$("#np_pin").show())});footer_changed=!1;$('.spanFooterTextArea , [name="footerType"], #mp-footer-onmenu, .spanFooterRemovePageIn, [name="footerWrap"], #dialog-footer-accent-color, [name="footerAlign"], #footerMargin, #mp-footer-accent-select').on("change",function(){footer_changed=!0});jQuery("#mp-footer-modal").on("click",function(){updateFooterModal();focusOnThis(".spanFooterTextArea")});$("#footertext").on("click",function(n){n.preventDefault();$("#myFooterDialog").modal("show")});jQuery("#dialog-footer-ok").on("click",function(n){var t,u,f,o;if(n.preventDefault(),jQuery("#myFooterDialog").modal("hide"),footer_changed){mp_predo("footer",page_no);var r=getItem("menufile"),e=.25,i=jQuery(".spanFooterTextArea").val(),s=jQuery('[name="footerType"]').val();allblanks(i)&&(i="");i=fixEntitiesHackx(i.decodeLTGT());settings.imenupro.fcodes&&$('[name="footerOnmenu"]').prop("checked")&&$("#mp-ft-useEmbed").prop("checked")==!1&&mismatchedTags(i)===!0&&doAlert(344,null,9e3,!0);t=encodeData(jQuery("#mp-ft-sym1").text());t+=";"+encodeData(jQuery("#mp-ft-sym2").text());t+=";"+encodeData(jQuery(".spanFooterRemovePageIn").val());t+=";"+(jQuery('[name="footerWrap"]').prop("checked")==!0?1:0);u=jQuery("#mp-footer-accent-select").selectpicker("val");t+=u==null||u==undefined||u==""?";(none)":";"+u;t+=";"+jQuery("#dialog-footer-accent-color").spectrum("get").toRgbString();t+=";"+jQuery('[name="footerAlign"]').val();f=jQuery("#footerMargin").val();o=numToNum(jQuery("#footerMargin").val(),unitSI,"in",!0);f=f!=""?numCheck(o,"0","0.85",e,!0):e;t+=";"+f;t+=";"+($("#mp-ft-useEmbed").prop("checked")==!0?1:0);t+=";"+isRTLtext(i);r.foot_item.footer=encodeData(i);jQuery(".spanFooterTextArea").val(i.decodeLTGT());r.foot_item.type=s;r.foot_item.onmenu=jQuery('[name="footerOnmenu"]').prop("checked")?1:0;r.foot_item.foot_tweaks=t;jQuery("#footerMargin").val(numToNum(f,"in",unitSI,!1));setItem("menufile",r);iMenuPro.print_footer();$("#mp-ft-symmap").hide();$("#mp-ft-col1, #mp-ft-col2, #mp-ft-col3").show()}else jQuery("#dialog-footer-cancel").click();footer_changed=!1});jQuery("#dialog-footer-cancel, #dialog-footer-x").on("click",function(n){n.preventDefault();updateFooterModal();footer_changed=!1;$("#mp-ft-symmap").hide();$("#mp-ft-col1, #mp-ft-col2, #mp-ft-col3").show()});jQuery("#myFooterDialog").keyup(function(n){n.which==27&&($("#mp-ft-symmap").hide(),$("#mp-ft-col1, #mp-ft-col2, #mp-ft-col3").show(),updateFooterModal(),footer_changed=!1,$("#headaccent-hidden-select").trigger("click"))});jQuery("#dialog-footer-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#footer")});$("#mp-ft-useEmbed").on("click",function(){updateFTEmbedCodes()});jQuery("#mp-ft-sym1, #mp-ft-sym2").on("click",function(n){n.preventDefault();footer_changed=!0;$("#mp-ft-col1, #mp-ft-col2, #mp-ft-col3").hide();$("#mp-ft-symmap").show();symbol_pos=n.target.id=="mp-ft-sym1"?"select-symbol:mp-ft-sym1":"select-symbol:mp-ft-sym2"});jQuery(".mp-ftsym").on("click",function(n){n.preventDefault();$("#mp-ft-symmap").hide();$("#mp-ft-col1, #mp-ft-col2, #mp-ft-col3").show();var r=symbol_pos.split(":"),t=r[1],i=n.target.innerHTML;i=="none"?(jQuery("#"+t).removeClass("mp-syms"),jQuery("#"+t).addClass("mp-syms-none")):i=="cancel"?i=jQuery("#"+t).html():(jQuery("#"+t).removeClass("mp-syms-none"),jQuery("#"+t).addClass("mp-syms"));jQuery("#"+t).html(i)});var fonts_repage_needed=!1,fonts_changed=!1,userfont_entryname="",uploaded_font=!1;$("#myChangeFontDialog").on("shown",function(){userfont_entryname=$("#myUploadPreviewFONT").text()});$("#dialog-font-color").on("change",function(){fonts_changed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery('[name="fontFamily"]').on("change",function(){var n=jQuery('[name="fontFamily"]').selected().val();loadFontStyleUI(n);sampleFontFamily(n);fonts_repage_needed=!0;fonts_changed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery('[name="fontStyle"]').on("change",function(){var t=jQuery('[name="fontStyle"]').selected().val(),n=toFontCSS(t),i=n[0],r=n[1];jQuery("#sampleFonttext").find("tspan").css("font-weight",i);jQuery("#sampleFonttext").find("tspan").css("font-style",r);fonts_repage_needed=!0;fonts_changed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery('[href="#myChangeFontDialog"]').on("click",function(n){reset=n.currentTarget.name.replace(/fontMenu/g,"editing-index");changeFontDialog(reset)});jQuery('[name="fontSize"]').on("change",function(n){n.preventDefault();sampleFontSize();fonts_repage_needed=!0;fonts_changed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery('[name="fontAllCaps"]').on("change",function(n){var t=jQuery(n.target).prop("checked");sampleFontCaps(t);fonts_repage_needed=!0;fonts_changed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery('[name="fontStroke"]').on("change",function(){sampleFontStrokeShadow();fonts_changed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery('[name="fontSpacing"]').on("change",function(n){var t=n.target.value;jQuery("#sampleFonttext").find("tspan").css("letter-spacing",t);fonts_repage_needed=!0;fonts_changed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery('[name="fontUnderline"],[name="fontOverline"]').on("change",function(){sampleFontTextDeco();fonts_changed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery('[name="fontShadow"]').on("change",function(n){var t=jQuery(n.target).prop("checked");sampleFontShadow(t);sampleFontBackground();fonts_changed=!0;fonts_repage_needed=!0;reset=reset.replace(/useDefault/g,"editing-index")});jQuery("#dialog-changefont-default").on("click",function(n){n.preventDefault();fonts_changed=!0;reset=reset.replace(/editing\-index/g,"useDefault");changeFontDialog(reset);fonts_repage_needed=!0});jQuery("#dialog-changefont-ok").on("click",function(n){n.preventDefault();var t=$("#myUploadPreviewFONT").text();fonts_changed||t!=userfont_entryname||uploaded_font&&(t!=""||userfont_entryname!="")?(jQuery("#myChangeFontDialog").modal("hide"),mp_predo("font",page_no),start_spinner(),disable_toolbar(),setTimeout(function(){var o=reset.split(":"),n="."+o[1],i=getItem("override.css"),s=getItem("origCSS"),r,u,a,e;jQuery("#fontFamily-select").attr("disabled")=="disabled"?(r=jQuery("#myUploadPreviewFONT").text(),u="Regular"):(r=jQuery('[name="fontFamily"]').selected().val(),u=jQuery('[name="fontStyle"]').selected().val(),u||(u=jQuery('[name="fontStyle"] option:first-child').val()));var v=parseInt(jQuery('[name="fontSize"]').val()),y=jQuery('[name="fontSpacing"]').val(),h=jQuery('[name="fontOverline"]').prop("checked"),c=jQuery('[name="fontUnderline"]').prop("checked"),p=jQuery('[name="fontAllCaps"]').prop("checked"),w=jQuery('[name="fontStroke"]').prop("checked"),f=jQuery('[name="fontShadow"]').prop("checked"),b=jQuery("#sampleFonttext").find("text").last().find("tspan").css("fill"),k=jQuery("#sampleFonttext").find("text").last().find("tspan").css("fill-opacity"),w=jQuery("#sampleFonttext").find("text").last().find("tspan").css("stroke"),d=jQuery("#sampleFonttext").find("text").last().find("tspan").css("stroke-opacity"),g=jQuery("#sampleFonttext").find("text").last().find("tspan").css("stroke-width"),l=toFontCSS(u),nt=l[0],o=l[1];f_deco=h&&c?"overline underline":h?"overline":c?"underline":"none";f=f?s[n]["itext-shadow"]=="none"?"2px 3px 0px #d1ced1":s[n]["itext-shadow"]:"none";i[n]={};jQuery("#fontFamily-select").attr("disabled")=="disabled"?(i[n]["font-family"]=r,a=_.pluck(imageFONT,"filename"),e=_.indexOf(a,r),i[n]["font-url"]=imageFONT[e].image,i[n]["font-idx"]=imageFONT[e].category):(delete i[n]["font-url"],delete i[n]["font-idx"],i[n]["font-family"]=font_serif[r.replace(/_/g," ")]);i[n]["font-size"]=v;i[n]["font-style"]=o;i[n]["font-weight"]=nt;i[n]["letter-spacing"]=y;i[n]["text-decoration"]=f_deco;i[n].icaps=p?"yes":"no";i[n]["itext-shadow"]=f;i[n].fill=b;i[n]["fill-opacity"]=k;i[n].stroke=w;i[n]["stroke-opacity"]=d;i[n]["stroke-width"]=g;setItem("override.css",i);writeToStyleSheet("doOne");reset.indexOf("Floating_Text")>-1&&(fonts_repage_needed=!1);fonts_repage_needed||t!=userfont_entryname?(setPredoOptimizer(!1),iMenuPro.draw_text(page_no)):(setPredoOptimizer(!0),iMenuPro.drawto_text(page_no));reset.indexOf("useDefault")>-1&&(noOverride(n),reset="");leafd();fonts_repage_needed=!1;fonts_changed=!1;userfont_entryname="";uploaded_font=!1},minSpinOffload)):jQuery("#dialog-changefont-cancel").click()});$("#menu-reset-fonts1a,#button-resetfonts").on("click",function(n){n.preventDefault();$("#menu-reset-fonts1").hasClass("disabled")?(doAlert(226,null,2500,!0),n.stopPropagation()):(mp_predo("resetfonts",page_no),start_spinner(),disable_toolbar(),setTimeout(function(){var n=_.pluck(document.styleSheets,"href"),t=_.indexOf(n,"https://"+window.location.host+"/SVG/fontsoverride.css"),i=document.styleSheets[t].cssRules.length;i>0&&emptyStyleSheet();emptyStorageFonts();iMenuPro.draw_text();leafd();doAlert(110,null,2e3,!0)},minSpinOffload))});jQuery("#myChangeFontDialog").keypress(function(n){n.which==13&&(n.preventDefault(),sampleFontSize())});jQuery("#dialog-changefont-x, #dialog-changefont-cancel").on("click",function(n){n.preventDefault();fonts_repage_needed=!1;fonts_changed=!1;userfont_entryname="";uploaded_font=!1;resetCustomFontUI();editFont="";enableUploadUI()});$("#myChangeFontDialog").keyup(function(n){n.which==27&&(fonts_repage_needed=!1,fonts_changed=!1,userfont_entryname="",uploaded_font=!1,resetCustomFontUI(),editFont="",enableUploadUI())});jQuery("#dialog-changefont-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#fonts")});jQuery("#button-shrinkfonts,#button-growfonts,#menu-shrinkfonts,#menu-growfonts").on("click",function(n){var t=.94;n.preventDefault();start_spinner();disable_toolbar();setTimeout(function(){var r,u;n.currentTarget.id=="button-shrinkfonts"||n.currentTarget.id=="menu-shrinkfonts"?(mp_predo("shrinkfonts",page_no),r=t,u=-1):(mp_predo("growfonts",page_no),r=1/t,u=1);var i=getItem("override.css"),f=getItem("origCSS");jQuery.extend(!0,f,i);jQuery.each([".name",".description",".price",".extras",".title-heading",".heading",".alt-font-heading",".small-heading"],function(n,t){var o=parseInt(f[t]["font-size"]),e=parseInt(o*r+.5);o==e&&(e+=u);e<6&&(e=6);e>72&&(e=72);i[t]||(i[t]={});i[t]=f[t];i[t]["font-size"]=e;delete i[t]["space-before"];delete i[t]["space-after"];delete i[t].indent;delete i[t].justification;delete i[t]["white-space"];delete i[t]["text-rendering"];delete i[t]["-moz-font-feature-settings"];delete i[t]["-ms-font-feature-settings"]});setItem("override.css",i);writeToStyleSheet();iMenuPro.draw_text(page_no);leafd()},minSpinOffload)});$("#mp-refresh").on("click",function(n){n.preventDefault();start_spinner();setTimeout(function(){iMenuPro.draw_text(page_no)},minSpinOffload)});$("#mp-refresh-to").on("click",function(n){n.preventDefault();start_spinner();setTimeout(function(){iMenuPro.drawto_text(page_no);$("#dialog-grid-onmenu").prop("checked")&&($(".rr, .rr2, .rr3").css("fill","#ff3b30"),$(".rr, .rr2, .rr3").css("fill-opacity","0.27"),$(".rr").css("stroke","#31AAFD"),$(".rr, .rr2, .rr3").css("stroke-opacity","1.0"),$(".rr, .rr2, .rr3").css("display","inline-block"))},minSpinOffload)});$("#mp-refresh-fi").on("click",function(n){n.preventDefault();start_spinner();setTimeout(function(){async.parallel([function(n){var t=jQuery("#access_token").val(),i="/api/food/all/"+t+"/"+Date.now();async_library.get(i,n)}],function(n,t){processFoodData(t[0])})},minSpinOffload);setTimeout(function(){stop_spinner()},minSpinOffloadStop)});$("#dialog-chalk-ok").on("click",function(n){n.preventDefault();$("#myChalkboardDialog").modal("hide");mp_predo("chalkboard",page_no);start_spinner();setTimeout(function(){var n=getItem("override.css"),u,i,r,t;n[".background"]={};n[".border"]={};n[".symbol"]={};n[".style"]={};n[".title-heading-accent"]={};n[".heading-accent"]={};n[".small-heading-accent"]={};n[".alt-font-heading-accent"]={};n[".background"].image="paper";n[".background"]["background-margin"]="0.0";n[".background"].opacity="1.0";n[".background"]["paper-color"]="#38383a";n[".background"].mirror="no";n[".background"].flip="no";n[".background"].preserveAspectRatio="no";n[".border"].color="#e9e9ea";n[".border"]["fill-opacity"]="1.0";n[".border"]["stroke-opacity"]="1.0";n[".border"].image=$("#dialog-border-select").val();n[".border"]["border-margin"]=$("#dialog-border-margin").val();n[".border"].mirror=$("#dialog-border-mirror").prop("checked")?"yes":"no";n[".border"].flip=$("#dialog-border-flip").prop("checked")?"yes":"no";n[".symbol"]["fill-1"]="#ececec";n[".symbol"]["fill-2"]="#ececec";n[".symbol"]["fill-opacity1"]="1.0";n[".symbol"]["fill-opacity2"]="1.0";n[".symbol"].large=$('[name="symsize"]').prop("checked")?"yes":"no";n[".symbol"]["keep-inline"]=$('[name="keep-inline"]').prop("checked")?"yes":"no";n[".style"].fill="#b4b4b7";n[".style"]["stroke-opacity"]="1.0";n[".style"]["line-spacing"]=$('#myColumnLayoutOptionsDialog [name="line-spacing"]').val();n[".style"]["stroke-width"]=$('#myColumnLayoutOptionsDialog [name="stroke-width"]').val();n[".style"]["shorter-line"]=$('#myColumnLayoutOptionsDialog [name="shorter-line"]').prop("checked")?"yes":"no";n[".style"]["line-between-columns"]=$('#myColumnLayoutOptionsDialog [name="line-between-columns"]').prop("checked")?"yes":"no";n[".style"]["line-type"]=$('#myColumnLayoutOptionsDialog [name="line-type"]').val();n[".style"]["width-balance"]=$("#width-balance").slider("value");n[".style"]["space-between-columns"]=$('#myColumnLayoutOptionsDialog [name="space-between-columns"]').val();n[".style"]["extras-separator"]=$('#myColumnLayoutOptionsDialog [name="extras-separator"]').val();n[".style"]["desc-separator"]=$('#myColumnLayoutOptionsDialog [name="desc-separator"]').val();n[".style"]["desc-right-indent"]=$('#myColumnLayoutOptionsDialog [name="desc-right-indent"]').val();u=$('#myColumnLayoutOptionsDialog [name="desc-left-indent"]').val();u.indexOf(";")>-1?(n[".style"]["desc-left-indent"]=$('#myColumnLayoutOptionsDialog [name="desc-left-indent"]').val(),i=$('#myColumnLayoutOptionsDialog [name="desc-left-indent"]').val().split(";"),n[".style"]["desc-left-indent"]=i[0],n[".style"]["extras-left-indent"]=i[1]):(r=JSON.parse(sessionStorage.getItem("origCSS")),t=r[".style"]["desc-left-indent"],t=parseFloat(numToNum(t,"in",unitSI,!0)).toFixed(4),t!=parseFloat(numToNum($('#myColumnLayoutOptionsDialog [name="desc-left-indent"]').val(),unitSI,unitSI,!0)).toFixed(4)?(n[".style"]["desc-left-indent"]=$('#myColumnLayoutOptionsDialog [name="desc-left-indent"]').val(),n[".style"]["extras-left-indent"]=$('#myColumnLayoutOptionsDialog [name="desc-left-indent"]').val()):(n[".style"]["desc-left-indent"]=$('#myColumnLayoutOptionsDialog [name="desc-left-indent"]').val(),n[".style"]["extras-left-indent"]=r[".style"]["extras-left-indent"]+'"'));n[".title-heading-accent"].color="#c2c2c4";n[".title-heading-accent"]["fill-opacity"]="1.0";n[".heading-accent"].color="#a6a6a8";n[".heading-accent"]["fill-opacity"]="1.0";n[".small-heading-accent"].color="#c3c3c5";n[".small-heading-accent"]["fill-opacity"]="1.0";n[".alt-font-heading-accent"].color="#c3c3c5";n[".alt-font-heading-accent"]["fill-opacity"]="1.0";n[".title-heading-accent"].name=$("#mp-title-accent-select").selectpicker("val");n[".heading-accent"].name=$("#mp-normal-accent-select").selectpicker("val");n[".small-heading-accent"].name=$("#mp-small-accent-select").selectpicker("val");n[".alt-font-heading-accent"].name=$("#mp-normal-accent-select").selectpicker("val");n=chalkFonts(n);setItem("override.css",n);updateBackgroundUI("override");updateBorderUI("override");resetSymbolOptions("override");resetColumnLayout("override");resetHeadingAccent("override");loadBackground();loadBorder();iMenuPro.updateSymbol();writeToStyleSheet();iMenuPro.redraw_text(page_no);leafd()},minSpinOffload)});$("#dialog-chalk-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#chalkboard")});ha_changed=!1;$("#mp-dialog-title-accent-color, #mp-dialog-normal-accent-color, #mp-dialog-small-accent-color, #mp-colorize-title-checkbox, #mp-colorize-normal-checkbox, #mp-colorize-small-checkbox, #mp-title-accent-select, #mp-normal-accent-select, #mp-small-accent-select").on("change",function(){ha_changed=!0;reset=""});jQuery("#dialog-headingaccents-x, #dialog-headingaccents-cancel").on("click",function(n){n.preventDefault();resetHeadingAccent("override")});$("#myHeadingAccentsDialog").keyup(function(n){n.which==27&&(resetHeadingAccent("override"),$("#headaccent-hidden-select").trigger("click"))});jQuery("#dialog-headingaccents-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#heading-accents")});jQuery("#dialog-headingaccents-ok").on("click",function(n){if(n.preventDefault(),ha_changed){jQuery("#myHeadingAccentsDialog").modal("hide");mp_predo("accents",page_no);var t=getItem("override.css"),h=jQuery("#mp-title-accent-select").selectpicker("val"),u=jQuery("#mp-normal-accent-select").selectpicker("val"),c=jQuery("#mp-small-accent-select").selectpicker("val"),l=jQuery("#mp-colorize-title-checkbox input").prop("checked"),a=jQuery("#mp-colorize-normal-checkbox input").prop("checked"),v=jQuery("#mp-colorize-small-checkbox input").prop("checked"),f=jQuery("#mp-dialog-title-accent-color").spectrum("get").toHexString(),e=jQuery("#mp-dialog-title-accent-color").spectrum("get").getAlpha(),i=jQuery("#mp-dialog-normal-accent-color").spectrum("get").toHexString(),r=jQuery("#mp-dialog-normal-accent-color").spectrum("get").getAlpha(),o=jQuery("#mp-dialog-small-accent-color").spectrum("get").toHexString(),s=jQuery("#mp-dialog-small-accent-color").spectrum("get").getAlpha();l||(f="none",e=1);a||(i="none",r=1);v||(o="none",s=1);t[".title-heading-accent"]={};t[".heading-accent"]={};t[".small-heading-accent"]={};t[".alt-font-heading-accent"]={};t[".title-heading-accent"].name=h;t[".title-heading-accent"].color=f;t[".title-heading-accent"]["fill-opacity"]=e;t[".heading-accent"].name=u;t[".heading-accent"].color=i;t[".heading-accent"]["fill-opacity"]=r;t[".small-heading-accent"].name=c;t[".small-heading-accent"].color=o;t[".small-heading-accent"]["fill-opacity"]=s;t[".alt-font-heading-accent"].name=u;t[".alt-font-heading-accent"].color=i;t[".alt-font-heading-accent"]["fill-opacity"]=r;setItem("override.css",t);redrawHeadAccents();reset=="reset_accent"&&(noOverride(".title-heading-accent"),noOverride(".heading-accent"),noOverride(".alt-font-heading-accent"),noOverride(".small-heading-accent"),reset="");leafd()}else jQuery("#dialog-headingaccents-cancel").click();ha_changed=!1});jQuery("#mp-colorize-title-checkbox,#mp-colorize-normal-checkbox,#mp-colorize-small-checkbox").on("change",function(n){var t=n.currentTarget.children[0].checked?"enable":"disable";n.currentTarget.id=="mp-colorize-title-checkbox"?jQuery("#mp-dialog-title-accent-color").spectrum(t):n.currentTarget.id=="mp-colorize-normal-checkbox"?jQuery("#mp-dialog-normal-accent-color").spectrum(t):n.currentTarget.id=="mp-colorize-small-checkbox"&&jQuery("#mp-dialog-small-accent-color").spectrum(t)});jQuery("#myUploadImgList").on("change",function(n){var t=jQuery(n.srcElement.get()[0].innerHTML).attr("url"),i=jQuery(n.srcElement.get()[0].innerHTML).attr("idx");drawUserImage(t,i);$("#mp-up-trash-div").show();$("#mp-imgupload-deletepanel").is(":visible")||$("#mp-imgupload-trashcan").show()});jQuery("#file-imgupload").on("change",function(){check_file_imgupload();resetLightenStuff()});$("#mp-imgupload-remove-btn").on("click",function(){resetLightenStuff()});$("#mp-imgupload-btn").on("click",function(n){isIE9&&(n.preventDefault(),doAlert(292,null,7e3,!0))});up_image_changed=!1;$("#ui-watermark-checkbox, #ui-water-percent, #dialog-ui-ratio, #dialog-ui-width, #dialog-ui-height, #dialog-ui-left, #dialog-ui-top").on("change",function(){up_image_changed=!0});jQuery("#dialog-imgupload-ok").on("click",function(n){var s,h,t,r,e,f;if(n.preventDefault(),up_image_changed||$("#dialog-ui-onmenu").prop("checked")==!1||$("#mp-insertUpImage-title").is(":visible")){if(reset=="ui_remove")return image_remove(editImage),jQuery("#myInsertUploadedImageDialog").modal("hide"),resetUserImageUI(),resetUserImageHeader(),!0;var i=getItem("menufile"),u=jQuery("#myUploadPreview img").attr("src"),l=jQuery("#myUploadPreview img").attr("class"),o=$("#ui-watermark").prop("checked")?1:0;if(o>0&&(o=$("#ui-water-percent").val()),s=numToNum(jQuery("#dialog-ui-left").val(),unitSI,"px",!0),h=numToNum(jQuery("#dialog-ui-top").val(),unitSI,"px",!0),s=isNaN(s)?0:s,h=isNaN(h)?0:h,editImage)t=editImage.node.id;else for(t="fi_"+generateUUID();_.contains(i.float_images.order,t)==!0;)t="fi_"+generateUUID();if(demoMenu)"ontouchstart"in document.documentElement?doAlert(108,null,4e3,!0):(r=jQuery("#myUploadPreview").find("img").css("width"),e=jQuery("#myUploadPreview").find("img").css("height"),editImage?(r=editImage.node.width.animVal.value,e=editImage.node.height.animVal.value,editImage.sizer.remove(),editImage.remover.remove(),editImage.remove(),editImage=""):r!=undefined&&doAlert(6,null,1e3,!0),r!=undefined&&(mp_predo("image",page_no),f=paper.image(u,s,h,r,e),f.node.id=t,o?f.node.setAttribute("opacity",o):f.node.removeAttribute("opacity"),image_drag(f),i.float_images.order.push(t),i.float_images[t]={},i.float_images[t].idx=generateUUID().replace(/[^\d]/g,"1"),i.float_images[t].url=u,i.float_images[t].page_no=page_no,i.float_images[t].x=0,i.float_images[t].y=0,i.float_images[t].width=r,i.float_images[t].height=e,i.float_images[t].flip=1,i.float_images[t].mirror=1,i.float_images[t].watermark=o,setItem("menufile",i),imageCheck(f)),jQuery("#myInsertUploadedImageDialog").modal("hide"),resetUserImageUI(),resetUserImageHeader());else if(u!=undefined&&u.indexOf("amazonaws.com")>-1)mp_predo("image",page_no),r=numToNum(jQuery("#dialog-ui-width").val(),unitSI,"px",!0),e=numToNum(jQuery("#dialog-ui-height").val(),unitSI,"px",!0),r=isNaN(r)||r==0?209:r,e=isNaN(e)||e==0?209:e,editImage?(editImage.sizer.remove(),editImage.remover.remove(),editImage.remove(),editImage=""):i.float_images.order.push(t),f=paper.image(u,s,h,r,e),f.node.id=t,o?f.node.setAttribute("opacity",o):f.node.removeAttribute("opacity"),f.node.setAttribute("class",l),image_drag(f),i.float_images[t]={},i.float_images[t].idx=l,i.float_images[t].url=u,i.float_images[t].page_no=page_no,i.float_images[t].x=s,i.float_images[t].y=h,i.float_images[t].width=r,i.float_images[t].height=e,i.float_images[t].flip=1,i.float_images[t].mirror=1,i.float_images[t].watermark=o,setItem("menufile",i),imageCheck(f),jQuery("#myUploadPreview").children().remove(),jQuery("#myInsertUploadedImageDialog").modal("hide"),resetUserImageUI(),resetUserImageHeader();else if(u!=""&&u!=undefined&&u.length<4199999){mp_predo("na");menu_changes=++menu_changes;doAlert(106,"",3e3,!0);var a=jQuery("#file-imgupload").val().replace(/^.*\\|\.[^.]*$/g,""),r=jQuery("#myUploadPreview").find("img").css("width"),e=jQuery("#myUploadPreview").find("img").css("height"),v=jQuery("#access_token").val(),c=newXMLHttpRequest(),y="access_token="+v+"&filename="+encodeURIComponent(a)+"&myimage="+u;c.open("POST","/tools/token-S3upload",!0);c.setRequestHeader("Content-type","application/x-www-form-urlencoded");c.send(y);c.onreadystatechange=function(){var n,u;c.readyState==4&&c.status==200&&(n=JSON.parse(c.responseText),jQuery("#mp-acct-images").text(n.count),n.error?doAlert(n.error,"danger",8e3,!0):(doAlert(6,null,1e3,!0),jQuery("#mp-acct-images").text(n.count),u=paper.image(n.success,s,h,n.width,n.height),u.node.id=t,o?u.node.setAttribute("opacity",o):u.node.removeAttribute("opacity"),u.node.setAttribute("class",n.idx),image_drag(u),i.float_images.order.push(t),i.float_images[t]={},i.float_images[t].idx=n.idx,i.float_images[t].url=n.success,i.float_images[t].page_no=page_no,i.float_images[t].x=0,i.float_images[t].y=0,i.float_images[t].width=r,i.float_images[t].height=e,i.float_images[t].flip=1,i.float_images[t].mirror=1,i.float_images[t].watermark=o,setItem("menufile",i),imageCheck(u),importImageData(),editImage&&(editImage.sizer.remove(),editImage.remover.remove(),editImage.remove(),editImage="")))};jQuery("#myUploadPreview").children().remove();jQuery("#myInsertUploadedImageDialog").modal("hide");resetUserImageUI();resetUserImageHeader()}else u!=""&&u!=undefined?(mp_predo("na"),u.length>4194499&&doAlert(104,"danger",7e3,!0)):($("#myUploadPreview").text()!=""&&doAlert(322,null,6e3,!0),jQuery("#myInsertUploadedImageDialog").modal("hide"),resetUserImageUI(),resetUserImageHeader())}else jQuery("#dialog-imgupload-cancel").click();up_image_changed=!1});jQuery("#dialog-ui-onmenu").on("click",function(){reset=jQuery("#dialog-ui-onmenu").prop("checked")?"":"ui_remove"});jQuery("#dialog-ui-ratio").on("click",function(){jQuery("#dialog-ui-ratio").prop("checked")?(jQuery("#mp-link-aspect-upload").show(),jQuery("#dialog-ui-width").trigger("change")):jQuery("#mp-link-aspect-upload").hide()});$("#ui-watermark").on("click",function(){$("#ui-watermark").prop("checked")?($("#ui-water-percent").attr("disabled",!1),$("#myUploadPreview img").css("opacity",$("#ui-water-percent").val())):($("#ui-water-percent").attr("disabled",!0),$("#myUploadPreview img").css("opacity","1"))});$("#ui-water-percent").on("click",function(){$("#myUploadPreview img").css("opacity",$("#ui-water-percent").val())});jQuery("#dialog-ui-width").on("change",function(){var t=isNaN(parseFloat(jQuery("#dialog-ai-width").val()));if(t||numToNum(jQuery("#dialog-ui-width").val(),unitSI,"px",!0)<20?jQuery("#dialog-ui-width").val(numToNum(editImage.attr("width"),"px",unitSI)):numToNum(jQuery("#dialog-ui-width").val(),unitSI,"px",!0)>9600&&jQuery("#dialog-ui-width").val(numToNum(9600,"px",unitSI)),jQuery("#dialog-ui-ratio").prop("checked")){var i=numToNum(jQuery("#dialog-ui-width").val(),unitSI,"px",!0),r=jQuery("#myUploadPreview img").prop("width"),u=jQuery("#myUploadPreview img").prop("height"),n=i*u/r,f=n>9600?9600:n;jQuery("#dialog-ui-height").val(numToNum(f,"px",unitSI))}});jQuery("#dialog-ui-height").on("change",function(){var t=isNaN(parseFloat(jQuery("#dialog-ui-height").val()));if(t||numToNum(jQuery("#dialog-ui-height").val(),unitSI,"px",!0)<20?jQuery("#dialog-ui-height").val(numToNum(editImage.attr("height"),"px",unitSI)):numToNum(jQuery("#dialog-ui-height").val(),unitSI,"px",!0)>9600&&jQuery("#dialog-ui-height").val(numToNum(9600,"px",unitSI)),jQuery("#dialog-ui-ratio").prop("checked")){var i=numToNum(jQuery("#dialog-ui-height").val(),unitSI,"px",!0),r=jQuery("#myUploadPreview img").prop("width"),u=jQuery("#myUploadPreview img").prop("height"),n=i*r/u,f=n>9600?9600:n;jQuery("#dialog-ui-width").val(numToNum(f,"px",unitSI))}});jQuery("#dialog-imgupload-cancel,#dialog-imgupload-x").on("click",function(){jQuery("#myUploadPreview").html('<img src="" >');editImage="";reset="";resetUISearch();up_image_changed=!1;$("#mp-imgupload-cancel-select").hide();$("#mp-imgupload-select").hide();$("#mp-imgupload-deletepanel").hide();$("#mp-imgupload-trashcan").hide();$("#mp-up-trash-div").hide();$("#myUploadImgList").hide();$("#mp-imgupload-search").hide();$("#mp-imgupload-options").show();$("#mp-imgupload-footer").show();$("#mp-imgupload-browse").show();$("#jansyUploadWell").show();resetUserImageUI();resetUserImageHeader()});$("#myInsertUploadedImageDialog").keyup(function(n){n.which==27&&(jQuery("#myUploadPreview").html('<img src="" >'),editImage="",reset="",resetUISearch(),up_image_changed=!1,$("#mp-imgupload-cancel-select").hide(),$("#mp-imgupload-select").hide(),$("#mp-imgupload-deletepanel").hide(),$("#mp-imgupload-trashcan").hide(),$("#mp-up-trash-div").hide(),$("#mp-imgupload-search").hide(),$("#myUploadImgList").hide(),$("#mp-imgupload-options").show(),$("#mp-imgupload-footer").show(),$("#mp-imgupload-browse").show(),$("#jansyUploadWell").show(),resetUserImageUI(),resetUserImageHeader())});jQuery("#dialog-imgupload-help,#dialog-imgupload-edit-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#images","_blank")});jQuery("#mp-imgupload-browse").on("click",function(){$("#mp-up-ifuploaded").hide();$("#mp-imgupload-options").hide();$("#jansyUploadWell").hide();$("#mp-imgupload-browse").hide();$("#mp-imgupload-footer").hide();$("#mp-imgupload-search").show();$("#myUploadImgList").show();$("#mp-imgupload-cancel-select").show();$("#mp-imgupload-select").show();$("#mp-imgupload-deletepanel").hide();$("#mp-up-trash-div").show();jQuery("#myUploadPreview").find("img").attr("class")!=undefined?$("#mp-imgupload-trashcan").show():$("#mp-imgupload-trashcan").hide()});jQuery("#mp-imgupload-cancel-select").on("click",function(){editImage&&(jQuery("#myUploadPreview img").attr("src",editImage.attr("src")),jQuery("#dialog-ui-width").val(numToNum(editImage.attr("width"),"px",unitSI)),jQuery("#dialog-ui-height").val(numToNum(editImage.attr("height"),"px",unitSI)),$("#ui-watermark").prop("checked")&&$("#myUploadPreview img").css("opacity",$("#ui-water-percent").val()));$("#mp-insertUpImage-title").is(":visible")?(editImage="",reset="",jQuery("#myUploadPreview").html('<img src="" >'),resetUserImageUI()):$("#mp-imgupload-btn").hide();$("#mp-imgupload-cancel-select").hide();$("#mp-imgupload-select").hide();$("#mp-imgupload-deletepanel").hide();$("#mp-up-trash-div").hide();$("#mp-imgupload-trashcan").hide();$("#myUploadImgList").hide();$("#mp-imgupload-search").hide();$("#mp-imgupload-options").show();$("#mp-imgupload-footer").show();$("#mp-imgupload-browse").show();$("#jansyUploadWell").show();resetUISearch()});jQuery("#mp-imgupload-select").on("click",function(){var t,i,n,r,u;resetLightenStuff();$("#mp-imgupload-cancel-select").hide();$("#mp-imgupload-select").hide();$("#mp-imgupload-deletepanel").hide();$("#mp-imgupload-search").hide();$("#mp-up-trash-div").hide();$("#mp-imgupload-trashcan").hide();$("#myUploadImgList").hide();$("#mp-imgupload-options").show();$("#mp-imgupload-footer").show();$("#mp-imgupload-browse").show();$("#jansyUploadWell").show();resetUISearch();up_image_changed=!0;jQuery("#myUploadPreview").find("img").attr("class")!=undefined&&(t=jQuery("#myUploadPreview").find("img").attr("class").replace(/image\-/,""),t?(i=_.groupBy(imageData,"id"),n=i[t][0].category.split(":"),n[0]>209&&(n[1]=n[1]/n[0]*209,n[0]=209),n[1]>192&&(n[0]=n[0]/n[1]*209,n[1]=209),jQuery("#dialog-ui-width").val(numToNum(n[0],"px",unitSI)),jQuery("#dialog-ui-height").val(numToNum(n[1],"px",unitSI))):(r=jQuery("#myUploadPreview").find("img").css("width"),u=jQuery("#myUploadPreview").find("img").css("height"),jQuery("#dialog-ui-width").val(numToNum(r,"px",unitSI)),jQuery("#dialog-ui-height").val(numToNum(u,"px",unitSI))))});jQuery("#mp-imgupload-trashcan").on("click",function(n){n.preventDefault();$("#jansyUploadWell").hide();$("#mp-imgupload-cancel-select").hide();$("#mp-imgupload-select").hide();$("#mp-imgupload-footer").hide();$("#mp-imgupload-browse").hide();$("#mp-up-browse-note").hide();$("#mp-imgupload-trashcan").hide();$("#mp-imgupload-deletepanel").show()});jQuery("#mp-imgupload-cancelbtn,#mp-imgupload-deletebtn").on("click",function(n){var i,r;if(n.preventDefault(),n.target.id=="mp-imgupload-deletebtn"){if(nosaveMenu){doAlert("No delete image with No Save","info",1500,!0);return}mp_predo("na");var u=jQuery("#access_token").val(),t=jQuery("#myUploadPreview img").attr("class"),f=jQuery("#myUploadPreview img").attr("src");t!=undefined&&(doAlert(326,"",5e3,!0),i=t.replace(/image-/g,""),r="/api/image/"+i+"/"+u+"/"+Date.now(),jQuery.ajax({url:r,type:"DELETE",dataType:"json",success:function(n){n.status=="OK"?($("#mp-acct-images").text(parseInt($("#mp-acct-images").text())-1),jQuery(editImage.node).attr("class")==t?(jQuery("#jansy-img-upload").fileupload("reset"),$("#mp-up-trash-div").show(),$("#mp-imgupload-trashcan").hide(),editImage="",resetUserImageUI()):drawUserImage(jQuery(editImage.node).attr("href"),jQuery(editImage.node).attr("class")),image_delete_fooditem(t,f),image_delete(t),doAlert(6,null,1e3,!0),importImageData()):doAlert(86,null,0,!0)}}))}else $("#mp-imgupload-trashcan").show();$("#mp-imgupload-options").hide();$("#jansyUploadWell").hide();$("#mp-imgupload-browse").hide();$("#mp-imgupload-footer").hide();$("#mp-imgupload-search").show();$("#mp-up-browse-note").show();$("#myUploadImgList").show();$("#mp-imgupload-cancel-select").show();$("#mp-imgupload-select").show();$("#mp-imgupload-deletepanel").hide();$("#mp-up-trash-div").show()});jQuery("#mp-imgupload-find").keyup(function(n){var i,t;n.which==13&&n.preventDefault();i=jQuery("#mp-imgupload-find").val();i.length>1?(t=_.filter(imageData,function(n){var t=n.filename.toLowerCase();return t.indexOf(i.toLowerCase())>-1}),jQuery("#myUploadImgList").addClass("bluehalo"),$("#myUploadImgList").megalist("setSelectedIndexMove",-1)):(t=imageData,jQuery("#myUploadImgList").removeClass("bluehalo"));fixImageData(t,"search");$("#myUploadImgList").megalist("setDataProvider",t)});jQuery("#mp-ai-image,#mp-ui-image").on("click",function(n){n.preventDefault();editImage=""});jQuery("#mp-ai-find").keyup(function(n){var i,r,u,t;n.which==13&&n.preventDefault();i="#"+jQuery("#mp-view-collection").find(".icon-ok").attr("id");r=jQuery("#mp-ai-find").val();r.length>1?(u=setArtisanData(i),t=_.filter(u,function(n){var t=n.split("/")[2].replace(/....$/g,"").replace(/_/g," ");return t.match(new RegExp(r,"ig"))}),jQuery("#myArtisanList").addClass("bluehalo"),$("#myArtisanList").megalist("setSelectedIndexMove",-1)):(t=setArtisanData(i),jQuery("#myArtisanList").removeClass("bluehalo"));fixAI(t);$("#myArtisanList").megalist("setDataProvider",t)});jQuery("#dialog-ai-flip, #dialog-ai-mirror").on("click",function(){flipArtisanImage()});jQuery("#dialog-ai-colorize").on("click",function(){colorArtisanImage(0,"")});jQuery("#dialog-ai-colorizePNG").on("click",function(){colorArtisanImage(0,"PNG")});jQuery("#mp-artisan-cancel-select").on("click",function(){editImage?(jQuery("#myArtisanPreview").html('<img src="'+editImage.attr("src")+'" >'),flipArtisanImage()):jQuery("#myArtisanPreview").html("<img/>");resetAISearch()});jQuery("#dialog-ai-cancel,#dialog-insertai-x").on("click",function(){editImage="";reset="";resetArtisanUI();resetArtisanHeader();$("#myArtisanPreview img").remove();$("#ai-imagetype-svgmsg").hide();resetAISearch();ai_image_changed=!1;$("#mp-artisan-cancel-select").hide();$("#mp-artisan-image-select").hide();$("#myArtisanList").hide();$("#mp-artisan-image-search").hide();$("#mp-view-collection").hide();$("#mp-artisan-options").show();$("#mp-artisan-footer").show();$("#mp-artisan-browse").show()});$("#myInsertiMenuProImageDialog").keyup(function(n){n.which==27&&(editImage="",reset="",resetArtisanUI(),resetArtisanHeader(),$("#myArtisanPreview img").remove(),$("#ai-imagetype-svgmsg").hide(),resetAISearch(),ai_image_changed=!1,$("#mp-artisan-cancel-select").hide(),$("#mp-artisan-image-select").hide(),$("#myArtisanList").hide(),$("#mp-artisan-image-search").hide(),$("#mp-view-collection").hide(),$("#mp-artisan-options").show(),$("#mp-artisan-footer").show(),$("#mp-artisan-browse").show())});$("#mp-insertIMPImage-help,#mp-editIMPImage-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#images","_blank")});jQuery("#mp-artisan-browse").on("click",function(){$("#mp-artisan-options").hide();$("#mp-artisan-browse").hide();$("#mp-artisan-footer").hide();$("#mp-artisan-image-search").show();$("#myArtisanList").show();$("#mp-artisan-cancel-select").show();$("#mp-artisan-image-select").show();$("#mp-view-collection").show()});jQuery("#mp-artisan-image-select").on("click",function(){$("#mp-artisan-cancel-select").hide();$("#mp-artisan-image-select").hide();$("#myArtisanList").hide();$("#mp-artisan-image-search").hide();$("#mp-view-collection").hide();$("#mp-artisan-options").show();$("#mp-artisan-footer").show();$("#mp-artisan-browse").show();resetAISearch();ai_image_changed=!0});jQuery("#mp-artisan-cancel-select").on("click",function(){$("#mp-insertIMPImage-title").is(":visible")&&(editImage="",reset="");$("#mp-artisan-cancel-select").hide();$("#mp-artisan-image-select").hide();$("#myArtisanList").hide();$("#mp-artisan-image-search").hide();$("#mp-view-collection").hide();$("#mp-artisan-options").show();$("#mp-artisan-footer").show();$("#mp-artisan-browse").show();resetAISearch()});jQuery("#dialog-ai-ratio").on("click",function(){jQuery("#dialog-ai-ratio").prop("checked")?(jQuery("#mp-link-aspect-ai").show(),setArtisanHeight()):jQuery("#mp-link-aspect-ai").hide()});jQuery("#dialog-ai-width").on("change",function(){var n=isNaN(parseFloat(jQuery("#dialog-ai-width").val()));n||numToNum(jQuery("#dialog-ai-width").val(),unitSI,"px",!0)<5?jQuery("#dialog-ai-width").val(numToNum(editImage.attr("width"),"px",unitSI)):numToNum(jQuery("#dialog-ai-width").val(),unitSI,"px",!0)>9600&&jQuery("#dialog-ai-width").val(numToNum(9600,"px",unitSI));jQuery("#dialog-ai-ratio").prop("checked")&&setArtisanHeight()});jQuery("#dialog-ai-height").on("change",function(){var t=isNaN(parseFloat(jQuery("#dialog-ai-height").val()));if(t||numToNum(jQuery("#dialog-ai-height").val(),unitSI,"px",!0)<5?jQuery("#dialog-ai-height").val(numToNum(editImage.attr("height"),"px",unitSI)):numToNum(jQuery("#dialog-ai-height").val(),unitSI,"px",!0)>9600&&jQuery("#dialog-ai-height").val(numToNum(9600,"px",unitSI)),jQuery("#dialog-ai-ratio").prop("checked")){var i=numToNum(jQuery("#dialog-ai-height").val(),unitSI,"px",!0),r=jQuery("#myArtisanPreview img").prop("width"),u=jQuery("#myArtisanPreview img").prop("height"),n=i*r/u,f=n>9600?9600:n;jQuery("#dialog-ai-width").val(numToNum(f,"px",unitSI))}});jQuery("#dialog-ai-left").on("change",function(){var n=isNaN(parseFloat(jQuery("#dialog-ai-left").val()));n&&jQuery("#dialog-ai-left").val(numToNum(editImage.attr("x"),"px",unitSI))});jQuery("#dialog-ai-top").on("change",function(){var n=isNaN(parseFloat(jQuery("#dialog-ai-top").val()));n&&jQuery("#dialog-ai-top").val(numToNum(editImage.attr("y"),"px",unitSI))});jQuery("#dialog-ai-onmenu").on("click",function(){reset=jQuery("#dialog-ai-onmenu").prop("checked")?"":"ai_delete"});$("#ai-watermark").on("click",function(){$("#ai-watermark").prop("checked")?($("#ai-water-percent").attr("disabled",!1),$("#myArtisanPreview img").css("opacity",$("#ai-water-percent").val())):($("#ai-water-percent").attr("disabled",!0),$("#myArtisanPreview img").css("opacity","1"))});$("#ai-water-percent").on("click",function(){$("#myArtisanPreview img").css("opacity",$("#ai-water-percent").val())});ai_image_changed=!1;$("#ai-watermark-checkbox, #dialog-ai-colorizePNG, #dialog-picture-colorPNG, #ai-water-percent, #dialog-ai-ratio, #dialog-ai-flip, #dialog-ai-mirror, #dialog-ai-colorize, #dialog-picture-color, #dialog-ai-width, #dialog-ai-height, #dialog-ai-left, #dialog-ai-top").on("change",function(){ai_image_changed=!0});jQuery("#dialog-ai-ok").on("click",function(n){n.preventDefault();ai_image_changed||$("#dialog-ai-onmenu").prop("checked")==!1||$("#mp-insertIMPImage-title").is(":visible")?(reset=="ai_delete"?image_remove(editImage):drawArtisanImage(),jQuery("#myInsertiMenuProImageDialog").modal("hide"),editImage="",reset="",resetArtisanUI(),resetArtisanHeader(),resetAISearch(),$("#myArtisanPreview img").remove(),$("#ai-imagetype-svgmsg").hide()):jQuery("#dialog-ai-cancel").click();ai_image_changed=!1});jQuery("#acct-log-out, #menu-log-out").on("click",function(n){n.preventDefault();check_menu().done(function(n){if(n.last_update!=fileTimestamp){var t=confirm("Your menu appears to have been edited by another login. Is it OK to save your version? (click Cancel to log out without saving your menu)");t==!0?(startActivityTimer(),isMenuSaved=!1,save_settings(),userA_loggingout_andsaving=!0,save_menu(),session_logout("waitForSave")):(doAlert(0),save_settings(),auto_logout())}else startActivityTimer(),isMenuSaved=!1,save_settings(),save_menu(),session_logout("waitForSave")}).fail(function(n,t){t=="timeout"||n.responseJSON==undefined?(doAlert(192,null,9e3,!0),console.log("Connection seems dead! (logout)")):n.responseJSON.error=="invalid_client"?(doAlert(194,null,9e3,!0),console.log("Token has expired! (logout)")):(doAlert(196,null,9e3,!0),console.log("Something failed on server! (logout)"))})});var dragopacityon=!1,start=function(n,t,i){disable_draggit();mp_remove_dropdowns();i.buttons==2||i.button==2?reset="ai_rclick":!1;this.x=this.attr("x");this.y=this.attr("y");$("#floatimages").css("cursor","-moz-grab");$("#floatimages").css("cursor","-webkit-grab");this.node.getAttribute("opacity")==null&&(this.attr("opacity",.44),dragopacityon=!0);this.sizer.hide();this.remover.hide();moveImage=!1;editTimer=window.setTimeout(function(){jQuery("#MPstatusBarPageSize").text("time: "+Date.now().toString().substring(5,10));moveImage="menu";window.clearTimeout(editTimer)},1e3)},move=function(n,t){var o,s;if(reset!="ai_rclick"){reset="ai_mousedown";disable_draggit();(t!=0||n!=0)&&(moveImage=!0,window.clearTimeout(editTimer));var h=parseInt(jQuery("#MPstatusBarView").text().slice(0,-1)),i=.25,r=parseInt(this.x)+this.matrix.a*parseInt(n*100/h),u=parseInt(this.y)+this.matrix.d*parseInt(t*100/h),f=parseInt(this.attr("height")),e=parseInt(this.attr("width"));(f<60||e<60)&&(i=(90-Math.min(f,e))/100);o=parseInt(page_height*96)-parseInt(i*f);s=parseInt(page_width*96)-parseInt(i*e);r*this.matrix.a<(i-1)*e&&(r=parseInt((i-1)*e)*this.matrix.a);u*this.matrix.d<(i-1)*f&&(u=parseInt((i-1)*f)*this.matrix.d);r*this.matrix.a>s&&(r=s*this.matrix.a);u*this.matrix.d>o&&(u=o*this.matrix.d);this.attr({x:r,y:u});jQuery("#MPstatusBarPageSize").text("x:"+numToNum(r*this.matrix.a,"px",unitSI)+" y:"+numToNum(u*this.matrix.d,"px",unitSI))}},up=function(n){enable_draggit();reset="";window.clearTimeout(editTimer);resetSizeToolbar();$("#floatimages").css("cursor","pointer");setTimeout(function(){make_rect_active()},20);dragopacityon&&(this.attr("opacity",""),this.node.removeAttribute("opacity"));dragopacityon=!1;moveImage&&mp_predo("image_drag",page_no);imageCheck(this);image_elem_pos(this);moveImage||n.which==3?n.which==3&&(editImage=this):(editImage=this,reset="ai_select",imageClick(this))},rstart=function(n,t,i){disable_draggit();mp_remove_dropdowns();i.buttons==2||i.button==2?reset="ai_rclick":!1;var r=i.shiftKey?!0:!1;this.ox=parseInt(this.attr("x"));this.oy=parseInt(this.attr("y"));this.box.ow=parseInt(this.box.attr("width"));this.box.oh=parseInt(this.box.attr("height"));this.ratio=r?this.box.ow/this.box.oh:!1;this.box.remover.hide()},rmove=function(n,t){var u,f,r,i;reset!="ai_rclick"&&(reset="ai_mousedown",disable_draggit(),u=this.box.matrix.e,f=this.box.matrix.f,jQuery(this.box.remover).hide(),r=parseInt(this.box.oh)+parseInt(t),this.ratio?(i=r*this.ratio,n=i-parseInt(this.box.ow)):i=parseInt(this.box.ow)+n,i>20&&(this.attr({x:parseInt(this.ox)+n}),this.box.attr({width:i}),u=this.box.matrix.a>0?0:i),r>20&&(this.attr({y:parseInt(this.oy)+t}),this.box.attr({height:r}),transform=!0,f=this.box.matrix.d>0?0:r),this.box.transform(["m",this.box.matrix.a,0,0,this.box.matrix.d,u,f]))},rup=function(){enable_draggit();reset="";setTimeout(function(){make_rect_active()},20);mp_predo("image",page_no);imageCheck(this.box)},hoverin=function(){reset!="ai_mousedown"&&(this.sizer.attr("opacity",.35),this.remover.attr("opacity",.35))},hoverout=function(){this.sizer.attr("opacity",0);this.remover.attr("opacity",0)},sizerin=function(){reset!="ai_mousedown"&&(this.attr("opacity",.9),jQuery(this.box.remover).hide())},sizerout=function(){this.attr("opacity",0);this.box&&jQuery(this.box.remover).show()};floatingtext_changed=!1;$(".spanFTTextArea, #mp-rotate-ft, #mp-curve-ft, #floatSize, #mp-altfont-ft, #mp-floatingtext-alignment, #dialog-floating-text-accent-color, #mp-floatingtext-left, #mp-floatingtext-top, #mp-floatingtext-boxaccent").on("change",function(){floatingtext_changed=!0});$("#floatSize").on("change",function(n){n.preventDefault();checkFloatScaleInput()});jQuery("#dialog-floatingtext-ok").on("click",function(n){var t,s,r,c,o,i;if(n.preventDefault(),floatingtext_changed||$("#mp-ft-onmenubox").prop("checked")==!1)if(t=getItem("menufile"),s=_.keys(t.float_text),s.length>maxFloat&&reset.indexOf("floatitem:")<=-1)mp_predo("na"),demoMenu?doAlert(230,null,4e3,!0):doAlert(116,null,6e3,!0),jQuery("#myFloatingTextDialog").modal("hide"),reset="",resetFloatingText();else{var h=jQuery("#mp-ft-onmenubox").prop("checked"),r=jQuery("#myFloatingTextDialog .spanFTTextArea").val(),a=allblanks(r);if(h!=!0||a)reset.indexOf("floatitem:")>-1&&(mp_predo("floattext",page_no),o=reset.split(":"),i=o[1],delete t.float_text[i],jQuery("#floatitem_"+i).remove(),setItem("menufile",t));else{mp_predo("floattext",page_no);r=jQuery("#myFloatingTextDialog .spanFTTextArea").val();r=fixEntitiesHackx(r.decodeLTGT());settings.imenupro.fcodes&&h&&mismatchedTags(r)===!0&&doAlert(344,null,9e3,!0);var v=jQuery("#mp-rotate-ft").val(),y=jQuery("#mp-curve-ft").val(),p=jQuery("#mp-floatingtext-alignment").val(),u=jQuery("#mp-floatingtext-boxaccent").selectpicker().val();(u==null||u==undefined||u=="")&&(u="(none)");var w=jQuery("#dialog-floating-text-accent-color").spectrum("get").toRgbString(),f=numToNum(jQuery("#mp-floatingtext-left").val(),unitSI,"in",!0),e=numToNum(jQuery("#mp-floatingtext-top").val(),unitSI,"in",!0),b=jQuery("#mp-altfont-ft").val(),k=isRTLtext(r);if(f=isNaN(f)||f==null?.25:f,e=isNaN(e)||e==null?.25:e,float_scale=checkFloatScaleInput(),float_scale==.25?float_scale=".25":float_scale==.5?float_scale=".5":float_scale==.75?float_scale=".75":float_scale==1?float_scale="1":float_scale==1.25?float_scale="1.25":float_scale==1.5?float_scale="1.5":float_scale==1.75?float_scale="1.75":float_scale==2&&(float_scale="2"),c=[v,y,p,u,w,f,e,float_scale,b,k].join(";"),reset.indexOf("floatitem:")>-1)o=reset.split(":"),i=o[1],jQuery("#"+reset.replace(":","_")).remove();else{var l=_.pluck(t.float_text,"float_id"),d=_.range(l.length+3),g=_.map(d,function(n){return"ft"+n}),nt=_.difference(g,l),i=nt[0];t.float_text[i]={float_id:i}}t.float_text[i].text=encodeData(r);t.float_text[i].page_no=page_no;t.float_text[i].param=c;setItem("menufile",t);iMenuPro.print_floatitem(i);reset.indexOf("floatitem:")>-1&&mp_floatArrange()}jQuery("#myFloatingTextDialog").modal("hide");reset="";resetFloatingText()}else jQuery("#dialog-floatingtext-cancel").click();floatingtext_changed=!1});jQuery("#dialog-floatingtext-x, #dialog-floatingtext-cancel").on("click",function(n){reset="";resetFloatingText();floatingtext_changed=!1;mp_floatArrange();n.preventDefault()});$("#myFloatingTextDialog").keyup(function(n){n.which==27&&(reset="",resetFloatingText(),floatingtext_changed=!1,mp_floatArrange(),$("#headaccent-hidden-select").trigger("click"),n.preventDefault())});$("#dialog-floatingtext-help,#dialog-floatingtext-edit-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#floating-text")});jQuery("#mp-curve-ft").on("change",function(){jQuery("#mp-curve-ft").val()!="none"?($("#ft_alignment_title").addClass("muted"),$("#mp-floatingtext-alignment").attr("disabled",!0),$("#mp-floatingtext-alignment").val("left")):($("#ft_alignment_title").removeClass("muted"),$("#mp-floatingtext-alignment").attr("disabled",!1))});$("#mp-ftext-command").on("click",function(){reset="";focusOnThis(".spanFTTextArea")});stylebyname=!1;cameviaresetcmd=!1;jQuery("#myMenuStyleDialog").on("shown",function(){stylebyname=!0;myMenuStyle=jQuery('link[title="origCSS"]').attr("href").replace("https://"+window.location.host+"/SVG/styles/","").replace("styles/","")});jQuery("#myMenuStyleDialog").on("hide",function(){reset!="menustyle_ok"&&jQuery("#dialog-menustyle-select").val(myMenuStyle);stylebyname=!1});jQuery("#dialog-menustyle-ok").on("click",function(n){var u,e,c,r,l;n.preventDefault();var t=getItem("menufile"),a=t.total_columns,i=!1;a!=$('#myMenuStyleDialog [name="total_columns"]').val()&&(i=!0);u=jQuery("#dialog-menustyle-select").val();(u==null||u=="undefined")&&(jQuery("#dialog-menustyle-select").val(myMenuStyle),jQuery("#dialog-menustyle-select").click());var o=jQuery("#dialog-menustyle-keepon").prop("checked"),v=JSON.parse(sessionStorage.getItem("override.css")),s=Object.getOwnPropertyNames(v).length>0?!0:!1,f=!0,h=reset=="open_menu";reset="menustyle_ok";e=!1;c=$("#dialog-menustyle-select").val();c==myMenuStyle&&stylebyname==!0&&(o||!s||i?i==!0?r=!0:f=i||s?!1:!1:e=f=confirm("Heads up! You're on the same Menu Style but you've made design or font changes. And 'Keep design changes' under Tools | iMenuPro Settings is unchecked. So we have to trash your design changes. Are you OK with that?"));jQuery("#myMenuStyleDialog").modal("hide");warned_colwidth=!1;start_spinner();disable_toolbar();f?(cameviaresetcmd!=!0&&mp_predo("style",page_no),h&&mp_predo("na"),t.total_columns=$('#myMenuStyleDialog [name="total_columns"]').val(),global_columns=parseInt(t.total_columns),setItem("menufile",t),jQuery("#textcanvas").children().remove(),jQuery("#floattext").children().remove(),r&&$("#dialog-menustyle-keepon").prop("checked",!0),l=changeStyle(),l.then(function(){r&&$("#dialog-menustyle-keepon").prop("checked",o);updateUI("override");setIsUneven(global_columns);leafd();r||e||cameviaresetcmd||resetPageSpacing(h);cameviaresetcmd?iMenuPro.draw_text(page_no):iMenuPro.draw_text();calculate_col_width()})):stop_spinner();cameviaresetcmd=!1});jQuery("#dialog-menustyle-cancel,#dialog-menustyle-x").on("click",function(n){n.preventDefault();jQuery("#dialog-menustyle-select").val(myMenuStyle);$('#myMenuStyleDialog [name="total_columns"]').val(global_columns)});$("#myMenuStyleDialog").keyup(function(n){n.which==27&&(jQuery("#dialog-menustyle-select").val(myMenuStyle),$('#myMenuStyleDialog [name="total_columns"]').val(global_columns))});$("#dialog-menustyle-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#menu-styles")});jQuery("#btn-prev-style").on("click",function(n){n.preventDefault();stylebyname=!1;$("#btn-prev-style").tooltip("hide");var t=document.getElementById("dialog-menustyle-select"),r=t.options[t.options.length-1].index,i=t.options[t.options.selectedIndex].index;i==0?jQuery("#dialog-menustyle-select").prop("selectedIndex",r):jQuery("#dialog-menustyle-select").prop("selectedIndex",i-1);jQuery("#dialog-menustyle-ok").click()});jQuery("#btn-next-style").on("click",function(n){n.preventDefault();stylebyname=!1;$("#btn-next-style").tooltip("hide");var t=document.getElementById("dialog-menustyle-select"),r=t.options[t.options.length-1].index,i=t.options[t.options.selectedIndex].index;i==r?jQuery("#dialog-menustyle-select").prop("selectedIndex",0):jQuery("#dialog-menustyle-select").prop("selectedIndex",i+1);jQuery("#dialog-menustyle-ok").click()});var fooditem_undo_allowed=!0,fooditem_changed=!1,fooditem_span_changed=!1,fooditem_new=!1;$(".spanNameFoodItem, .spanDescFoodItem, .spanPriceFoodItem, .spanExtrasFoodItem, .spanNotesTextArea").on("change",function(){fooditem_undo_allowed=!1});$(".spanNameFoodItem, .spanDescFoodItem, .spanPriceFoodItem, .spanExtrasFoodItem, .spanNotesTextArea, #mp-fooditembox-center, #mp-fooditembox-withname, #mp-fooditembox-span, #mp-fooditembox-wraplines, #dialog-food-accent-color, .spanBinNumberFoodItem, [name=FoodItemSpacing], #mp-fooditembox-before, #mp-fooditembox-after, #mp-fooditembox-onmenu, #mp-fooditembox-boxaccent").on("change",function(){fooditem_changed=!0});$("#mp-fooditembox-span").on("change",function(){fooditem_span_changed=!0});$("#file-imguploadFI").on("click",function(){fooditem_changed=!0});$("#mp-imgupload-btnFI").on("click",function(n){demoMenu?(n.preventDefault(),doAlert(108,null,4e3,!0)):isIE9&&(n.preventDefault(),doAlert(292,null,7e3,!0))});jQuery("#mp-fi-sym1, #mp-fi-sym2").on("click",function(n){var t;t=$("#mp-fi-photomap").is(":visible")?!0:!1;t&&$("#mp-imgupload-selectFI").click();fooditem_changed=!0;symbol_pos=n.target.id=="mp-fi-sym1"?"select-symbol:mp-fi-sym1":"select-symbol:mp-fi-sym2";n.preventDefault();$("#mp-fi-photomap, #mp-up-browse-noteFI").hide();$("#mp-delete-fooditem-alert").hide();$("#mp-notes-field").hide();$("#myUploadPreviewFI").removeClass("dont_select_ptr");$("#mp-fooditembox-footer").show();$("#mp-fi-col1, #mp-fi-col2, #mp-fi-col3").hide();$("#mp-fi-symmap").show()});jQuery("#myUploadPreviewFI").on("click",function(n){n.preventDefault();$("#myUploadPreviewFI").addClass("dont_select_ptr");fooditem_changed=!0;$("#mp-imgupload-deletepanelFI").is(":visible")||($("#mp-fooditembox-footer").hide(),$("#mp-delete-fooditem-alert").hide(),$("#mp-notes-field").hide(),$("#jansyUploadWellFI").hide(),$("#jansyRemoveWellFI").hide(),$("#mp-fi-photomap, #mp-up-browse-noteFI").show(),$("#mp-imgupload-deletepanelFI").hide(),$("#mp-up-trash-divFI").show(),$("#myUploadPreviewFI img").attr("src")!="bootstrap/img/68x51.png"||$("#jansyRemoveWellFI").hide(),$("#mp-imgupload-trashcanFI").hide())});jQuery("#mp-imgupload-selectFI").on("click",function(n){n.preventDefault();$("#mp-fi-photomap, #mp-up-browse-noteFI").hide();$("#jansyRemoveWellFI").show();$("#myUploadPreviewFI").removeClass("dont_select_ptr");$("#mp-fooditembox-footer").show();resetUISearchFI();$("#myUploadPreviewFI img").attr("src")=="bootstrap/img/68x51.png"&&($("#jansyUploadWellFI").show(),$("#jansyRemoveWellFI").hide(),$("#mp-box-food-photo").prop("checked",!1))});jQuery("#mp-fi-img-remove").on("click",function(n){n.preventDefault();fooditem_changed=!0;$("#jansyRemoveWellFI").hide();jQuery("#jansy-img-uploadFI").fileupload("reset");$("#jansyUploadWellFI").show();jQuery("#myUploadPreviewFI").html('<img src="" >');jQuery("#myUploadPreviewFI img").attr("src","bootstrap/img/68x51.png")});jQuery("#mp-imgupload-trashcanFI").on("click",function(n){n.preventDefault();$("#jansyUploadWellFI").hide();$("#mp-fi-useimg-div").hide();$("#mp-fi-useimg-hr").hide();$("#mp-up-browse-noteFI").hide();$("#mp-imgupload-findFI").hide();$("#mp-up-trash-divFI").hide();$("#mp-imgupload-trashcanFI").hide();$("#mp-imgupload-deletepanelFI").show()});jQuery("#mp-imgupload-cancel-selectFI").on("click",function(){editImage==""&&$("#mp-photostate").hasClass("mp-editphoto")&&$("#myUploadPreviewFI img").attr("src")=="bootstrap/img/68x51.png"?(drawUserImageFI("bootstrap/img/68x51.png",""),$("#jansyRemoveWellFI").hide(),$("#jansyUploadWellFI").show(),$("#mp-photostate").addClass("mp-newphoto"),$("#mp-photostate").removeClass("mp-editphoto")):(editImage&&jQuery("#myUploadPreviewFI img").attr("src",editImage),$("#mp-photostate").hasClass("mp-newphoto")?(drawUserImageFI("bootstrap/img/68x51.png",""),$("#jansyRemoveWellFI").hide(),$("#jansyUploadWellFI").show()):($("#jansyUploadWellFI").hide(),$("#jansyRemoveWellFI").show()));$("#mp-fi-photomap, #mp-up-browse-noteFI").hide();$("#mp-imgupload-trashcanFI").hide();$("#myUploadPreviewFI").removeClass("dont_select_ptr");$("#mp-fooditembox-footer").show();resetUISearchFI()});jQuery("#mp-imgupload-cancelbtnFI,#mp-imgupload-deletebtnFI").on("click",function(n){var i,r;if(n.preventDefault(),mp_predo("na"),n.target.id=="mp-imgupload-deletebtnFI"){if(nosaveMenu){doAlert("No delete image with No Save","info",1500,!0);return}var u=jQuery("#access_token").val(),t=jQuery("#myUploadPreviewFI img").attr("class"),f=jQuery("#myUploadPreviewFI img").attr("src");t!=undefined&&($("#mp-imgupload-trashcanFI").hide(),doAlert(326,"",5e3,!0),i=t.replace(/image-/g,""),r="/api/image/"+i+"/"+u+"/"+Date.now(),jQuery.ajax({url:r,type:"DELETE",dataType:"json",success:function(n){n.status=="OK"?($("#mp-acct-images").text(parseInt($("#mp-acct-images").text())-1),$("#myUploadPreviewFI img").attr("src")==editImage?(editImage="",drawUserImageFI("bootstrap/img/68x51.png","")):$("#mp-photostate").hasClass("mp-editphoto")&&editImage!=""?setTimeout(function(){drawUserImageFI(editImage,t)},100):drawUserImageFI("bootstrap/img/68x51.png",""),image_delete_fooditem(t,f),image_delete(t),doAlert(6,null,1e3,!0),importImageData()):doAlert(86,null,0,!0)}}))}else $("#mp-imgupload-trashcanFI").show();$("#mp-imgupload-deletepanelFI").hide();$("#mp-fi-useimg-div").show();$("#mp-fi-useimg-hr").show();$("#mp-up-browse-noteFI").show();$("#mp-imgupload-findFI").show();$("#mp-up-trash-divFI").show();$("#mp-fi-photomap, #mp-up-browse-noteFI").hide();$("#mp-imgupload-searchFI").show();$("#myUploadImgListFI").show();$("#mp-imgupload-cancel-selectFI").show();$("#mp-imgupload-selectFI").show();$("#mp-fi-photomap, #mp-up-browse-noteFI").show()});jQuery("#mp-imgupload-findFI").keyup(function(n){var i,t;n.which==13&&n.preventDefault();i=jQuery("#mp-imgupload-findFI").val();i.length>1?(t=_.filter(imageData,function(n){var t=n.filename.toLowerCase();return t.indexOf(i.toLowerCase())>-1}),jQuery("#myUploadImgListFI").addClass("bluehalo"),$("#myUploadImgListFI").megalist("setSelectedIndexMove",-1)):(t=imageData,jQuery("#myUploadImgListFI").removeClass("bluehalo"));fixImageDataFI(t,"search");$("#myUploadImgListFI").megalist("setDataProvider",t)});jQuery("#file-imguploadFI").on("change",function(){var n=jQuery("#file-imguploadFI").val();bmpTestWarn(n)});jQuery("#mp-notes-button").on("click",function(n){n.preventDefault();$("#mp-fi-symmap").hide();$("#mp-fi-photomap, #mp-up-browse-noteFI").hide();$("#mp-fi-col1, #mp-fi-col2, #mp-fi-col3").show();$("#mp-notes-field").is(":visible")?($("#mp-notes-field").hide(),$("#notes-collapse-icon").removeClass("icon-chevron-up"),$("#notes-collapse-icon").addClass("icon-chevron-down"),$("#jansyUploadWellFI").show()):($("#jansyUploadWellFI").hide(),$("#mp-notes-field").show(),$("#notes-collapse-icon").removeClass("icon-chevron-down"),$("#notes-collapse-icon").addClass("icon-chevron-up"),$("#mp-note-text").val()==""&&$("#mp-note-text").focus())});jQuery("#mp-fooditem-trashcan").on("click",function(n){n.preventDefault();$("#mp-fi-symmap").hide();$("#mp-fi-photomap, #mp-up-browse-noteFI").hide();$("#jansyUploadWellFI").hide();$("#mp-fi-col1, #mp-fi-col2, #mp-fi-col3").show();$("#mp-fooditembox-footer").hide();$("#notes-collapse-icon").removeClass("icon-chevron-up");$("#notes-collapse-icon").addClass("icon-chevron-down");$("#mp-notes-field").hide();$("#mp-delete-fooditem-alert").show()});jQuery("#mp-cancel-deletefood-button").on("click",function(n){n.preventDefault();$("#mp-delete-fooditem-alert").hide();$("#jansyUploadWellFI").show();$("#myUploadPreviewFI").removeClass("dont_select_ptr");$("#mp-fooditembox-footer").show()});jQuery("#dialog-fooditem-cancel, #dialog-fooditem-x").on("click",function(n){n.preventDefault();fooditem_changed=!1;fooditem_span_changed=!1;fooditem_new=!1;resetFoodPhotoUploadUI()});$("#myFoodItemDialog").keyup(function(n){n.which==27&&(fooditem_changed=!1,fooditem_span_changed=!1,fooditem_new=!1,resetFoodPhotoUploadUI(),$("#headaccent-hidden-select").trigger("click"))});jQuery("#dialog-fooditem-help").on("click",function(){window.open("http://help.imenupro.com/food-items-headings.htm#food-items")});jQuery(".mp-fisym").on("click",function(n){n.preventDefault();$("#mp-fi-symmap").hide();$("#myUploadPreviewFI").removeClass("dont_select_ptr");$("#mp-fooditembox-footer").show();$("#mp-fi-col1, #mp-fi-col2, #mp-fi-col3").show();var r=symbol_pos.split(":"),t=r[1],i=n.target.innerHTML;i=="none"?(jQuery("#"+t).removeClass("mp-syms"),jQuery("#"+t).addClass("mp-syms-none")):i=="cancel"?i=jQuery("#"+t).html():(jQuery("#"+t).removeClass("mp-syms-none"),jQuery("#"+t).addClass("mp-syms"));jQuery("#"+t).html(i)});jQuery(".spanPriceFoodItem").on("change",function(){var n=jQuery(".spanPriceFoodItem").val().replace(/( )+;/g,";");n=n.replace(/( )+$/,"");jQuery(".spanPriceFoodItem").val(n)});jQuery("#mp-quick-find").keypress(function(n){n.which==13&&n.preventDefault()});jQuery("#mp-quick-find").keyup(function(n){n.which==13&&n.preventDefault();n.which==27&&jQuery("#mp-quick-find").val("");searchpos=searchpos.slice(0,7)=="foodpos"?searchpos:"foodpos:"+parseInt(jQuery("#myFoodList ul").css("top"));searchFoodData()});jQuery("#menu-new-fooditem,#menu-new-fooditem-btn").click(function(){fooditem_new=!0;reset="";updateFoodItemModal();focusOnThis(".spanNameFoodItem")});jQuery("#mp-fooditem-confirmDelete,#mp-fooditem-delete").on("click",function(n){n.preventDefault();mp_predo("na");var t=reset.split(":"),i=t[3],r=t[1],u=t[5],f=getItem("menufile"),e=_.indexOf(f.food_item.order,i);e!=-1&&(menu_changes=++menu_changes);deleteFoodID(i+"",r,u);$("#mp-delete-fooditem-alert").hide();$("#myUploadPreviewFI").removeClass("dont_select_ptr");$("#mp-fooditembox-footer").show();$("#mp-fooditem-trashcan").show();$("#jansy-img-uploadFI").fileupload("reset")});jQuery("input[name=FoodItemSpacing]").click(function(){changeFoodItemCustomSpacing()});jQuery("#mp-fooditembox-next").click(function(n){n.preventDefault();$("#mp-fooditembox-next").attr("disabled",!0);var t=getItem("fooditem"),i=t.length;i>=10&&demoMenu?(doAlert(230,null,4e3,!0),fooditem_changed=!1,fooditem_span_changed=!1,fooditem_new=!1):(fooditem_changed=!1,fooditem_span_changed=!1,fooditem_new=!1,fooditem_undo_allowed=!0,mp_predo("na"),addFoodImage(n.currentTarget.id),focusOnThis(".spanNameFoodItem"),jQuery("#myUploadPreviewFI").html('<img src="" >'),jQuery("#myUploadPreviewFI img").attr("src","bootstrap/img/68x51.png"))});jQuery("#myFoodItemDialog").on("shown",function(){$("#mp-fooditembox-ok, #dialog-fooditem-cancel, #dialog-fooditem-x").prop("disabled",!1)});jQuery("#mp-fooditembox-ok").click(function(n){if(n.preventDefault(),nosaveMenu){doAlert("No save food item","info",1e3,!0);return}if(demoMenu){var i=getItem("fooditem"),t=i.length;reset&&t--;t>=10&&(doAlert(230,null,4e3,!0),fooditem_changed=!1,fooditem_span_changed=!1,fooditem_new=!1)}fooditem_changed?($("#mp-fooditembox-ok, #dialog-fooditem-cancel, #dialog-fooditem-x").prop("disabled",!0),fooditem_undo_allowed?(start_spinner(),setTimeout(function(){mp_predo("fooditem_edit",page_no);addFoodImage(n.currentTarget.id)},minSpinOffload),setTimeout(function(){stop_spinner()},minSpinOffloadStop)):($("#mp-fooditembox-onmenu").prop("checked")==0&&fooditem_new||mp_predo("na"),fooditem_undo_allowed=!0,addFoodImage(n.currentTarget.id))):jQuery("#dialog-fooditem-cancel").click();fooditem_changed=!1;fooditem_new=!1});jQuery("#mp-imgupload-remove-btnFI").click(function(){fooditem_changed=!0;setTimeout(function(){drawUserImageFI("bootstrap/img/68x51.png","")},100)});jQuery("#myUploadImgListFI").on("change",function(n){var t=jQuery(n.srcElement.get()[0].innerHTML).attr("url"),i=jQuery(n.srcElement.get()[0].innerHTML).attr("idx");drawUserImageFI(t,i);$("#mp-imgupload-trashcanFI").show()});byorderonmenu_refresh_needed=!1;background_changed=!1;$("#dialog-paper-color, #dialog-background-flip, #dialog-background-mirror, #dialog-background-stretch, #dialog-background-lighten").on("change",function(){background_changed=!0;reset=""});jQuery("#myBackgroundDialog").on("shown",function(){dialog="background"});jQuery("#myBackgroundDialog").on("hidden",function(){dialog=""});jQuery("#dialog-background-ok").on("click",function(n){n.preventDefault();background_changed?(jQuery("#myBackgroundDialog").modal("hide"),mp_predo("background",page_no),reset=="reset_background"?noOverride(".background"):storeBackground(),leafd(),reset=""):jQuery("#dialog-background-cancel").click();background_changed=!1});$("#dialog-background-cancel,#dialog-background-x").on("click",function(n){n.preventDefault();updateBackgroundUI("override");loadBackground();reset=""});$("#myBackgroundDialog").keyup(function(n){n.which==27&&(updateBackgroundUI("override"),loadBackground(),reset="")});$("#dialog-background-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#menu-background")});jQuery("#dialog-background-flip,#dialog-background-mirror").on("click",function(){var n=jQuery("#dialog-background-flip").prop("checked"),t=jQuery("#dialog-background-mirror").prop("checked");transformElement("#background",t,n);reset=""});jQuery("#dialog-background-select").on("change",function(){loadPaperColor();loadBackground();reset="";background_changed=!0});jQuery("#dialog-background-stretch").on("change",function(){loadBackground();reset=""});jQuery("#dialog-background-lighten").on("change",function(){loadBackground();reset=""});jQuery("#dialog-background-margin").on("change",function(){var i=jQuery("#dialog-background-margin").val(),n=numToNum(i,unitSI,"in",!0),t=numCheck(n,"0","2","0.0",!0);t!=n?jQuery("#dialog-background-margin").val(numToNum(t,"in",unitSI)):jQuery("#dialog-background-margin").val(numToNum(n,"in",unitSI));loadBackground();reset="";background_changed=!0});border_changed=!1;$("#dialog-border-color, #dialog-border-flip, #dialog-border-mirror, #dialog-border-colorize").on("change",function(){border_changed=!0;reset=""});jQuery("#myBorderDialog").on("show",function(){dialog="border"});jQuery("#myBorderDialog").on("hidden",function(){dialog=""});jQuery("#dialog-border-ok").on("click",function(n){n.preventDefault();border_changed?(jQuery("#myBorderDialog").modal("hide"),mp_predo("border",page_no),reset=="reset_border"?noOverride(".border"):storeBorder(),leafd()):jQuery("#dialog-border-cancel").click();border_changed=!1});$("#dialog-border-cancel,#dialog-border-x").on("click",function(n){n.preventDefault();updateBorderUI("override");loadBorder();reset=""});$("#myBorderDialog").keyup(function(n){n.which==27&&(updateBorderUI("override"),loadBorder(),reset="")});$("#dialog-border-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#menu-border")});jQuery("#dialog-border-colorize").on("click",function(){loadColorize();loadBorder();reset=""});jQuery("#dialog-border-flip,#dialog-border-mirror").on("click",function(){var n=jQuery("#dialog-border-flip").prop("checked"),t=jQuery("#dialog-border-mirror").prop("checked");transformElement("#menuborder",t,n);reset=""});jQuery("#dialog-border-select").on("change",function(){loadBorder();reset="";border_changed=!0});jQuery("#dialog-border-margin").on("change",function(){var i=jQuery("#dialog-border-margin").val(),n=numToNum(i,unitSI,"in",!0),t=numCheck(n,"0","2","0.25",!0);t!=n?jQuery("#dialog-border-margin").val(numToNum(t,"in",unitSI)):jQuery("#dialog-border-margin").val(numToNum(n,"in",unitSI));loadBorder();reset="";border_changed=!0});jQuery("#menu-reset-style1a").click(function(n){n.preventDefault();var t=JSON.parse(sessionStorage.getItem("override.css"));$("#menu-reset-style1").hasClass("disabled")?event.stopPropagation():Object.getOwnPropertyNames(t).length>0&&jQuery("#myResetMenuStyleDialog").modal("show")});jQuery("#myResetMenuStyleDialog").on("shown",function(){storeReset()});jQuery("#dialog-reset-ok").on("click",function(n){n.preventDefault();jQuery("#myResetMenuStyleDialog").modal("hide");mp_predo("resettostyle",page_no);cameviaresetcmd=!0;sessionStorage.setItem("override.css","{}");leafd();jQuery("#dialog-menustyle-ok").click()});jQuery("#dialog-reset-cancel,#dialog-resetstyle-x").on("click",function(n){n.preventDefault();restoreReset();jQuery("#myResetMenuStyleDialog").modal("hide")});$("#myResetMenuStyleDialog").keyup(function(n){n.which==27&&(restoreReset(),jQuery("#myResetMenuStyleDialog").modal("hide"))});jQuery("#dialog-resetstyle-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#reset-menu-style")});$("#nowidestance").on("click",function(n){n.preventDefault();$(".gaugevals").is(":visible")?toggleListWidth("#mp-thin-list-icon"):toggleListWidth("#mp-wide-list-icon")});$('[name="shorter-line"], [name="stroke-width"], [name="line-type"], #dialog-colline-color').on("change",function(){layout_changed=!0;reset=""});$("#width-balance").on("slidechange",function(){$("#width-balance").slider("value")!=layout_sliderval_onshown&&spinner2_stopped&&(layout_repage_needed=!0,layout_changed=!0,reset="")});var layout_repage_needed=!1,layout_changed=!1,layout_sliderval_onshown=100;jQuery("#myColumnLayoutOptionsDialog").on("shown",function(){layout_sliderval_onshown=$("#width-balance").slider("value")});jQuery("#dialog-columnlayout-ok").on("click",function(n){n.preventDefault();layout_changed?(jQuery("#myColumnLayoutOptionsDialog").modal("hide"),mp_predo("layout",page_no),start_spinner(),disable_toolbar(),setTimeout(function(){var r=JSON.parse(sessionStorage.getItem("override.css")),e=JSON.parse(sessionStorage.getItem("menufile")),o=jQuery("#myColumnLayoutOptionsDialog form").serializeArray(),n={},u,i,t,f;_.map(o,function(t){return n[t.name]=t.value,n});n.fill=jQuery("#dialog-colline-color").spectrum("get").toHexString();n["stroke-opacity"]=jQuery("#dialog-colline-color").spectrum("get").getAlpha();n["width-balance"]=$("#width-balance").slider("value");n["desc-left-indent"].indexOf(";")>-1?(u=n["desc-left-indent"].split(";"),n["extras-left-indent"]=u[1]):(i=JSON.parse(sessionStorage.getItem("origCSS")),t=i[".style"]["desc-left-indent"],t=parseFloat(numToNum(t,"in",unitSI,!0)).toFixed(4),t!=parseFloat(numToNum(n["desc-left-indent"],unitSI,unitSI,!0)).toFixed(4)?n["extras-left-indent"]=n["desc-left-indent"]:(f=i[".style"]["extras-left-indent"],n["extras-left-indent"]=parseFloat(numToNum(f,"in",unitSI,!0)).toFixed(4)));(n["line-between-columns"]==undefined||n["line-between-columns"]=="off")&&(n["line-between-columns"]="no");n["line-between-columns"]=="on"&&(n["line-between-columns"]="yes");(n["shorter-line"]==undefined||n["shorter-line"]=="off")&&(n["shorter-line"]="no");n["shorter-line"]=="on"&&(n["shorter-line"]="yes");n["space-between-columns"]=parseFloat(numToNum(n["space-between-columns"],unitSI,"in",!0)).toFixed(4);n["desc-left-indent"]=parseFloat(numToNum(n["desc-left-indent"],unitSI,"in",!0)).toFixed(4);n["desc-right-indent"]=parseFloat(numToNum(n["desc-right-indent"],unitSI,"in",!0)).toFixed(4);n["extras-left-indent"]=parseFloat(numToNum(n["extras-left-indent"],unitSI,"in",!0)).toFixed(4);r[".style"]=n;sessionStorage.setItem("override.css",JSON.stringify(r));sessionStorage.setItem("menufile",JSON.stringify(e));calculate_col_width();layout_repage_needed?(setIsUneven(global_columns),setPredoOptimizer(!1),iMenuPro.draw_text(page_no)):(setPredoOptimizer(!0),iMenuPro.drawto_text(page_no,"update_text_only"));layout_repage_needed=!1;reset=="reset_column"&&(noOverride(".style"),reset="");leafd();makeColumns()},minSpinOffload)):jQuery("#dialog-columnlayout-cancel").click();layout_changed=!1});jQuery("#dialog-columnlayout-cancel,#dialog-columnlayout-x").on("click",function(n){n.preventDefault();layout_changed=!1;resetColumnLayout("override");layout_repage_needed=!1});$("#myColumnLayoutOptionsDialog").keyup(function(n){n.which==27&&(layout_changed=!1,resetColumnLayout("override"),layout_repage_needed=!1)});jQuery("#dialog-columnlayout-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#column-layout-options")});jQuery("#space-between-columns").on("change",function(){var n=JSON.parse(sessionStorage.getItem("origCSS")),t=n[".style"]["space-between-columns"],i=jQuery("#space-between-columns").val(),r=numToNum(i,unitSI,"in",!0),u=numCheck(r,"0","2",t,!0);$("#space-between-columns").val(numToNum(u,"in",unitSI));layout_repage_needed=!0;layout_changed=!0;reset=""});jQuery("#desc-left-indent").on("change",function(){var e=JSON.parse(sessionStorage.getItem("origCSS")),i=e[".style"]["desc-left-indent"],l=e[".style"]["extras-left-indent"],r=jQuery("#desc-left-indent").val(),t,f;if(r.indexOf(";")>-1){var u="",n=r.split(";"),o=numToNum(n[0],unitSI,"in",!0),s=numToNum(n[1],unitSI,"in",!0),h=numCheck(o,"0","2.5",i,!0),c=numCheck(s,"0","2.5",i,!0);u=h!=o?parseFloat(numToNum(h,"in",unitSI,!0)).toFixed(2)+";":parseFloat(n[0]).toFixed(2)+";";u+=c!=s?parseFloat(numToNum(c,"in",unitSI,!0)).toFixed(2):parseFloat(n[1]).toFixed(2);jQuery("#desc-left-indent").val(u)}else t=numToNum(r,unitSI,"in",!0),f=numCheck(t,"0","2.5",i,!0),f!=t?jQuery("#desc-left-indent").val(numToNum(f,"in",unitSI)):jQuery("#desc-left-indent").val(numToNum(t,"in",unitSI));layout_repage_needed=!0;layout_changed=!0;reset=""});jQuery("#desc-right-indent").on("change",function(){var i=JSON.parse(sessionStorage.getItem("origCSS")),r=i[".style"]["desc-right-indent"],u=jQuery("#desc-right-indent").val(),n=numToNum(u,unitSI,"in",!0),t=numCheck(n,"0.11","0.75",r,!0);t!=n?jQuery("#desc-right-indent").val(numToNum(t,"in",unitSI)):jQuery("#desc-right-indent").val(numToNum(n,"in",unitSI));layout_repage_needed=!0;layout_changed=!0;reset=""});$("#line-between-columns").on("change",function(){$("#line-between-columns").prop("checked")?($('#myColumnLayoutOptionsDialog [name="shorter-line"]').prop("disabled",!1),$('#myColumnLayoutOptionsDialog [name="stroke-width"]').prop("disabled",!1),$('#myColumnLayoutOptionsDialog [name="line-type"]').prop("disabled",!1),$("#dialog-colline-color").spectrum("enable"),$(".ColLineText").removeClass("muted")):($('#myColumnLayoutOptionsDialog [name="shorter-line"]').prop("disabled",!0),$('#myColumnLayoutOptionsDialog [name="stroke-width"]').prop("disabled",!0),$('#myColumnLayoutOptionsDialog [name="line-type"]').prop("disabled",!0),$("#dialog-colline-color").spectrum("disable"),$(".ColLineText").addClass("muted"));layout_changed=!0;reset=""});$('[name="line-spacing"]').on("change",function(){layout_repage_needed=!0;layout_changed=!0;reset=""});$('[name="desc-separator"],[name="extras-separator"]').on("change",function(){layout_repage_needed=!0;layout_changed=!0;reset=""});$('[name="dotspacing"], #dialog-priceoptions-spaceitem, #dialog-priceoptions-spaceprice, #dialog-priceoptions-matchname, #dialog-priceoptions-multiprice').on("change",function(){priceoptions_changed=!0;reset=""});price_repage_needed=!1;priceoptions_changed=!1;jQuery("#dialog-priceoptions-ok").on("click",function(n){n.preventDefault();priceoptions_changed?(jQuery("#myPriceOptionsDialog").modal("hide"),mp_predo("price",page_no),start_spinner(),disable_toolbar(),setTimeout(function(){var t=JSON.parse(sessionStorage.getItem("override.css")),n={};n.layout=jQuery('input[name="placement"]:radio:checked').val();n.currency=jQuery('[name="currency"]').val();n["price-leader"]=jQuery('[name="leader"]').val();n["dot-space-between"]=jQuery('[name="dotspacing"]').val();n["space-between-prices"]=unitSI==="in"?jQuery("#dialog-priceoptions-multiprice").val():parseFloat(numToNum($("#dialog-priceoptions-multiprice").val(),unitSI,"in",!0)).toFixed(4);n["dot-space-item"]=jQuery("#dialog-priceoptions-spaceitem").prop("checked")?2:1;n["dot-space-price"]=jQuery("#dialog-priceoptions-spaceprice").prop("checked")?2:1;n["dots-match-name-color"]=jQuery("#dialog-priceoptions-matchname").prop("checked")?"yes":"no";t[".price-options"]=n;sessionStorage.setItem("override.css",JSON.stringify(t));iMenuPro.draw_text(page_no);price_repage_needed=!1;reset=="reset_price"&&(noOverride(".price-options"),reset="");leafd()},minSpinOffload)):jQuery("#dialog-priceoptions-cancel").click();priceoptions_changed=!1});jQuery("#dialog-priceoptions-cancel,#dialog-priceoptions-x").on("click",function(n){n.preventDefault();priceoptions_changed=!1;resetPriceOptions("override");price_repage_needed=!1});$("#myPriceOptionsDialog").keyup(function(n){n.which==27&&(n.preventDefault(),priceoptions_changed=!1,resetPriceOptions("override"),price_repage_needed=!1)});jQuery("#dialog-priceoptions-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#price-options")});$('[name="placement"]').on("change",function(){price_repage_needed=!0;priceoptions_changed=!0;reset=""});$('[name="currency"]').on("change",function(){price_repage_needed=!0;priceoptions_changed=!0;reset=""});$('[name="leader"]').on("change",function(){price_repage_needed=!0;priceoptions_changed=!0;reset=""});jQuery("#dialog-priceoptions-multiprice").on("change",function(){var n=jQuery("#dialog-priceoptions-multiprice").val(),t=numToNum(n,unitSI,"in",!0),i=numCheck(t,"0.5","1.25","0.75",!0);$("#dialog-priceoptions-multiprice").val(numToNum(i,"in",unitSI));price_repage_needed=!0});var keep_inline_on_shown=!1,symsize_on_shown=!1,symopts_changed=!1;$('[name="keep-inline"], [name="symsize"], #mp-dialog-symbol1-color, #mp-dialog-symbol2-color').on("change",function(){reset="";symopts_changed=!0});jQuery("#mp-dialog-symboloptions-ok").on("click",function(n){if(n.preventDefault(),symopts_changed){jQuery("#mySymbolOptionsDialog").modal("hide");mp_predo("symbols",page_no);var f=jQuery("#mp-dialog-symbol1-color").spectrum("get").toHexString(),e=jQuery("#mp-dialog-symbol1-color").spectrum("get").getAlpha(),o=jQuery("#mp-dialog-symbol2-color").spectrum("get").toHexString(),s=jQuery("#mp-dialog-symbol2-color").spectrum("get").getAlpha(),i=jQuery('[name="symsize"]').prop("checked"),r=jQuery('[name="keep-inline"]').prop("checked"),u=JSON.parse(sessionStorage.getItem("override.css")),t={};t["fill-1"]=f;t["fill-2"]=o;t["fill-opacity1"]=e;t["fill-opacity2"]=s;t.large=i?"yes":"no";t["keep-inline"]=r?"yes":"no";u[".symbol"]=t;sessionStorage.setItem("override.css",JSON.stringify(u));iMenuPro.updateSymbol();keep_inline_on_shown!=r||r&&i!=symsize_on_shown||$(".foodImg_elem").first().attr("xlink:href")!=undefined&&i!=symsize_on_shown?(start_spinner(),disable_toolbar(),setTimeout(function(){iMenuPro.draw_text(page_no);setPredoOptimizer(!1)},minSpinOffload)):setPredoOptimizer(!0);reset=="reset_symbol"&&(noOverride(".symbol"),reset="");leafd()}else jQuery("#mp-dialog-symboloptions-cancel").click();symopts_changed=!1});jQuery("#mySymbolOptionsDialog").on("shown",function(){keep_inline_on_shown=jQuery('[name="keep-inline"]').prop("checked");symsize_on_shown=jQuery('[name="symsize"]').prop("checked")});jQuery("#mp-dialog-symboloptions-x, #mp-dialog-symboloptions-cancel").on("click",function(n){n.preventDefault();resetSymbolOptions("override")});$("#mySymbolOptionsDialog").keyup(function(n){n.which==27&&(n.preventDefault(),resetSymbolOptions("override"))});jQuery("#dialog-symboloptions-help").on("click",function(){window.open("http://help.imenupro.com/menu-design.htm#symbol-options")});jQuery(".ResetToStyleButton").on("click",function(n){n.preventDefault();var t=jQuery(".modal.hide.in").attr("id");resetStyle(t)});newMenu_headings=[{head_id:"h0",heading:"My Title",type:"title"},{head_id:"h1",heading:"Sample Heading",type:"normal"},{head_id:"h2",heading:"Sample Subheading - you can edit or delete these, or add your own",type:"small"}];var menufiletmp=[{}],origCSStmp=[{}],overridetmp=[{}],menufiletmp2=[{}],origCSStmp2=[{}],overridetmp2=[{}],undoCSStmp=[{}],redoCSStmp=[{}],mui=0,mutotal=0,maxUndos=10,undostreak=0,redostreak=0;var undostate=["na"],undo_page_no=[0],predo_optimizer=[!1],undo_foodpos=[0],ignore_openmenu_predos=!1;jQuery("#dialog-edit-undo").click(function(n){n.preventDefault();$("#menu-edit-undo").hasClass("disabled")||$(".spinner").css("display")=="block"?(n.stopPropagation(),$(".spinner").css("display")=="block"&&doAlert(238,null,3e3,!0)):(start_spinner(),setTimeout(function(){mp_undo()},minSpinOffload))});jQuery("#dialog-edit-redo").click(function(n){n.preventDefault();$("#menu-edit-redo").hasClass("disabled")||$(".spinner").css("display")=="block"?(n.stopPropagation(),$(".spinner").css("display")=="block"&&doAlert(238,null,3e3,!0)):(start_spinner(),setTimeout(function(){mp_redo()},minSpinOffload))});ignoreoverride=!1;settings_loaded_from_db=!1;jQuery("#mp-search-menus").keyup(function(n){n.which==13&&n.preventDefault();n.which==27&&jQuery("#mp-search-menus").val("");var t=searchMenuTitle();fixMenuData(t);jQuery("#myMenuList").megalist("setDataProvider",sortMenuTitle(t))});$("#mp-imgupload-btnFONT").on("click",function(n){$("#mp-imgupload-btnFONT").hasClass("disabled")?(n.preventDefault(),demoMenu?doAlert(108,null,4e3,!0):doAlert(298,null,9e3,!0)):isIE9&&(n.preventDefault(),doAlert(292,null,7e3,!0))});jQuery("#myUploadPreviewFONT").on("click",function(n){n.preventDefault();$("#myUploadPreviewFONT").addClass("dont_select_ptr");$("#myUploadPreviewFONT").removeClass("mpFontInUse");$("#mp-imgupload-deletepanelFONT").is(":visible")||($("#mp-font-footer").hide(),$("#jansyUploadWellFONT").hide(),$("#jansyRemoveWellFONT").hide(),$("#mp-fi-fontmap, #mp-up-browse-noteFONT").show(),$("#mp-imgupload-deletepanelFONT").hide(),$("#mp-up-trash-divFONT").show(),$("#myUploadPreviewFONT img").attr("src")!="bootstrap/img/noFont.png"||$("#jansyRemoveWellFONT").hide(),$("#mp-imgupload-trashcanFONT").hide())});jQuery("#mp-imgupload-selectFONT").on("click",function(n){n.preventDefault();$("#mp-fi-fontmap, #mp-up-browse-noteFONT").hide();$("#jansyRemoveWellFONT").show();$("#myUploadPreviewFONT").removeClass("dont_select_ptr");$("#mp-font-footer").show();$("#myUploadPreviewFONT").addClass("mpFontInUse");resetUISearchFONT();$("#myUploadPreviewFONT img").attr("src")=="bootstrap/img/noFont.png"?($("#jansyUploadWellFONT").show(),$("#jansyRemoveWellFONT").hide(),enableFontSelects()):disableFontSelects()});jQuery("#mp-font-img-remove").on("click",function(n){n.preventDefault();$("#jansyRemoveWellFONT").hide();jQuery("#jansy-img-uploadFONT").fileupload("reset");$("#jansyUploadWellFONT").show();jQuery("#myUploadPreviewFONT").html('<img src="" >');jQuery("#myUploadPreviewFONT img").attr("src","bootstrap/img/noFont.png");enableFontSelects();setFontState("new");$("#myUploadImgListFONT").megalist("setSelectedIndexMove",-1)});$("#mp-imgupload-remove-btnFONT").click(function(n){$("#mp-imgupload-remove-btnFONT").attr("disabled")=="disabled"?(n.preventDefault(),n.stopImmediatePropagation()):setTimeout(function(){drawUserImageFONT("bootstrap/img/noFont.png","")},100)});$("#file-imguploadFONT").click(function(n){$("#chngfontup").hasClass("muted")&&(n.preventDefault(),n.stopImmediatePropagation())});jQuery("#mp-imgupload-trashcanFONT").on("click",function(n){n.preventDefault();$("#jansyUploadWellFONT").hide();$("#mp-font-useimg-div").hide();$("#mp-font-useimg-hr").hide();$("#mp-up-browse-noteFONT").hide();$("#mp-imgupload-findFONT").hide();$("#mp-up-trash-divFONT").hide();$("#mp-imgupload-trashcanFONT").hide();$("#mp-imgupload-deletepanelFONT").show()});editFont="";jQuery("#mp-imgupload-cancel-selectFONT").on("click",function(){editFont==""&&$("#mp-fontstate").hasClass("mp-editfont")&&$("#myUploadPreviewFONT img").attr("src")=="bootstrap/img/noFont.png"?(drawUserImageFONT("bootstrap/img/noFont.png",""),enableFontSelects(),$("#jansyRemoveWellFONT").hide(),$("#jansyUploadWellFONT").show(),setFontState("new")):(editFont&&$("#myUploadPreviewFONT").text(editFont),$("#mp-fontstate").hasClass("mp-newfont")?(drawUserImageFONT("bootstrap/img/noFont.png",""),enableFontSelects(),$("#jansyRemoveWellFONT").hide(),$("#jansyUploadWellFONT").show()):($("#jansyUploadWellFONT").hide(),$("#jansyRemoveWellFONT").show()));$("#mp-fi-fontmap, #mp-up-browse-noteFONT").hide();$("#mp-imgupload-trashcanFONT").hide();$("#myUploadPreviewFONT").removeClass("dont_select_ptr");$("#mp-font-footer").show();resetUISearchFONT()});jQuery("#mp-imgupload-cancelbtnFONT,#mp-imgupload-deletebtnFONT").on("click",function(n){var i,r;if(n.preventDefault(),mp_predo("na"),n.target.id=="mp-imgupload-deletebtnFONT"){if(nosaveMenu){doAlert("No delete font with No Save","info",1500,!0);return}var u=jQuery("#access_token").val(),t=jQuery("#myUploadPreviewFONT img").attr("class"),f=jQuery("#myUploadPreviewFONT img").attr("src");t!=undefined&&($("#mp-imgupload-trashcanFONT").hide(),doAlert(324,"",5e3,!0),i=t.replace(/image-/g,""),r="/api/image/"+i+"/"+u+"/"+Date.now(),jQuery.ajax({url:r,type:"DELETE",dataType:"json",success:function(n){if(n.status=="OK"){if($("#mp-acct-cufonts").text(parseInt($("#mp-acct-cufonts").text())-1),$("#myUploadPreviewFONT").text()==editFont)editFont="",drawUserImageFONT("bootstrap/img/noFont.png",""),enableFontSelects();else if($("#mp-fontstate").hasClass("mp-editfont")&&editFont!=""){var f=_.pluck(imageFONT,"filename"),r=_.indexOf(f,editFont),e="https://"+s3bkt+".s3.amazonaws.com/"+imageFONT[r].image;setTimeout(function(){drawUserImageFONT(e,t,editFont)},100);setTimeout(function(){sampleFontFamily()},200)}else drawUserImageFONT("bootstrap/img/noFont.png",""),enableFontSelects();doAlert(6,null,1e3,!0);importImageData("user_font");var o=_.pluck(imageFONT,"id"),r=_.indexOf(o,i),u=imageFONT[r].image,s=getItem("override.css"),h=JSON.stringify(s).match(u);h&&(doAlert(336,null,15e3,!0),mp_predo("na"),zapTTFfromOverride(u),emptyStyleSheet(),writeToStyleSheet(),iMenuPro.draw_text(page_no))}else doAlert(86,null,0,!0)}}))}else $("#mp-imgupload-trashcanFONT").show();$("#mp-imgupload-deletepanelFONT").hide();$("#mp-font-useimg-div").show();$("#mp-font-useimg-hr").show();$("#mp-up-browse-noteFONT").show();$("#mp-imgupload-findFONT").show();$("#mp-up-trash-divFONT").show();$("#mp-fi-fontmap, #mp-up-browse-noteFONT").hide();$("#mp-imgupload-searchFONT").show();$("#myUploadImgListFONT").show();$("#mp-imgupload-cancel-selectFONT").show();$("#mp-imgupload-selectFONT").show();$("#mp-fi-fontmap, #mp-up-browse-noteFONT").show()});jQuery("#mp-imgupload-findFONT").keyup(function(n){var i,t;n.which==13&&n.preventDefault();i=jQuery("#mp-imgupload-findFONT").val();i.length>1?(t=_.filter(imageFONT,function(n){var t=n.filename.toLowerCase();return t.indexOf(i.toLowerCase())>-1}),jQuery("#myUploadImgListFONT").addClass("bluehalo"),$("#myUploadImgListFONT").megalist("setSelectedIndexMove",-1)):(t=imageFONT,jQuery("#myUploadImgListFONT").removeClass("bluehalo"));fixImageDataFONT(t,"search");$("#myUploadImgListFONT").megalist("setDataProvider",t)});jQuery("#file-imguploadFONT").on("change",function(){var n=jQuery("#file-imguploadFI").val()});jQuery("#myUploadImgListFONT").on("change",function(n){var t=jQuery(n.srcElement.get()[0].innerHTML).attr("src"),i=jQuery(n.srcElement.get()[0]).text(),r=jQuery(n.srcElement.get()[0].innerHTML).attr("idx");drawUserImageFONT(t,r,i);$("#mp-imgupload-trashcanFONT").show();disableFontSelects();sampleFontFamily()});$("#file-imguploadFONT").change(function(){$(this).val()===""?($("#jansyConfirmWellFONT").hide(),$("#dialog-changefont-ok").attr("disabled",!1)):($("#jansyConfirmWellFONT").show(),$("#dialog-changefont-ok").attr("disabled",!0))});$("#mp-font-img-confirm").on("click",function(n){var t=$("#file-imguploadFONT")[0].files[0].size;n.preventDefault();$("#myUploadPreviewFONTUPLOAD img").attr("src")!=undefined?doAlert(318,null,4e3,!0):t>4194304?doAlert(328,null,5e3,!0):(disableUploadUI(),doAlert(320,"",25e3,!0),jQuery("#cufont_form").ajaxSubmit({success:showImportFontAlert}))});$("#MPDemoAcct").on("click",function(n){var i,o,t,r,u,f,e,s,h,c,l;if(n.preventDefault(),i=getItem("fooditem"),o=i.length,o>7||menu_changes>0){for(t=getItem("menufile"),delete t.float_images,t.float_images={order:[],"default":"id;url;x;y;width;height;flip;mirror"},u=8,f=0;f<o;f++)if((r=parseInt(i[f].food_id))>7){if(i[f].food_id=u.toString(),t.food_item.order!=undefined)for(e=0;e<t.food_item.order.length;e++)parseInt(t.food_item.order[e])==r&&(t.food_item.order[e]=u.toString());t.food_item[r.toString()]!=undefined&&(Object.defineProperty(t.food_item,u.toString(),Object.getOwnPropertyDescriptor(t.food_item,r.toString())),delete t.food_item[r.toString()]);++u}s=getItem("override.css");h=jQuery('link[title="origCSS"]').attr("href");t.override=s;t.myStyle=h;t.menuID=1;c=LZString.compressToBase64(JSON.stringify(t));l=JSON.stringify(i);localStorage.setItem("impJSfi",l);localStorage.setItem("impLZmf",c)}window.open("https://imenupro.com/signup")})
//# sourceMappingURL=mp-UI.map
